%versi 3 (18-12-2016)
\chapter{Kode Program}
\label{lamp:A}

%terdapat 2 cara untuk memasukkan kode program
% 1. menggunakan perintah \lstinputlisting (kode program ditempatkan di folder yang sama dengan file ini)
% 2. menggunakan environment lstlisting (kode program dituliskan di dalam file ini)
% Perhatikan contoh yang diberikan!!
%
% untuk keduanya, ada parameter yang harus diisi:
% - language: bahasa dari kode program (pilihan: Java, C, C++, PHP, Matlab, C#, HTML, R, Python, SQL, dll)
% - caption: nama file dari kode program yang akan ditampilkan di dokumen akhir
%
% Perhatian: Abaikan warning tentang textasteriskcentered!!
%

%\lstinputlisting[language=Java, caption=MyCode.java]{./Lampiran/MyCode.java} 

% controllers
\begin{lstlisting}[language=diff, caption=Perubahan pada kode Assignments.php]
Loaded config default.
Using cache file ".php-cs-fixer.cache".
1) application/controllers/Assignments.php
---------- begin diff ----------
--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Assignments.php
+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Assignments.php
@@ -4,622 +4,635 @@
* @file Assignments.php
* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
*/
-defined('BASEPATH') OR exit('No direct script access allowed');
+defined('BASEPATH') or exit('No direct script access allowed');

class Assignments extends CI_Controller
{
	+    private $messages;
	+    private $edit_assignment;
	+    private $edit;
	
	-	private $messages;
	-	private $edit_assignment;
	-	private $edit;
	
	+    // ------------------------------------------------------------------------
	
	-	// ------------------------------------------------------------------------
	
	+    public function __construct()
	+    {
		+        parent::__construct();
		+        if (! $this->session->userdata('logged_in')) { // if not logged in
			+            redirect('login');
			+        }
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-		if ( ! $this->session->userdata('logged_in')) // if not logged in
			-			redirect('login');
			+        $this->messages = array();
			+        $this->edit_assignment = array();
			+        $this->edit = false;
			+    }
		
		-		$this->messages = array();
		-		$this->edit_assignment = array();
		-		$this->edit = FALSE;
		-	}
	
	+    // ------------------------------------------------------------------------
	
	-	// ------------------------------------------------------------------------
	
	+    public function index()
	+    {
		+        $data = array(
		+            'all_assignments' => $this->assignment_model->all_assignments(),
		+            'messages' => $this->messages,
		+        );
		
		-	public function index()
		-	{
			-		$data = array(
			-			'all_assignments' => $this->assignment_model->all_assignments(),
			-			'messages' => $this->messages,
			-		);
			+        foreach ($data['all_assignments'] as &$item) {
				+            $extra_time = $item['extra_time'];
				+            $delay = shj_now() - strtotime($item['finish_time']);
				+            ;
				+            ob_start();
				+            if (eval($item['late_rule']) === false) {
					+                $coefficient = "error";
					+            }
				+            if (!isset($coefficient)) {
					+                $coefficient = "error";
					+            }
				+            ob_end_clean();
				+            $item['coefficient'] = $coefficient;
				+            $item['finished'] = ($delay > $extra_time);
				+        }
			
			-		foreach ($data['all_assignments'] as &$item)
			-		{
				-			$extra_time = $item['extra_time'];
				-			$delay = shj_now()-strtotime($item['finish_time']);;
				-			ob_start();
				-			if ( eval($item['late_rule']) === FALSE )
				-				$coefficient = "error";
				-			if (!isset($coefficient))
				-				$coefficient = "error";
				-			ob_end_clean();
				-			$item['coefficient'] = $coefficient;
				-			$item['finished'] = ($delay > $extra_time);
				-		}
			+        $this->twig->display('pages/assignments.twig', $data);
			
			-		$this->twig->display('pages/assignments.twig', $data);
			+    }
		
		-	}
	
	+    // ------------------------------------------------------------------------
	
	-	// ------------------------------------------------------------------------
	
	+    /**
	+     * Used by ajax request (for select assignment from top bar)
	+     */
	+    public function select()
	+    {
		+        if (! $this->input->is_ajax_request()) {
			+            show_404();
			+        }
		
		-	/**
		-	 * Used by ajax request (for select assignment from top bar)
		-	 */
		-	public function select()
		-	{
			-		if ( ! $this->input->is_ajax_request() )
			-			show_404();
			+        $this->form_validation->set_rules('assignment_select', 'Assignment', 'required|integer|greater_than[0]');
			
			-		$this->form_validation->set_rules('assignment_select', 'Assignment', 'required|integer|greater_than[0]');
			+        if ($this->form_validation->run()) {
				+            $this->user->select_assignment($this->input->post('assignment_select'));
				+            $this->assignment = $this->assignment_model->assignment_info($this->input->post('assignment_select'));
				+            $json_result = array(
				+                'done' => 1,
				+                'finish_time' => $this->assignment['finish_time'],
				+                'extra_time' => $this->assignment['extra_time'],
				+            );
				+        } else {
				+            $json_result = array('done' => 0, 'message' => 'Input Error');
				+        }
			
			-		if ($this->form_validation->run())
			-		{
				-			$this->user->select_assignment($this->input->post('assignment_select'));
				-			$this->assignment = $this->assignment_model->assignment_info($this->input->post('assignment_select'));
				-			$json_result = array(
				-				'done' => 1,
				-				'finish_time' => $this->assignment['finish_time'],
				-				'extra_time' => $this->assignment['extra_time'],
				-			);
				-		}
			-		else
			-			$json_result = array('done' => 0, 'message' => 'Input Error');
			+        $this->output->set_header('Content-Type: application/json; charset=utf-8');
			+        echo json_encode($json_result);
			+    }
		
		-		$this->output->set_header('Content-Type: application/json; charset=utf-8');
		-		echo json_encode($json_result);
		-	}
	
	
	+    // ------------------------------------------------------------------------
	
	-	// ------------------------------------------------------------------------
	
	
	+    /**
	+     * Download pdf file of an assignment (or problem) to browser
	+     */
	+    public function pdf($assignment_id, $problem_id = null, $no_download = false)
	+    {
		+        $finishtime = strtotime($this->assignment_model->assignment_info($assignment_id)['finish_time']);
		+        $starttime = strtotime($this->assignment_model->assignment_info($assignment_id)['start_time']);
		+        $extratime = $this->assignment_model->assignment_info($assignment_id)['extra_time'];
		
		-	/**
		-	 * Download pdf file of an assignment (or problem) to browser
		-	 */
		-	public function pdf($assignment_id, $problem_id = NULL, $no_download = FALSE)
		-	{
			-		$finishtime = strtotime($this->assignment_model->assignment_info($assignment_id)['finish_time']);
			-		$starttime = strtotime($this->assignment_model->assignment_info($assignment_id)['start_time']);
			-		$extratime = $this->assignment_model->assignment_info($assignment_id)['extra_time'];
			+        // Find pdf file
			+        if ($problem_id === null || $problem_id === "null") {
				+            $pattern = rtrim($this->settings_model->get_setting('assignments_root'), '/')."/assignment_{$assignment_id}/*.pdf";
				+        } else {
				+            $pattern = rtrim($this->settings_model->get_setting('assignments_root'), '/')."/assignment_{$assignment_id}/p{$problem_id}/*.pdf";
				+        }
			+        $pdf_files = glob($pattern);
			+        if (! $pdf_files) {
				+            show_error("File not found");
				+        } elseif (!$this->assignment_model->assignment_info($assignment_id)['open']) {
				+            show_error('Selected assignment has been closed.');
				+        } elseif	(! $this->assignment_model->is_participant($this->assignment_model->assignment_info($assignment_id)['participants'], $this->user->username)) {
				+            show_error('You are not registered for submitting.');
				+        } elseif (shj_now() > $finishtime + $extratime) {
				+            show_error('Selected assignment has finished.');
				+        } elseif (shj_now() < $starttime) {
				+            show_error('Selected assignment has not started.');
				+        }
			
			-		// Find pdf file
			-		if ($problem_id === NULL || $problem_id === "null")
			-			$pattern = rtrim($this->settings_model->get_setting('assignments_root'),'/')."/assignment_{$assignment_id}/*.pdf";
			-		else
			-			$pattern = rtrim($this->settings_model->get_setting('assignments_root'),'/')."/assignment_{$assignment_id}/p{$problem_id}/*.pdf";
			-		$pdf_files = glob($pattern);
			-		if ( ! $pdf_files )
			-			show_error("File not found");
			-		elseif (!$this->assignment_model->assignment_info($assignment_id)['open'])
			-			show_error('Selected assignment has been closed.');
			-		elseif	( ! $this->assignment_model->is_participant($this->assignment_model->assignment_info($assignment_id)['participants'],$this->user->username) )
			-			show_error('You are not registered for submitting.');
			-		elseif ( shj_now() > $finishtime + $extratime)
			-			show_error('Selected assignment has finished.');
			-		elseif ( shj_now() < $starttime)
			-			show_error('Selected assignment has not started.');
			
			
			-		
			-		$filename = shj_basename($pdf_files[0]);
			-		// Download the file to browser
			-		if($no_download === FALSE){
				-			$this->load->helper('download')->helper('file');
				-			force_download($filename, file_get_contents($pdf_files[0]), TRUE);
				-		}
			-		else{
				-			$content = file_get_contents($pdf_files[0]);
				-			header('Content-Type: application/pdf');
				-			die($content);
				-		}
			-	}
		+        $filename = shj_basename($pdf_files[0]);
		+        // Download the file to browser
		+        if($no_download === false) {
			+            $this->load->helper('download')->helper('file');
			+            force_download($filename, file_get_contents($pdf_files[0]), true);
			+        } else {
			+            $content = file_get_contents($pdf_files[0]);
			+            header('Content-Type: application/pdf');
			+            die($content);
			+        }
		+    }
	
	
	
	-	// ------------------------------------------------------------------------
	+    // ------------------------------------------------------------------------
	
	
	
	-	/**
	-	 * Compressing and downloading test data and descriptions of an assignment to the browser
	-	 */
	-	public function downloadtestsdesc($assignment_id = FALSE)
	-	{
		-		if ($assignment_id === FALSE)
		-			show_404();
		-		if ( $this->user->level <= 1) // permission denied
		-			show_404();
		+    /**
		+     * Compressing and downloading test data and descriptions of an assignment to the browser
		+     */
		+    public function downloadtestsdesc($assignment_id = false)
		+    {
			+        if ($assignment_id === false) {
				+            show_404();
				+        }
			+        if ($this->user->level <= 1) { // permission denied
				+            show_404();
				+        }
			
			-		$this->load->library('zip');
			+        $this->load->library('zip');
			
			-		$assignment = $this->assignment_model->assignment_info($assignment_id);
			+        $assignment = $this->assignment_model->assignment_info($assignment_id);
			
			-		$number_of_problems = $assignment['problems'];
			+        $number_of_problems = $assignment['problems'];
			
			-		$root_path = rtrim($this->settings_model->get_setting('assignments_root'),'/').
			-			"/assignment_{$assignment_id}";
			+        $root_path = rtrim($this->settings_model->get_setting('assignments_root'), '/').
			+            "/assignment_{$assignment_id}";
			
			-		for ($i=1 ; $i<=$number_of_problems ; $i++)
			-		{
				+        for ($i = 1 ; $i <= $number_of_problems ; $i++) {
					
					-			$path = "$root_path/p{$i}/in";
					-			$this->zip->read_dir($path, FALSE, $root_path);
					+            $path = "$root_path/p{$i}/in";
					+            $this->zip->read_dir($path, false, $root_path);
					
					-			$path = "$root_path/p{$i}/out";
					-			$this->zip->read_dir($path, FALSE, $root_path);
					+            $path = "$root_path/p{$i}/out";
					+            $this->zip->read_dir($path, false, $root_path);
					
					-			$path = "$root_path/p{$i}/tester.cpp";
					-			if (file_exists($path))
					-				$this->zip->add_data("p{$i}/tester.cpp", file_get_contents($path));
					+            $path = "$root_path/p{$i}/tester.cpp";
					+            if (file_exists($path)) {
						+                $this->zip->add_data("p{$i}/tester.cpp", file_get_contents($path));
						+            }
					
					-			$pdf_files = glob("$root_path/p{$i}/*.pdf");
					-			if ($pdf_files)
					-			{
						-				$path = $pdf_files[0];
						-				$this->zip->add_data("p{$i}/".shj_basename($path), file_get_contents($path));
						-			}
					+            $pdf_files = glob("$root_path/p{$i}/*.pdf");
					+            if ($pdf_files) {
						+                $path = $pdf_files[0];
						+                $this->zip->add_data("p{$i}/".shj_basename($path), file_get_contents($path));
						+            }
					
					-			$path = "$root_path/p{$i}/desc.html";
					-			if (file_exists($path))
					-				$this->zip->add_data("p{$i}/desc.html", file_get_contents($path));
					+            $path = "$root_path/p{$i}/desc.html";
					+            if (file_exists($path)) {
						+                $this->zip->add_data("p{$i}/desc.html", file_get_contents($path));
						+            }
					
					-			$path = "$root_path/p{$i}/desc.md";
					-			if (file_exists($path))
					-				$this->zip->add_data("p{$i}/desc.md", file_get_contents($path));
					-		}
				+            $path = "$root_path/p{$i}/desc.md";
				+            if (file_exists($path)) {
					+                $this->zip->add_data("p{$i}/desc.md", file_get_contents($path));
					+            }
				+        }
			
			-		$pdf_files = glob("$root_path/*.pdf");
			-		if ($pdf_files)
			-		{
				-			$path = $pdf_files[0];
				-			$this->zip->add_data(shj_basename($path), file_get_contents($path));
				-		}
			+        $pdf_files = glob("$root_path/*.pdf");
			+        if ($pdf_files) {
				+            $path = $pdf_files[0];
				+            $this->zip->add_data(shj_basename($path), file_get_contents($path));
				+        }
			
			-		$this->zip->download("assignment{$assignment_id}_tests_desc_".date('Y-m-d_H-i', shj_now()).'.zip');
			-	}
		+        $this->zip->download("assignment{$assignment_id}_tests_desc_".date('Y-m-d_H-i', shj_now()).'.zip');
		+    }
	
	
	-	// ------------------------------------------------------------------------
	+    // ------------------------------------------------------------------------
	
	
	-	/**
	-	 * Compressing and downloading final codes of an assignment to the browser
	-	 */
	-	public function download_submissions($type = FALSE, $assignment_id = FALSE)
	-	{
		-		if ($type !== 'by_user' && $type !== 'by_problem')
		-			show_404();
		-		if ($assignment_id === FALSE || ! is_numeric($assignment_id))
		-			show_404();
		-		if ( $this->user->level == 0) // permission denied
		-			show_404();
		+    /**
		+     * Compressing and downloading final codes of an assignment to the browser
		+     */
		+    public function download_submissions($type = false, $assignment_id = false)
		+    {
			+        if ($type !== 'by_user' && $type !== 'by_problem') {
				+            show_404();
				+        }
			+        if ($assignment_id === false || ! is_numeric($assignment_id)) {
				+            show_404();
				+        }
			+        if ($this->user->level == 0) { // permission denied
				+            show_404();
				+        }
			
			-		$this->load->model('submit_model');
			-		$items = $this->submit_model->get_final_submissions($assignment_id, $this->user->level, $this->user->username);
			+        $this->load->model('submit_model');
			+        $items = $this->submit_model->get_final_submissions($assignment_id, $this->user->level, $this->user->username);
			
			-		$this->load->library('zip');
			+        $this->load->library('zip');
			
			-		$assignments_root = rtrim($this->settings_model->get_setting('assignments_root'),'/');
			+        $assignments_root = rtrim($this->settings_model->get_setting('assignments_root'), '/');
			
			-		foreach ($items as $item)
			-		{
				-			$file_path = $assignments_root.
				-				"/assignment_{$item['assignment']}/p{$item['problem']}/{$item['username']}/{$item['file_name']}."
				-				.filetype_to_extension($item['file_type']);
				-			if ( ! file_exists($file_path))
				-				continue;
				-			$file = file_get_contents($file_path);
				-			if ($type === 'by_user')
				-				$this->zip->add_data("{$item['username']}/p{$item['problem']}.".filetype_to_extension($item['file_type']), $file);
				-			elseif ($type === 'by_problem')
				-				$this->zip->add_data("problem_{$item['problem']}/{$item['username']}.".filetype_to_extension($item['file_type']), $file);
				-		}
			+        foreach ($items as $item) {
				+            $file_path = $assignments_root.
				+                "/assignment_{$item['assignment']}/p{$item['problem']}/{$item['username']}/{$item['file_name']}."
				+                .filetype_to_extension($item['file_type']);
				+            if (! file_exists($file_path)) {
					+                continue;
					+            }
				+            $file = file_get_contents($file_path);
				+            if ($type === 'by_user') {
					+                $this->zip->add_data("{$item['username']}/p{$item['problem']}.".filetype_to_extension($item['file_type']), $file);
					+            } elseif ($type === 'by_problem') {
					+                $this->zip->add_data("problem_{$item['problem']}/{$item['username']}.".filetype_to_extension($item['file_type']), $file);
					+            }
				+        }
			
			-		$this->zip->download("assignment{$assignment_id}_submissions_{$type}_".date('Y-m-d_H-i',shj_now()).'.zip');
			-	}
		+        $this->zip->download("assignment{$assignment_id}_submissions_{$type}_".date('Y-m-d_H-i', shj_now()).'.zip');
		+    }
	
	
	-	// ------------------------------------------------------------------------
	+    // ------------------------------------------------------------------------
	
	
	-	/**
	-	 * Delete assignment
	-	 */
	-	public function delete($assignment_id = FALSE)
	-	{
		-		if ($assignment_id === FALSE)
		-			show_404();
		-		if ($this->user->level <= 1) // permission denied
		-			show_404();
		+    /**
		+     * Delete assignment
		+     */
		+    public function delete($assignment_id = false)
		+    {
			+        if ($assignment_id === false) {
				+            show_404();
				+        }
			+        if ($this->user->level <= 1) { // permission denied
				+            show_404();
				+        }
			
			-		$assignment = $this->assignment_model->assignment_info($assignment_id);
			+        $assignment = $this->assignment_model->assignment_info($assignment_id);
			
			-		if ($assignment['id'] === 0)
			-			show_404();
			+        if ($assignment['id'] === 0) {
				+            show_404();
				+        }
			
			-		if ($this->input->post('delete') === 'delete')
			-		{
				-			$this->assignment_model->delete_assignment($assignment_id);
				-			redirect('assignments');
				-		}
			+        if ($this->input->post('delete') === 'delete') {
				+            $this->assignment_model->delete_assignment($assignment_id);
				+            redirect('assignments');
				+        }
			
			-		$data = array(
			-			'all_assignments' => $this->assignment_model->all_assignments(),
			-			'id' => $assignment_id,
			-			'name' => $assignment['name']
			-		);
			+        $data = array(
			+            'all_assignments' => $this->assignment_model->all_assignments(),
			+            'id' => $assignment_id,
			+            'name' => $assignment['name']
			+        );
			
			-		$this->twig->display('pages/admin/delete_assignment.twig', $data);
			+        $this->twig->display('pages/admin/delete_assignment.twig', $data);
			
			-	}
		+    }
	
	
	
	-	// ------------------------------------------------------------------------
	+    // ------------------------------------------------------------------------
	
	
	-	/**
	-	 * This method gets inputs from user for adding/editing assignment
	-	 */
	-	public function add()
	-	{
		+    /**
		+     * This method gets inputs from user for adding/editing assignment
		+     */
		+    public function add()
		+    {
			
			-		if ($this->user->level <= 1) // permission denied
			-			show_404();
			+        if ($this->user->level <= 1) { // permission denied
				+            show_404();
				+        }
			
			-		$this->load->library('upload');
			+        $this->load->library('upload');
			
			-		if ( ! empty($_POST) )
			-			if ($this->_add()) // add/edit assignment
			-			{
				-				//if ( ! $this->edit) // if adding assignment (not editing)
				-				//{
					-				//   goto Assignments page
					-					$this->index();
					-					return;
					-				//}
				-			}
			+        if (! empty($_POST)) {
				+            if ($this->_add()) { // add/edit assignment
					+                //if ( ! $this->edit) // if adding assignment (not editing)
					+                //{
						+                //   goto Assignments page
						+                $this->index();
						+                return;
						+                //}
					+            }
				+        }
			
			-		$data = array(
			-			'all_assignments' => $this->assignment_model->all_assignments(),
			-			'messages' => $this->messages,
			-			'edit' => $this->edit,
			-			'default_late_rule' => $this->settings_model->get_setting('default_late_rule'),
			-		);
			+        $data = array(
			+            'all_assignments' => $this->assignment_model->all_assignments(),
			+            'messages' => $this->messages,
			+            'edit' => $this->edit,
			+            'default_late_rule' => $this->settings_model->get_setting('default_late_rule'),
			+        );
			
			-		if ($this->edit)
			-		{
				-			$data['edit_assignment'] = $this->assignment_model->assignment_info($this->edit_assignment);
				-			if ($data['edit_assignment']['id'] === 0)
				-				show_404();
				-			$data['problems'] = $this->assignment_model->all_problems($this->edit_assignment);
				-		}
			-		else
			-		{
				-			$names = $this->input->post('name');
				-			if ($names === NULL)
				-				$data['problems'] = array(
				-					array(
				-						'id' => 1,
				-						'name' => 'Problem ',
				-						'score' => 100,
				-						'c_time_limit' => 500,
				-						'python_time_limit' => 1500,
				-						'java_time_limit' => 2000,
				-						'memory_limit' => 50000,
				-						'allowed_languages' => 'C,C++,Python 2,Python 3,Java',
				-						'diff_cmd' => 'diff',
				-						'diff_arg' => '-bB',
				-						'is_upload_only' => 0
				-					)
				-				);
				-			else
				-			{
					-				$names = $this->input->post('name');
					-				$scores = $this->input->post('score');
					-				$c_tl = $this->input->post('c_time_limit');
					-				$py_tl = $this->input->post('python_time_limit');
					-				$java_tl = $this->input->post('java_time_limit');
					-				$ml = $this->input->post('memory_limit');
					-				$ft = $this->input->post('languages');
					-				$dc = $this->input->post('diff_cmd');
					-				$da = $this->input->post('diff_arg');
					-				$data['problems'] = array();
					-				$uo = $this->input->post('is_upload_only');
					-				if ($uo === NULL)
					-					$uo = array();
					-				for ($i=0; $i<count($names); $i++){
						-					array_push($data['problems'], array(
						-						'id' => $i+1,
						-						'name' => $names[$i],
						-						'score' => $scores[$i],
						-						'c_time_limit' => $c_tl[$i],
						-						'python_time_limit' => $py_tl[$i],
						-						'java_time_limit' => $java_tl[$i],
						-						'memory_limit' => $ml[$i],
						-						'allowed_languages' => $ft[$i],
						-						'diff_cmd' => $dc[$i],
						-						'diff_arg' => $da[$i],
						-						'is_upload_only' => in_array($i+1,$uo)?1:0,
						-					));
						-				}
					-			}
				-		}
			+        if ($this->edit) {
				+            $data['edit_assignment'] = $this->assignment_model->assignment_info($this->edit_assignment);
				+            if ($data['edit_assignment']['id'] === 0) {
					+                show_404();
					+            }
				+            $data['problems'] = $this->assignment_model->all_problems($this->edit_assignment);
				+        } else {
				+            $names = $this->input->post('name');
				+            if ($names === null) {
					+                $data['problems'] = array(
					+                    array(
					+                        'id' => 1,
					+                        'name' => 'Problem ',
					+                        'score' => 100,
					+                        'c_time_limit' => 500,
					+                        'python_time_limit' => 1500,
					+                        'java_time_limit' => 2000,
					+                        'memory_limit' => 50000,
					+                        'allowed_languages' => 'C,C++,Python 2,Python 3,Java',
					+                        'diff_cmd' => 'diff',
					+                        'diff_arg' => '-bB',
					+                        'is_upload_only' => 0
					+                    )
					+                );
					+            } else {
					+                $names = $this->input->post('name');
					+                $scores = $this->input->post('score');
					+                $c_tl = $this->input->post('c_time_limit');
					+                $py_tl = $this->input->post('python_time_limit');
					+                $java_tl = $this->input->post('java_time_limit');
					+                $ml = $this->input->post('memory_limit');
					+                $ft = $this->input->post('languages');
					+                $dc = $this->input->post('diff_cmd');
					+                $da = $this->input->post('diff_arg');
					+                $data['problems'] = array();
					+                $uo = $this->input->post('is_upload_only');
					+                if ($uo === null) {
						+                    $uo = array();
						+                }
					+                for ($i = 0; $i < count($names); $i++) {
						+                    array_push($data['problems'], array(
						+                        'id' => $i + 1,
						+                        'name' => $names[$i],
						+                        'score' => $scores[$i],
						+                        'c_time_limit' => $c_tl[$i],
						+                        'python_time_limit' => $py_tl[$i],
						+                        'java_time_limit' => $java_tl[$i],
						+                        'memory_limit' => $ml[$i],
						+                        'allowed_languages' => $ft[$i],
						+                        'diff_cmd' => $dc[$i],
						+                        'diff_arg' => $da[$i],
						+                        'is_upload_only' => in_array($i + 1, $uo) ? 1 : 0,
						+                    ));
						+                }
					+            }
				+        }
			
			-		$this->twig->display('pages/admin/add_assignment.twig', $data);
			-	}
		+        $this->twig->display('pages/admin/add_assignment.twig', $data);
		+    }
	
	
	-	// ------------------------------------------------------------------------
	+    // ------------------------------------------------------------------------
	
	
	-	/**
	-	 * Add/Edit assignment
	-	 */
	-	private function _add()
	-	{
		+    /**
		+     * Add/Edit assignment
		+     */
		+    private function _add()
		+    {
			
			-		// Check permission
			+        // Check permission
			
			-		if ($this->user->level <= 1) // permission denied
			-			show_404();
			+        if ($this->user->level <= 1) { // permission denied
				+            show_404();
				+        }
			
			-		$this->form_validation->set_rules('assignment_name', 'assignment name', 'required|max_length[50]');
			-		$this->form_validation->set_rules('start_time', 'start time', 'required');
			-		$this->form_validation->set_rules('finish_time', 'finish time', 'required');
			-		$this->form_validation->set_rules('extra_time', 'extra time', 'required');
			-		$this->form_validation->set_rules('participants', 'participants', '');
			-		$this->form_validation->set_rules('late_rule', 'coefficient rule', 'required');
			-		$this->form_validation->set_rules('name[]', 'problem name', 'required|max_length[50]');
			-		$this->form_validation->set_rules('score[]', 'problem score', 'required|integer');
			-		$this->form_validation->set_rules('c_time_limit[]', 'C/C++ time limit', 'required|integer');
			-		$this->form_validation->set_rules('python_time_limit[]', 'python time limit', 'required|integer');
			-		$this->form_validation->set_rules('java_time_limit[]', 'java time limit', 'required|integer');
			-		$this->form_validation->set_rules('memory_limit[]', 'memory limit', 'required|integer');
			-		$this->form_validation->set_rules('languages[]', 'languages', 'required');
			-		$this->form_validation->set_rules('diff_cmd[]', 'diff command', 'required');
			-		$this->form_validation->set_rules('diff_arg[]', 'diff argument', 'required');
			+        $this->form_validation->set_rules('assignment_name', 'assignment name', 'required|max_length[50]');
			+        $this->form_validation->set_rules('start_time', 'start time', 'required');
			+        $this->form_validation->set_rules('finish_time', 'finish time', 'required');
			+        $this->form_validation->set_rules('extra_time', 'extra time', 'required');
			+        $this->form_validation->set_rules('participants', 'participants', '');
			+        $this->form_validation->set_rules('late_rule', 'coefficient rule', 'required');
			+        $this->form_validation->set_rules('name[]', 'problem name', 'required|max_length[50]');
			+        $this->form_validation->set_rules('score[]', 'problem score', 'required|integer');
			+        $this->form_validation->set_rules('c_time_limit[]', 'C/C++ time limit', 'required|integer');
			+        $this->form_validation->set_rules('python_time_limit[]', 'python time limit', 'required|integer');
			+        $this->form_validation->set_rules('java_time_limit[]', 'java time limit', 'required|integer');
			+        $this->form_validation->set_rules('memory_limit[]', 'memory limit', 'required|integer');
			+        $this->form_validation->set_rules('languages[]', 'languages', 'required');
			+        $this->form_validation->set_rules('diff_cmd[]', 'diff command', 'required');
			+        $this->form_validation->set_rules('diff_arg[]', 'diff argument', 'required');
			
			-		// Validate input data
			+        // Validate input data
			
			-		if ( ! $this->form_validation->run())
			-			return FALSE;
			+        if (! $this->form_validation->run()) {
				+            return false;
				+        }
			
			
			-		// Preparing variables
			+        // Preparing variables
			
			-		if ($this->edit)
			-			$the_id = $this->edit_assignment;
			-		else
			-			$the_id = $this->assignment_model->new_assignment_id();
			+        if ($this->edit) {
				+            $the_id = $this->edit_assignment;
				+        } else {
				+            $the_id = $this->assignment_model->new_assignment_id();
				+        }
			
			-		$assignments_root = rtrim($this->settings_model->get_setting('assignments_root'), '/');
			-		$assignment_dir = "$assignments_root/assignment_{$the_id}";
			+        $assignments_root = rtrim($this->settings_model->get_setting('assignments_root'), '/');
			+        $assignment_dir = "$assignments_root/assignment_{$the_id}";
			
			
			
			-		// Adding/Editing assignment in database
			+        // Adding/Editing assignment in database
			
			-		if ( ! $this->assignment_model->add_assignment($the_id, $this->edit))
			-		{
				-			$this->messages[] = array(
				-				'type' => 'error',
				-				'text' => 'Error '.($this->edit?'updating':'adding').' assignment.'
				-			);
				-			return FALSE;
				-		}
			+        if (! $this->assignment_model->add_assignment($the_id, $this->edit)) {
				+            $this->messages[] = array(
				+                'type' => 'error',
				+                'text' => 'Error '.($this->edit ? 'updating' : 'adding').' assignment.'
				+            );
				+            return false;
				+        }
			
			-		$this->messages[] = array(
			-			'type' => 'success',
			-			'text' => 'Assignment '.($this->edit?'updated':'added').' successfully.'
			-		);
			+        $this->messages[] = array(
			+            'type' => 'success',
			+            'text' => 'Assignment '.($this->edit ? 'updated' : 'added').' successfully.'
			+        );
			
			-		// Create assignment directory
			-		if ( ! file_exists($assignment_dir) )
			-			mkdir($assignment_dir, 0700);
			+        // Create assignment directory
			+        if (! file_exists($assignment_dir)) {
				+            mkdir($assignment_dir, 0700);
				+        }
			
			
			
			-		// Upload Tests (zip file)
			-		unlink($assignments_root.'/*.zip');
			-		$config = array(
			-			'upload_path' => $assignments_root,
			-			'allowed_types' => 'zip',
			-		);
			-		$this->upload->initialize($config);
			-		$zip_uploaded = $this->upload->do_upload('tests_desc');
			-		$u_data = $this->upload->data();
			-		if ( $_FILES['tests_desc']['error'] === UPLOAD_ERR_NO_FILE )
			-			$this->messages[] = array(
			-				'type' => 'notice',
			-				'text' => "Notice: You did not upload any zip file for tests. If needed, upload by editing assignment."
			-			);
			-		elseif ( ! $zip_uploaded )
			-			$this->messages[] = array(
			-				'type' => 'error',
			-				'text' => "Error: Error uploading tests zip file: ".$this->upload->display_errors('', '')
			-			);
			-		else
			-			$this->messages[] = array(
			-				'type' => 'success',
			-				'text' => "Tests (zip file) uploaded successfully."
			-			);
			+        // Upload Tests (zip file)
			+        unlink($assignments_root.'/*.zip');
			+        $config = array(
			+            'upload_path' => $assignments_root,
			+            'allowed_types' => 'zip',
			+        );
			+        $this->upload->initialize($config);
			+        $zip_uploaded = $this->upload->do_upload('tests_desc');
			+        $u_data = $this->upload->data();
			+        if ($_FILES['tests_desc']['error'] === UPLOAD_ERR_NO_FILE) {
				+            $this->messages[] = array(
				+                'type' => 'notice',
				+                'text' => "Notice: You did not upload any zip file for tests. If needed, upload by editing assignment."
				+            );
				+        } elseif (! $zip_uploaded) {
				+            $this->messages[] = array(
				+                'type' => 'error',
				+                'text' => "Error: Error uploading tests zip file: ".$this->upload->display_errors('', '')
				+            );
				+        } else {
				+            $this->messages[] = array(
				+                'type' => 'success',
				+                'text' => "Tests (zip file) uploaded successfully."
				+            );
				+        }
			
			
			
			-		// Upload PDF File of Assignment
			+        // Upload PDF File of Assignment
			
			-		$config = array(
			-			'upload_path' => $assignment_dir,
			-			'allowed_types' => 'pdf',
			-		);
			-		$this->upload->initialize($config);
			-		$old_pdf_files = glob("$assignment_dir/*.pdf");
			-		$pdf_uploaded = $this->upload->do_upload("pdf");
			-		if ($_FILES['pdf']['error'] === UPLOAD_ERR_NO_FILE)
			-			$this->messages[] = array(
			-				'type' => 'notice',
			-				'text' => "Notice: You did not upload any pdf file for assignment. If needed, upload by editing assignment."
			-			);
			-		elseif ( ! $pdf_uploaded)
			-			$this->messages[] = array(
			-				'type' => 'error',
			-				'text' => "Error: Error uploading pdf file of assignment: ".$this->upload->display_errors('', '')
			-			);
			-		else
			-		{
				-			foreach($old_pdf_files as $old_name)
				-				unlink($old_name);
				-			$this->messages[] = array(
				-				'type' => 'success',
				-				'text' => 'PDF file uploaded successfully.'
				-			);
				-		}
			+        $config = array(
			+            'upload_path' => $assignment_dir,
			+            'allowed_types' => 'pdf',
			+        );
			+        $this->upload->initialize($config);
			+        $old_pdf_files = glob("$assignment_dir/*.pdf");
			+        $pdf_uploaded = $this->upload->do_upload("pdf");
			+        if ($_FILES['pdf']['error'] === UPLOAD_ERR_NO_FILE) {
				+            $this->messages[] = array(
				+                'type' => 'notice',
				+                'text' => "Notice: You did not upload any pdf file for assignment. If needed, upload by editing assignment."
				+            );
				+        } elseif (! $pdf_uploaded) {
				+            $this->messages[] = array(
				+                'type' => 'error',
				+                'text' => "Error: Error uploading pdf file of assignment: ".$this->upload->display_errors('', '')
				+            );
				+        } else {
				+            foreach($old_pdf_files as $old_name) {
					+                unlink($old_name);
					+            }
				+            $this->messages[] = array(
				+                'type' => 'success',
				+                'text' => 'PDF file uploaded successfully.'
				+            );
				+        }
			
			
			
			-		// Extract Tests (zip file)
			+        // Extract Tests (zip file)
			
			-		if ($zip_uploaded) // if zip file is uploaded
			-		{
				-			// Create a temp directory
				-			$tmp_dir_name = "shj_tmp_directory";
				-			$tmp_dir = "$assignments_root/$tmp_dir_name";
				-			shell_exec("rm -rf $tmp_dir; mkdir $tmp_dir;");
				+        if ($zip_uploaded) { // if zip file is uploaded
					+            // Create a temp directory
					+            $tmp_dir_name = "shj_tmp_directory";
					+            $tmp_dir = "$assignments_root/$tmp_dir_name";
					+            shell_exec("rm -rf $tmp_dir; mkdir $tmp_dir;");
					
					-			// Extract new test cases and descriptions in temp directory
					-			$this->load->library('unzip');
					-			$this->unzip->allow(array('txt', 'cpp', 'html', 'md', 'pdf'));
					-			$extract_result = $this->unzip->extract($u_data['full_path'], $tmp_dir);
					+            // Extract new test cases and descriptions in temp directory
					+            $this->load->library('unzip');
					+            $this->unzip->allow(array('txt', 'cpp', 'html', 'md', 'pdf'));
					+            $extract_result = $this->unzip->extract($u_data['full_path'], $tmp_dir);
					
					-			// Remove the zip file
					-			unlink($u_data['full_path']);
					+            // Remove the zip file
					+            unlink($u_data['full_path']);
					
					-			if ( $extract_result )
					-			{
						-				// Remove previous test cases and descriptions
						-				shell_exec("cd $assignment_dir;"
						-					." rm -rf */in; rm -rf */out; rm -f */tester.cpp; rm -f */tester.executable;"
						-					." rm -f */desc.html; rm -f */desc.md; rm -f */*.pdf;");
						-				if (glob("$tmp_dir/*.pdf"))
						-					shell_exec("cd $assignment_dir; rm -f *.pdf");
						-				// Copy new test cases from temp dir
						-				shell_exec("cd $assignments_root; cp -R $tmp_dir_name/* assignment_{$the_id};");
						-				$this->messages[] = array(
						-					'type' => 'success',
						-					'text' => 'Tests (zip file) extracted successfully.'
						-				);
						-			}
					-			else
					-			{
						-				$this->messages[] = array(
						-					'type' => 'error',
						-					'text' => 'Error: Error extracting zip archive.'
						-				);
						-				foreach($this->unzip->errors_array() as $msg)
						-					$this->messages[] = array(
						-						'type' => 'error',
						-						'text' => " Zip Extraction Error: ".$msg
						-					);
						-			}
					+            if ($extract_result) {
						+                // Remove previous test cases and descriptions
						+                shell_exec("cd $assignment_dir;"
						+                    ." rm -rf */in; rm -rf */out; rm -f */tester.cpp; rm -f */tester.executable;"
						+                    ." rm -f */desc.html; rm -f */desc.md; rm -f */*.pdf;");
						+                if (glob("$tmp_dir/*.pdf")) {
							+                    shell_exec("cd $assignment_dir; rm -f *.pdf");
							+                }
						+                // Copy new test cases from temp dir
						+                shell_exec("cd $assignments_root; cp -R $tmp_dir_name/* assignment_{$the_id};");
						+                $this->messages[] = array(
						+                    'type' => 'success',
						+                    'text' => 'Tests (zip file) extracted successfully.'
						+                );
						+            } else {
						+                $this->messages[] = array(
						+                    'type' => 'error',
						+                    'text' => 'Error: Error extracting zip archive.'
						+                );
						+                foreach($this->unzip->errors_array() as $msg) {
							+                    $this->messages[] = array(
							+                        'type' => 'error',
							+                        'text' => " Zip Extraction Error: ".$msg
							+                    );
							+                }
						+            }
					
					-			// Remove temp directory
					-			shell_exec("rm -rf $tmp_dir");
					-		}
				+            // Remove temp directory
				+            shell_exec("rm -rf $tmp_dir");
				+        }
			
			
			
			-		// Create problem directories and parsing markdown files
			+        // Create problem directories and parsing markdown files
			
			-		for ($i=1; $i <= $this->input->post('number_of_problems'); $i++)
			-		{
				-			if ( ! file_exists("$assignment_dir/p$i"))
				-				mkdir("$assignment_dir/p$i", 0700);
				-			elseif (file_exists("$assignment_dir/p$i/desc.md"))
				-			{
					-				$this->load->library('parsedown');
					-				$html = $this->parsedown->parse(file_get_contents("$assignment_dir/p$i/desc.md"));
					-				file_put_contents("$assignment_dir/p$i/desc.html", $html);
					-			}
				-		}
			+        for ($i = 1; $i <= $this->input->post('number_of_problems'); $i++) {
				+            if (! file_exists("$assignment_dir/p$i")) {
					+                mkdir("$assignment_dir/p$i", 0700);
					+            } elseif (file_exists("$assignment_dir/p$i/desc.md")) {
					+                $this->load->library('parsedown');
					+                $html = $this->parsedown->parse(file_get_contents("$assignment_dir/p$i/desc.md"));
					+                file_put_contents("$assignment_dir/p$i/desc.html", $html);
					+            }
				+        }
			
			-		return TRUE;
			-	}
		+        return true;
		+    }
	
	
	-	// ------------------------------------------------------------------------
	+    // ------------------------------------------------------------------------
	
	
	-	public function edit($assignment_id)
	-	{
		+    public function edit($assignment_id)
		+    {
			
			-		if ($this->user->level <= 1) // permission denied
			-			show_404();
			+        if ($this->user->level <= 1) { // permission denied
				+            show_404();
				+        }
			
			-		$this->edit_assignment = $assignment_id;
			-		$this->edit = TRUE;
			+        $this->edit_assignment = $assignment_id;
			+        $this->edit = true;
			
			-		// redirect to add function
			-		$this->add();
			-	}
		-	
		+        // redirect to add function
		+        $this->add();
		+    }
	
	
	-	// ------------------------------------------------------------------------
	
	+    // ------------------------------------------------------------------------
	
	
	-	/**
	-	 * Check PDF File Availability
	-	 */
	-	public function pdfCheck($assignment_id, $problem_id = NULL)
	-	{
		-		$finishtime = strtotime($this->assignment_model->assignment_info($assignment_id)['finish_time']);
		-		$starttime = strtotime($this->assignment_model->assignment_info($assignment_id)['start_time']);
		-		$extratime = $this->assignment_model->assignment_info($assignment_id)['extra_time'];
		
		-		// Find pdf file
		-		if ($problem_id === NULL || $problem_id === "null")
		-			$pattern = rtrim($this->settings_model->get_setting('assignments_root'),'/')."/assignment_{$assignment_id}/*.pdf";
		-		else
		-			$pattern = rtrim($this->settings_model->get_setting('assignments_root'),'/')."/assignment_{$assignment_id}/p{$problem_id}/*.pdf";
		-		$pdf_files = glob($pattern);
		+    /**
		+     * Check PDF File Availability
		+     */
		+    public function pdfCheck($assignment_id, $problem_id = null)
		+    {
			+        $finishtime = strtotime($this->assignment_model->assignment_info($assignment_id)['finish_time']);
			+        $starttime = strtotime($this->assignment_model->assignment_info($assignment_id)['start_time']);
			+        $extratime = $this->assignment_model->assignment_info($assignment_id)['extra_time'];
			
			-		if ( ! $pdf_files )
			-			$response = json_encode(array(status=>FALSE));
			-		elseif (!$this->assignment_model->assignment_info($assignment_id)['open'])
			-			$response = json_encode(array(status=>FALSE));
			-		elseif	( ! $this->assignment_model->is_participant($this->assignment_model->assignment_info($assignment_id)['participants'],$this->user->username) )
			-			$response = json_encode(array(status=>FALSE));
			-		elseif ( shj_now() > $finishtime + $extratime)
			-			$response = json_encode(array(status=>FALSE));
			-		elseif ( shj_now() < $starttime)
			-			$response = json_encode(array(status=>FALSE));
			-		else
			-			$response = json_encode(array(status=>TRUE));
			+        // Find pdf file
			+        if ($problem_id === null || $problem_id === "null") {
				+            $pattern = rtrim($this->settings_model->get_setting('assignments_root'), '/')."/assignment_{$assignment_id}/*.pdf";
				+        } else {
				+            $pattern = rtrim($this->settings_model->get_setting('assignments_root'), '/')."/assignment_{$assignment_id}/p{$problem_id}/*.pdf";
				+        }
			+        $pdf_files = glob($pattern);
			
			-		echo $response;
			-	}
		+        if (! $pdf_files) {
			+            $response = json_encode(array(status => false));
			+        } elseif (!$this->assignment_model->assignment_info($assignment_id)['open']) {
			+            $response = json_encode(array(status => false));
			+        } elseif	(! $this->assignment_model->is_participant($this->assignment_model->assignment_info($assignment_id)['participants'], $this->user->username)) {
			+            $response = json_encode(array(status => false));
			+        } elseif (shj_now() > $finishtime + $extratime) {
			+            $response = json_encode(array(status => false));
			+        } elseif (shj_now() < $starttime) {
			+            $response = json_encode(array(status => false));
			+        } else {
			+            $response = json_encode(array(status => true));
			+        }
		+
		+        echo $response;
		+    }
	
}

----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Dashboard.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/controllers/Dashboard.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Dashboard.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Dashboard.php
	@@ -4,66 +4,70 @@
	* @file Dashboard.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Dashboard extends CI_Controller
	{
		+    public function __construct()
		+    {
			+        parent::__construct();
			+        if (! $this->db->table_exists('sessions')) {
				+            redirect('install');
				+        }
			+        if (! $this->session->userdata('logged_in')) { // if not logged in
				+            redirect('login');
				+        }
			+        $this->load->model('notifications_model')->helper('text');
			+    }
		
		
		-       public function __construct()
		-       {
			-               parent::__construct();
			-               if ( ! $this->db->table_exists('sessions'))
			-                       redirect('install');
			-               if ( ! $this->session->userdata('logged_in')) // if not logged in
			-                       redirect('login');
			-               $this->load->model('notifications_model')->helper('text');
			-       }
		+    // ------------------------------------------------------------------------
		
		
		-       // ------------------------------------------------------------------------
		+    public function index()
		+    {
			+        $data = array(
			+            'all_assignments' => $this->assignment_model->all_assignments(),
			+            'week_start' => $this->settings_model->get_setting('week_start'),
			+            'wp' => $this->user->get_widget_positions(),
			+            'notifications' => $this->notifications_model->get_latest_notifications()
			+        );
			
			+        // detecting errors:
			+        $data['errors'] = array();
			+        if($this->user->level === 3) {
				+            $path = $this->settings_model->get_setting('assignments_root');
				+            if (! file_exists($path)) {
					+                array_push($data['errors'], 'The path to folder "assignments" is not set correctly. Move this folder somewhere not publicly accessible, and set its full path in Settings.');
					+            } elseif (! is_writable($path)) {
					+                array_push($data['errors'], 'The folder <code>"'.$path.'"</code> is not writable by PHP. Make it writable. But make sure that this folder is only accessible by you. Codes will be saved in this folder!');
					+            }
				
				-       public function index()
				-       {
					-               $data = array(
					-                       'all_assignments'=>$this->assignment_model->all_assignments(),
					-                       'week_start'=>$this->settings_model->get_setting('week_start'),
					-                       'wp'=>$this->user->get_widget_positions(),
					-                       'notifications' => $this->notifications_model->get_latest_notifications()
					-               );
					+            $path = $this->settings_model->get_setting('tester_path');
					+            if (! file_exists($path)) {
						+                array_push($data['errors'], 'The path to folder "tester" is not set correctly. Move this folder somewhere not publicly accessible, and set its full path in Settings.');
						+            } elseif (! is_writable($path)) {
						+                array_push($data['errors'], 'The folder <code>"'.$path.'"</code> is not writable by PHP. Make it writable. But make sure that this folder is only accessible by you.');
						+            }
					+        }
				
				-               // detecting errors:
				-               $data['errors'] = array();
				-               if($this->user->level === 3){
					-                       $path = $this->settings_model->get_setting('assignments_root');
					-                       if ( ! file_exists($path))
					-                               array_push($data['errors'], 'The path to folder "assignments" is not set correctly. Move this folder somewhere not publicly accessible, and set its full path in Settings.');
					-                       elseif ( ! is_writable($path))
					-                               array_push($data['errors'], 'The folder <code>"'.$path.'"</code> is not writable by PHP. Make it writable. But make sure that this folder is only accessible by you. Codes will be saved in this folder!');
					+        $this->twig->display('pages/dashboard.twig', $data);
					+    }
				
				-                       $path = $this->settings_model->get_setting('tester_path');
				-                       if ( ! file_exists($path))
				-                               array_push($data['errors'], 'The path to folder "tester" is not set correctly. Move this folder somewhere not publicly accessible, and set its full path in Settings.');
				-                       elseif ( ! is_writable($path))
				-                               array_push($data['errors'], 'The folder <code>"'.$path.'"</code> is not writable by PHP. Make it writable. But make sure that this folder is only accessible by you.');
				-               }
			
			-               $this->twig->display('pages/dashboard.twig', $data);
			-       }
		+    // ------------------------------------------------------------------------
		
		+    /**
		+     * Used by ajax request, for saving the user's Dashboard widget positions
		+     */
		+    public function widget_positions()
		+    {
			+        if (! $this->input->is_ajax_request()) {
				+            show_404();
				+        }
			+        if ($this->input->post('positions') !== null) {
				+            $this->user->save_widget_positions($this->input->post('positions'));
				+        }
			+    }
		
		-       // ------------------------------------------------------------------------
		-
		-       /**
		-        * Used by ajax request, for saving the user's Dashboard widget positions
		-        */
		-       public function widget_positions()
		-       {
			-               if ( ! $this->input->is_ajax_request() )
			-                       show_404();
			-               if ($this->input->post('positions') !== NULL)
			-                       $this->user->save_widget_positions($this->input->post('positions'));
			-       }
		-
		-}
	\ No newline at end of file
	+}

----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Halloffame.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/controllers/Halloffame.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Halloffame.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Halloffame.php
	@@ -4,56 +4,56 @@
	* @file Halloffame.php
	* @author Stillmen Vallian <stillmen.v@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Halloffame extends CI_Controller
	{
		+    public function __construct()
		+    {
			+        parent::__construct();
			+        if (! $this->session->userdata('logged_in')) { // if not logged in
				+            redirect('login');
				+        }
			+        $this->load->model('hof_model');
			+    }
		
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-		if ( ! $this->session->userdata('logged_in')) // if not logged in
			-			redirect('login');
			-		$this->load->model('hof_model');
			-	}
		
		
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		
		
		+    public function index()
		+    {
			+        $data = array(
			+            'hofs' => $this->hof_model->get_all_final_submission()
			+        );
			+        $this->twig->display('pages/halloffame.twig', $data);
			+    }
		
		
		-	public function index()
		-	{
			-		$data = array(
			-			'hofs' => $this->hof_model->get_all_final_submission()
			-		);
			-		$this->twig->display('pages/halloffame.twig', $data);
			-	}
		
		
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Controller for shows the details of the score
		+     * Called by ajax request
		+     */
		+    public function hof_details()
		+    {
			+        if (! $this->input->is_ajax_request()) {
				+            show_404();
				+        }
			+        $username = $this->input->post('username');
			
			+        $json_result = $this->hof_model->get_all_user_assignments($username);
			
			-	/**
			-	 * Controller for shows the details of the score
			-	 * Called by ajax request
			-	 */
			-	public function hof_details()
			-	{
				-		if ( ! $this->input->is_ajax_request() )
				-			show_404();
				-		$username = $this->input->post('username');
				-
				-		$json_result = $this->hof_model->get_all_user_assignments($username);
				-
				-		$this->output->set_header('Content-Type: application/json; charset=utf-8');
				-		echo json_encode($json_result);
				-	}
			+        $this->output->set_header('Content-Type: application/json; charset=utf-8');
			+        echo json_encode($json_result);
			+    }
	}
	
	----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Install.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/controllers/Install.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Install.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Install.php
	@@ -4,290 +4,304 @@
	* @file Install.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Install extends CI_Controller
	{
		+    public function __construct()
		+    {
			+        parent::__construct();
			+        $this->load->helper('string');
			+    }
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-		$this->load->helper('string');
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function index()
		+    {
			
			-	public function index()
			-	{
				
				+        if ($this->db->table_exists('sessions')) {
					+            show_error('SharIF Judge is already installed.');
					+        }
				
				-		if ($this->db->table_exists('sessions'))
				-			show_error('SharIF Judge is already installed.');
				+        $this->form_validation->set_rules('username', 'username', 'required|min_length[3]|max_length[20]|alpha_numeric|lowercase');
				+        $this->form_validation->set_rules('email', 'email', 'required|max_length[40]|valid_email|lowercase');
				+        $this->form_validation->set_rules('password', 'password', 'required|min_length[6]|max_length[200]');
				+        $this->form_validation->set_rules('password_again', 'password confirmation', 'required|matches[password]');
				
				-		$this->form_validation->set_rules('username', 'username', 'required|min_length[3]|max_length[20]|alpha_numeric|lowercase');
				-		$this->form_validation->set_rules('email', 'email', 'required|max_length[40]|valid_email|lowercase');
				-		$this->form_validation->set_rules('password', 'password', 'required|min_length[6]|max_length[200]');
				-		$this->form_validation->set_rules('password_again', 'password confirmation', 'required|matches[password]');
				+        $data['installed'] = false;
				
				-		$data['installed'] = FALSE;
				+        if ($this->form_validation->run()) {
					
					-		if ($this->form_validation->run()) {
						+            $DATETIME = 'DATETIME';
						+            if ($this->db->dbdriver === 'postgre') {
							+                $DATETIME = 'TIMESTAMP';
							+            }
						
						-			$DATETIME = 'DATETIME';
						-			if ($this->db->dbdriver === 'postgre')
						-				$DATETIME = 'TIMESTAMP';
						
						+            $this->load->dbforge();
						
						-			$this->load->dbforge();
						
						+            // Use InnoDB engine for MySql database
						+            if ($this->db->dbdriver === 'mysql' || $this->db->dbdriver === 'mysqli') {
							+                $this->db->query('SET storage_engine=InnoDB;');
							+            }
						
						-			// Use InnoDB engine for MySql database
						-			if ($this->db->dbdriver === 'mysql' || $this->db->dbdriver === 'mysqli')
						-				$this->db->query('SET storage_engine=InnoDB;');
						+            // Creating Tables:
						+            // sessions, submissions, assignments, notifications, problems, queue, scoreboard, settings, users
						
						-			// Creating Tables:
						-			// sessions, submissions, assignments, notifications, problems, queue, scoreboard, settings, users
						
						+            // create table 'sessions'
						+            $fields = array(
						+                'session_id'    => array('type' => 'VARCHAR', 'constraint' => 40, 'default' => '0'),
						+                'ip_address'    => array('type' => 'VARCHAR', 'constraint' => 45, 'default' => '0'),
						+                'user_agent'    => array('type' => 'VARCHAR', 'constraint' => 120),
						+                'last_activity' => array('type' => 'INT', 'constraint' => 10, 'unsigned' => true, 'default' => '0'),
						+                'user_data'     => array('type' => 'TEXT'),
						+            );
						+            $this->dbforge->add_field($fields);
						+            $this->dbforge->add_key('session_id', true); // PRIMARY KEY
						+            $this->dbforge->add_key('last_activity');
						+            if (! $this->dbforge->create_table('sessions', true)) {
							+                show_error("Error creating database table ".$this->db->dbprefix('sessions'));
							+            }
						
						-			// create table 'sessions'
						-			$fields = array(
						-				'session_id'    => array('type' => 'VARCHAR', 'constraint' => 40, 'default' => '0'),
						-				'ip_address'    => array('type' => 'VARCHAR', 'constraint' => 45, 'default' => '0'),
						-				'user_agent'    => array('type' => 'VARCHAR', 'constraint' => 120),
						-				'last_activity' => array('type' => 'INT', 'constraint' => 10, 'unsigned' => TRUE, 'default' => '0'),
						-				'user_data'     => array('type' => 'TEXT'),
						-			);
						-			$this->dbforge->add_field($fields);
						-			$this->dbforge->add_key('session_id', TRUE); // PRIMARY KEY
						-			$this->dbforge->add_key('last_activity');
						-			if ( ! $this->dbforge->create_table('sessions', TRUE))
						-				show_error("Error creating database table ".$this->db->dbprefix('sessions'));
						
						
						+            // create table 'submissions'
						+            $fields = array(
						+                'submit_id'     => array('type' => 'INT', 'constraint' => 11, 'unsigned' => true),
						+                'username'      => array('type' => 'VARCHAR', 'constraint' => 20),
						+                'assignment'    => array('type' => 'SMALLINT', 'constraint' => 4, 'unsigned' => true),
						+                'problem'       => array('type' => 'SMALLINT', 'constraint' => 4, 'unsigned' => true),
						+                'is_final'      => array('type' => 'TINYINT', 'constraint' => 1, 'default' => 0),
						+                'time'          => array('type' => $DATETIME),
						+                'status'        => array('type' => 'VARCHAR', 'constraint' => 100),
						+                'pre_score'     => array('type' => 'INT', 'constraint' => 11),
						+                'coefficient'   => array('type' => 'VARCHAR', 'constraint' => 6),
						+                'file_name'     => array('type' => 'VARCHAR', 'constraint' => 100),
						+                'main_file_name' => array('type' => 'VARCHAR', 'constraint' => 100),
						+                'file_type'     => array('type' => 'VARCHAR', 'constraint' => 6),
						+            );
						+            $this->dbforge->add_field($fields);
						+            $this->dbforge->add_key(array('assignment', 'submit_id'));
						+            if (! $this->dbforge->create_table('submissions', true)) {
							+                show_error("Error creating database table ".$this->db->dbprefix('submissions'));
							+            }
						
						-			// create table 'submissions'
						-			$fields = array(
						-				'submit_id'     => array('type' => 'INT', 'constraint' => 11, 'unsigned' => TRUE),
						-				'username'      => array('type' => 'VARCHAR', 'constraint' => 20),
						-				'assignment'    => array('type' => 'SMALLINT', 'constraint' => 4, 'unsigned' => TRUE),
						-				'problem'       => array('type' => 'SMALLINT', 'constraint' => 4, 'unsigned' => TRUE),
						-				'is_final'      => array('type' => 'TINYINT', 'constraint' => 1, 'default' => 0),
						-				'time'          => array('type' => $DATETIME),
						-				'status'        => array('type' => 'VARCHAR', 'constraint' => 100),
						-				'pre_score'     => array('type' => 'INT', 'constraint' => 11),
						-				'coefficient'   => array('type' => 'VARCHAR', 'constraint' => 6),
						-				'file_name'     => array('type' => 'VARCHAR', 'constraint' => 100),
						-				'main_file_name'=> array('type' => 'VARCHAR', 'constraint' => 100),
						-				'file_type'     => array('type' => 'VARCHAR', 'constraint' => 6),
						-			);
						-			$this->dbforge->add_field($fields);
						-			$this->dbforge->add_key(array('assignment', 'submit_id'));
						-			if ( ! $this->dbforge->create_table('submissions', TRUE))
						-				show_error("Error creating database table ".$this->db->dbprefix('submissions'));
						
						
						+            // create table 'assignments'
						+            $fields = array(
						+                'id'            => array('type' => 'INT', 'constraint' => 11, 'unsigned' => true, 'auto_increment' => true),
						+                'name'          => array('type' => 'VARCHAR', 'constraint' => 50, 'default' => ''),
						+                'problems'      => array('type' => 'SMALLINT', 'constraint' => 4, 'unsigned' => true),
						+                'total_submits' => array('type' => 'INT', 'constraint' => 11, 'unsigned' => true),
						+                'open'          => array('type' => 'TINYINT', 'constraint' => 1),
						+                'scoreboard'    => array('type' => 'TINYINT', 'constraint' => 1),
						+                'javaexceptions' => array('type' => 'TINYINT', 'constraint' => 1),
						+                'description'   => array('type' => 'TEXT'),
						+                'start_time'    => array('type' => $DATETIME),
						+                'finish_time'   => array('type' => $DATETIME),
						+                'extra_time'    => array('type' => 'INT', 'constraint' => 11),
						+                'late_rule'     => array('type' => 'TEXT'),
						+                'participants'  => array('type' => 'TEXT'),
						+                'moss_update'   => array('type' => 'VARCHAR', 'constraint' => 30, 'default' => 'Never'),
						+                'archived_assignment'          => array('type' => 'TINYINT', 'constraint' => 1),
						+            );
						+            $this->dbforge->add_field($fields);
						+            $this->dbforge->add_key('id', true); // PRIMARY KEY
						+            if (! $this->dbforge->create_table('assignments', true)) {
							+                show_error("Error creating database table ".$this->db->dbprefix('assignments'));
							+            }
						
						-			// create table 'assignments'
						-			$fields = array(
						-				'id'            => array('type' => 'INT', 'constraint' => 11, 'unsigned' => TRUE, 'auto_increment' => TRUE),
						-				'name'          => array('type' => 'VARCHAR', 'constraint' => 50, 'default' => ''),
						-				'problems'      => array('type' => 'SMALLINT', 'constraint' => 4, 'unsigned' => TRUE),
						-				'total_submits' => array('type' => 'INT', 'constraint' => 11, 'unsigned' => TRUE),
						-				'open'          => array('type' => 'TINYINT', 'constraint' => 1),
						-				'scoreboard'    => array('type' => 'TINYINT', 'constraint' => 1),
						-				'javaexceptions'=> array('type' => 'TINYINT', 'constraint' => 1),
						-				'description'   => array('type' => 'TEXT'),
						-				'start_time'    => array('type' => $DATETIME),
						-				'finish_time'   => array('type' => $DATETIME),
						-				'extra_time'    => array('type' => 'INT', 'constraint' => 11),
						-				'late_rule'     => array('type' => 'TEXT'),
						-				'participants'  => array('type' => 'TEXT'),
						-				'moss_update'   => array('type' => 'VARCHAR', 'constraint' => 30, 'default' => 'Never'),
						-				'archived_assignment'          => array('type' => 'TINYINT', 'constraint' => 1),
						-			);
						-			$this->dbforge->add_field($fields);
						-			$this->dbforge->add_key('id', TRUE); // PRIMARY KEY
						-			if ( ! $this->dbforge->create_table('assignments', TRUE))
						-				show_error("Error creating database table ".$this->db->dbprefix('assignments'));
						
						+            // create table 'notifications'
						+            $fields = array(
						+                'id'            => array('type' => 'INT', 'constraint' => 11, 'unsigned' => true, 'auto_increment' => true),
						+                'title'         => array('type' => 'VARCHAR', 'constraint' => 200, 'default' => ''),
						+                'text'          => array('type' => 'TEXT'),
						+                'time'          => array('type' => $DATETIME),
						+            );
						+            $this->dbforge->add_field($fields);
						+            $this->dbforge->add_key('id', true); // PRIMARY KEY
						+            if (! $this->dbforge->create_table('notifications', true)) {
							+                show_error("Error creating database table ".$this->db->dbprefix('notifications'));
							+            }
						
						-			// create table 'notifications'
						-			$fields = array(
						-				'id'            => array('type' => 'INT', 'constraint' => 11, 'unsigned' => TRUE, 'auto_increment' => TRUE),
						-				'title'         => array('type' => 'VARCHAR', 'constraint' => 200, 'default' => ''),
						-				'text'          => array('type' => 'TEXT'),
						-				'time'          => array('type' => $DATETIME),
						-			);
						-			$this->dbforge->add_field($fields);
						-			$this->dbforge->add_key('id', TRUE); // PRIMARY KEY
						-			if ( ! $this->dbforge->create_table('notifications', TRUE))
						-				show_error("Error creating database table ".$this->db->dbprefix('notifications'));
						
						
						+            // create table 'problems'
						+            $fields = array(
						+                'assignment'        => array('type' => 'SMALLINT', 'constraint' => 4, 'unsigned' => true),
						+                'id'                => array('type' => 'SMALLINT', 'constraint' => 4, 'unsigned' => true),
						+                'name'              => array('type' => 'VARCHAR', 'constraint' => 50, 'default' => ''),
						+                'score'             => array('type' => 'INT', 'constraint' => 11),
						+                'is_upload_only'    => array('type' => 'TINYINT', 'constraint' => 1, 'default' => '0'),
						+                'c_time_limit'      => array('type' => 'INT', 'constraint' => 11, 'unsigned' => true, 'default' => 500),
						+                'python_time_limit' => array('type' => 'INT', 'constraint' => 11, 'unsigned' => true, 'default' => 1500),
						+                'java_time_limit'   => array('type' => 'INT', 'constraint' => 11, 'unsigned' => true, 'default' => 2000),
						+                'memory_limit'      => array('type' => 'INT', 'constraint' => 11, 'unsigned' => true, 'default' => 50000),
						+                'allowed_languages' => array('type' => 'TEXT'),
						+                'diff_cmd'          => array('type' => 'VARCHAR', 'constraint' => 20, 'default' => 'diff'),
						+                'diff_arg'          => array('type' => 'VARCHAR', 'constraint' => 20, 'default' => '-bB'),
						+            );
						+            $this->dbforge->add_field($fields);
						+            $this->dbforge->add_key(array('assignment', 'id'));
						+            if (! $this->dbforge->create_table('problems', true)) {
							+                show_error("Error creating database table ".$this->db->dbprefix('problems'));
							+            }
						
						-			// create table 'problems'
						-			$fields = array(
						-				'assignment'        => array('type' => 'SMALLINT', 'constraint' => 4, 'unsigned' => TRUE),
						-				'id'                => array('type' => 'SMALLINT', 'constraint' => 4, 'unsigned' => TRUE),
						-				'name'              => array('type' => 'VARCHAR', 'constraint' => 50, 'default' => ''),
						-				'score'             => array('type' => 'INT', 'constraint' => 11),
						-				'is_upload_only'    => array('type' => 'TINYINT', 'constraint' => 1, 'default' => '0'),
						-				'c_time_limit'      => array('type' => 'INT', 'constraint' => 11, 'unsigned' => TRUE, 'default' => 500),
						-				'python_time_limit' => array('type' => 'INT', 'constraint' => 11, 'unsigned' => TRUE, 'default' => 1500),
						-				'java_time_limit'   => array('type' => 'INT', 'constraint' => 11, 'unsigned' => TRUE, 'default' => 2000),
						-				'memory_limit'      => array('type' => 'INT', 'constraint' => 11, 'unsigned' => TRUE, 'default' => 50000),
						-				'allowed_languages' => array('type' => 'TEXT'),
						-				'diff_cmd'          => array('type' => 'VARCHAR', 'constraint' => 20, 'default' => 'diff'),
						-				'diff_arg'          => array('type' => 'VARCHAR', 'constraint' => 20, 'default' => '-bB'),
						-			);
						-			$this->dbforge->add_field($fields);
						-			$this->dbforge->add_key(array('assignment', 'id'));
						-			if ( ! $this->dbforge->create_table('problems', TRUE))
						-				show_error("Error creating database table ".$this->db->dbprefix('problems'));
						
						
						-
						-			// create table 'queue'
						-			$fields = array(
						-				'id'                => array('type' => 'INT', 'constraint' => 11, 'unsigned' => TRUE, 'auto_increment' => TRUE),
						-				'submit_id'         => array('type' => 'INT', 'constraint' => 11, 'unsigned' => TRUE),
						-				'username'          => array('type' => 'VARCHAR', 'constraint' => 20),
						-				'assignment'        => array('type' => 'SMALLINT', 'constraint' => 4, 'unsigned' => TRUE),
						-				'problem'           => array('type' => 'SMALLINT', 'constraint' => 4, 'unsigned' => TRUE),
						-				'type'              => array('type' => 'VARCHAR', 'constraint' => 8),
						-			);
						-			$this->dbforge->add_key('id', TRUE); // PRIMARY KEY
						-			$this->dbforge->add_field($fields);
						-			if ( ! $this->dbforge->create_table('queue', TRUE))
						-				show_error("Error creating database table ".$this->db->dbprefix('queue'));
						-			//Add UNIQUE (submit_id, username, assignment, problem) constraint
						-			$this->db->query(
						-				"ALTER TABLE {$this->db->dbprefix('queue')}
						+            // create table 'queue'
						+            $fields = array(
						+                'id'                => array('type' => 'INT', 'constraint' => 11, 'unsigned' => true, 'auto_increment' => true),
						+                'submit_id'         => array('type' => 'INT', 'constraint' => 11, 'unsigned' => true),
						+                'username'          => array('type' => 'VARCHAR', 'constraint' => 20),
						+                'assignment'        => array('type' => 'SMALLINT', 'constraint' => 4, 'unsigned' => true),
						+                'problem'           => array('type' => 'SMALLINT', 'constraint' => 4, 'unsigned' => true),
						+                'type'              => array('type' => 'VARCHAR', 'constraint' => 8),
						+            );
						+            $this->dbforge->add_key('id', true); // PRIMARY KEY
						+            $this->dbforge->add_field($fields);
						+            if (! $this->dbforge->create_table('queue', true)) {
							+                show_error("Error creating database table ".$this->db->dbprefix('queue'));
							+            }
						+            //Add UNIQUE (submit_id, username, assignment, problem) constraint
						+            $this->db->query(
						+                "ALTER TABLE {$this->db->dbprefix('queue')}
						ADD CONSTRAINT {$this->db->dbprefix('suap_unique')} UNIQUE (submit_id, username, assignment, problem);"
						-			);
						+            );
						
						
						
						-			// create table 'scoreboard'
						-			$fields = array(
						-				'assignment'        => array('type' => 'SMALLINT', 'constraint' => 4, 'unsigned' => TRUE),
						-				'scoreboard'        => array('type' => 'TEXT'),
						-			);
						-			$this->dbforge->add_field($fields);
						-			$this->dbforge->add_key('assignment');
						-			if ( ! $this->dbforge->create_table('scoreboard', TRUE))
						-				show_error("Error creating database table ".$this->db->dbprefix('scoreboard'));
						+            // create table 'scoreboard'
						+            $fields = array(
						+                'assignment'        => array('type' => 'SMALLINT', 'constraint' => 4, 'unsigned' => true),
						+                'scoreboard'        => array('type' => 'TEXT'),
						+            );
						+            $this->dbforge->add_field($fields);
						+            $this->dbforge->add_key('assignment');
						+            if (! $this->dbforge->create_table('scoreboard', true)) {
							+                show_error("Error creating database table ".$this->db->dbprefix('scoreboard'));
							+            }
						
						
						
						-			// create table 'settings'
						-			$fields = array(
						-				'shj_key'        => array('type' => 'VARCHAR', 'constraint' => 50),
						-				'shj_value'      => array('type' => 'TEXT'),
						-			);
						-			$this->dbforge->add_field($fields);
						-			$this->dbforge->add_key('shj_key');
						-			if ( ! $this->dbforge->create_table('settings', TRUE))
						-				show_error("Error creating database table ".$this->db->dbprefix('settings'));
						+            // create table 'settings'
						+            $fields = array(
						+                'shj_key'        => array('type' => 'VARCHAR', 'constraint' => 50),
						+                'shj_value'      => array('type' => 'TEXT'),
						+            );
						+            $this->dbforge->add_field($fields);
						+            $this->dbforge->add_key('shj_key');
						+            if (! $this->dbforge->create_table('settings', true)) {
							+                show_error("Error creating database table ".$this->db->dbprefix('settings'));
							+            }
						
						
						
						-			// insert default settings to table 'settings'
						-			$result = $this->db->insert_batch('settings', array(
						-				array('shj_key' => 'timezone',               'shj_value' => 'Asia/Jakarta'),
						-				array('shj_key' => 'tester_path',            'shj_value' => dirname(__FILE__, 3) . "/restricted/tester"),
						-				array('shj_key' => 'assignments_root',       'shj_value' => dirname(__FILE__, 3) . "/restricted/assignments"),
						-				array('shj_key' => 'file_size_limit',        'shj_value' => '50'),
						-				array('shj_key' => 'output_size_limit',      'shj_value' => '1024'),
						-				array('shj_key' => 'queue_is_working',       'shj_value' => '0'),
						-				array('shj_key' => 'default_late_rule',      'shj_value' => "/* \n * Put coefficient (from 100) in variable \$coefficient.\n * You can use variables \$extra_time and \$delay.\n * \$extra_time is the total extra time given to users\n * (in seconds) and \$delay is number of seconds passed\n * from finish time (can be negative).\n *  In this example, \$extra_time is 172800 (2 days):\n */\n\nif (\$delay<=0)\n  // no delay\n  \$coefficient = 100;\n\nelseif (\$delay<=3600)\n  // delay less than 1 hour\n  \$coefficient = ceil(100-((30*\$delay)/3600));\n\nelseif (\$delay<=86400)\n  // delay more than 1 hour and less than 1 day\n  \$coefficient = 70;\n\nelseif ((\$delay-86400)<=3600)\n  // delay less than 1 hour in second day\n  \$coefficient = ceil(70-((20*(\$delay-86400))/3600));\n\nelseif ((\$delay-86400)<=86400)\n  // delay more than 1 hour in second day\n  \$coefficient = 50;\n\nelseif (\$delay > \$extra_time)\n  // too late\n  \$coefficient = 0;"),
						-				array('shj_key' => 'enable_easysandbox',     'shj_value' => '1'),
						-				array('shj_key' => 'enable_c_shield',        'shj_value' => '1'),
						-				array('shj_key' => 'enable_cpp_shield',      'shj_value' => '1'),
						-				array('shj_key' => 'enable_py2_shield',      'shj_value' => '1'),
						-				array('shj_key' => 'enable_py3_shield',      'shj_value' => '1'),
						-				array('shj_key' => 'enable_java_policy',     'shj_value' => '1'),
						-				array('shj_key' => 'enable_log',             'shj_value' => '1'),
						-				array('shj_key' => 'submit_penalty',         'shj_value' => '300'),
						-				array('shj_key' => 'enable_registration',    'shj_value' => '0'),
						-				array('shj_key' => 'registration_code',      'shj_value' => '0'),
						-				array('shj_key' => 'mail_from',              'shj_value' => 'no-reply+shj@labftis.net'),
						-				array('shj_key' => 'mail_from_name',         'shj_value' => 'Judge from FTIS Administrator'),
						-				array('shj_key' => 'reset_password_mail',    'shj_value' => "<p>\nSomeone requested a password reset for your SharIF Judge account at {SITE_URL}.\n</p>\n<p>\nTo change your password, visit this link:\n</p>\n<p>\n<a href=\"{RESET_LINK}\">Reset Password</a>\n</p>\n<p>\nThe link is valid for {VALID_TIME}. If you don't want to change your password, just ignore this email.\n</p>"),
						-				array('shj_key' => 'add_user_mail',          'shj_value' => "<p>\nHello! You are registered in SharIF Judge at {SITE_URL} as {ROLE}.\n</p>\n<p>\nYour username: {USERNAME}\n</p>\n<p>\nYour password: {PASSWORD}\n</p>\n<p>\nYou can log in at <a href=\"{LOGIN_URL}\">{LOGIN_URL}</a>\n</p>"),
						-				array('shj_key' => 'moss_userid',            'shj_value' => ''),
						-				array('shj_key' => 'results_per_page_all',   'shj_value' => '40'),
						-				array('shj_key' => 'results_per_page_final', 'shj_value' => '80'),
						-				array('shj_key' => 'week_start',             'shj_value' => '0'),
						-				array('shj_key' => 'lock_student_display_name',      'shj_value' => '0'),
						-			));
						-			if ( ! $result)
						-				show_error("Error adding data to table ".$this->db->dbprefix('settings'));
						+            // insert default settings to table 'settings'
						+            $result = $this->db->insert_batch('settings', array(
						+                array('shj_key' => 'timezone',               'shj_value' => 'Asia/Jakarta'),
						+                array('shj_key' => 'tester_path',            'shj_value' => dirname(__FILE__, 3) . "/restricted/tester"),
						+                array('shj_key' => 'assignments_root',       'shj_value' => dirname(__FILE__, 3) . "/restricted/assignments"),
						+                array('shj_key' => 'file_size_limit',        'shj_value' => '50'),
						+                array('shj_key' => 'output_size_limit',      'shj_value' => '1024'),
						+                array('shj_key' => 'queue_is_working',       'shj_value' => '0'),
						+                array('shj_key' => 'default_late_rule',      'shj_value' => "/* \n * Put coefficient (from 100) in variable \$coefficient.\n * You can use variables \$extra_time and \$delay.\n * \$extra_time is the total extra time given to users\n * (in seconds) and \$delay is number of seconds passed\n * from finish time (can be negative).\n *  In this example, \$extra_time is 172800 (2 days):\n */\n\nif (\$delay<=0)\n  // no delay\n  \$coefficient = 100;\n\nelseif (\$delay<=3600)\n  // delay less than 1 hour\n  \$coefficient = ceil(100-((30*\$delay)/3600));\n\nelseif (\$delay<=86400)\n  // delay more than 1 hour and less than 1 day\n  \$coefficient = 70;\n\nelseif ((\$delay-86400)<=3600)\n  // delay less than 1 hour in second day\n  \$coefficient = ceil(70-((20*(\$delay-86400))/3600));\n\nelseif ((\$delay-86400)<=86400)\n  // delay more than 1 hour in second day\n  \$coefficient = 50;\n\nelseif (\$delay > \$extra_time)\n  // too late\n  \$coefficient = 0;"),
						+                array('shj_key' => 'enable_easysandbox',     'shj_value' => '1'),
						+                array('shj_key' => 'enable_c_shield',        'shj_value' => '1'),
						+                array('shj_key' => 'enable_cpp_shield',      'shj_value' => '1'),
						+                array('shj_key' => 'enable_py2_shield',      'shj_value' => '1'),
						+                array('shj_key' => 'enable_py3_shield',      'shj_value' => '1'),
						+                array('shj_key' => 'enable_java_policy',     'shj_value' => '1'),
						+                array('shj_key' => 'enable_log',             'shj_value' => '1'),
						+                array('shj_key' => 'submit_penalty',         'shj_value' => '300'),
						+                array('shj_key' => 'enable_registration',    'shj_value' => '0'),
						+                array('shj_key' => 'registration_code',      'shj_value' => '0'),
						+                array('shj_key' => 'mail_from',              'shj_value' => 'no-reply+shj@labftis.net'),
						+                array('shj_key' => 'mail_from_name',         'shj_value' => 'Judge from FTIS Administrator'),
						+                array('shj_key' => 'reset_password_mail',    'shj_value' => "<p>\nSomeone requested a password reset for your SharIF Judge account at {SITE_URL}.\n</p>\n<p>\nTo change your password, visit this link:\n</p>\n<p>\n<a href=\"{RESET_LINK}\">Reset Password</a>\n</p>\n<p>\nThe link is valid for {VALID_TIME}. If you don't want to change your password, just ignore this email.\n</p>"),
						+                array('shj_key' => 'add_user_mail',          'shj_value' => "<p>\nHello! You are registered in SharIF Judge at {SITE_URL} as {ROLE}.\n</p>\n<p>\nYour username: {USERNAME}\n</p>\n<p>\nYour password: {PASSWORD}\n</p>\n<p>\nYou can log in at <a href=\"{LOGIN_URL}\">{LOGIN_URL}</a>\n</p>"),
						+                array('shj_key' => 'moss_userid',            'shj_value' => ''),
						+                array('shj_key' => 'results_per_page_all',   'shj_value' => '40'),
						+                array('shj_key' => 'results_per_page_final', 'shj_value' => '80'),
						+                array('shj_key' => 'week_start',             'shj_value' => '0'),
						+                array('shj_key' => 'lock_student_display_name',      'shj_value' => '0'),
						+            ));
						+            if (! $result) {
							+                show_error("Error adding data to table ".$this->db->dbprefix('settings'));
							+            }
						
						
						
						-			// create table 'users'
						-			$fields = array(
						-				'id'                  => array('type' => 'INT', 'constraint' => 11, 'unsigned' => TRUE, 'auto_increment' => TRUE),
						-				'username'            => array('type' => 'VARCHAR', 'constraint' => 20),
						-				'password'            => array('type' => 'VARCHAR', 'constraint' => 100),
						-				'display_name'        => array('type' => 'VARCHAR', 'constraint' => 40, 'default' => ''),
						-				'email'               => array('type' => 'VARCHAR', 'constraint' => 40),
						-				'role'                => array('type' => 'VARCHAR', 'constraint' => 20),
						-				'passchange_key'      => array('type' => 'VARCHAR', 'constraint' => 60, 'default' => ''),
						-				'passchange_time'     => array('type' => $DATETIME, 'null' => TRUE),
						-				'first_login_time'    => array('type' => $DATETIME, 'null' => TRUE),
						-				'last_login_time'     => array('type' => $DATETIME, 'null' => TRUE),
						-				'selected_assignment' => array('type' => 'SMALLINT', 'constraint' => 4, 'unsigned' => TRUE, 'default' => 0),
						-				'dashboard_widget_positions'   => array('type' => 'VARCHAR', 'constraint' => 500, 'default' => ''),
						-			);
						-			$this->dbforge->add_field($fields);
						-			$this->dbforge->add_key('id', TRUE); // PRIMARY KEY
						-			$this->dbforge->add_key('username'); // @todo is this needed?
						-			if ( ! $this->dbforge->create_table('users', TRUE))
						-				show_error("Error creating database table ".$this->db->dbprefix('users'));
						+            // create table 'users'
						+            $fields = array(
						+                'id'                  => array('type' => 'INT', 'constraint' => 11, 'unsigned' => true, 'auto_increment' => true),
						+                'username'            => array('type' => 'VARCHAR', 'constraint' => 20),
						+                'password'            => array('type' => 'VARCHAR', 'constraint' => 100),
						+                'display_name'        => array('type' => 'VARCHAR', 'constraint' => 40, 'default' => ''),
						+                'email'               => array('type' => 'VARCHAR', 'constraint' => 40),
						+                'role'                => array('type' => 'VARCHAR', 'constraint' => 20),
						+                'passchange_key'      => array('type' => 'VARCHAR', 'constraint' => 60, 'default' => ''),
						+                'passchange_time'     => array('type' => $DATETIME, 'null' => true),
						+                'first_login_time'    => array('type' => $DATETIME, 'null' => true),
						+                'last_login_time'     => array('type' => $DATETIME, 'null' => true),
						+                'selected_assignment' => array('type' => 'SMALLINT', 'constraint' => 4, 'unsigned' => true, 'default' => 0),
						+                'dashboard_widget_positions'   => array('type' => 'VARCHAR', 'constraint' => 500, 'default' => ''),
						+            );
						+            $this->dbforge->add_field($fields);
						+            $this->dbforge->add_key('id', true); // PRIMARY KEY
						+            $this->dbforge->add_key('username'); // @todo is this needed?
						+            if (! $this->dbforge->create_table('users', true)) {
							+                show_error("Error creating database table ".$this->db->dbprefix('users'));
							+            }
						
						-			// create table 'logins'
						-			$fields = array(
						-				'login_id'            => array('type' => 'INT', 'constraint' => 11, 'unsigned' => TRUE, 'auto_increment' => TRUE),
						-				'username'         		=> array('type' => 'VARCHAR', 'constraint' => 20),
						-				'ip_address'          => array('type' => 'VARCHAR', 'constraint' => 15),
						-				'timestamp'          	=> array('type' => 'TIMESTAMP'),
						-				'last_24h_login_id'   => array('type' => 'INT', 'constraint' => 11, 'null' => TRUE),
						-			);
						-			$this->dbforge->add_field($fields);
						-			$this->dbforge->add_key('login_id', TRUE); // PRIMARY KEY
						-			if ( ! $this->dbforge->create_table('logins', TRUE))
						-				show_error("Error creating database table ".$this->db->dbprefix('logins'));
						+            // create table 'logins'
						+            $fields = array(
						+                'login_id'            => array('type' => 'INT', 'constraint' => 11, 'unsigned' => true, 'auto_increment' => true),
						+                'username'         		=> array('type' => 'VARCHAR', 'constraint' => 20),
						+                'ip_address'          => array('type' => 'VARCHAR', 'constraint' => 15),
						+                'timestamp'          	=> array('type' => 'TIMESTAMP'),
						+                'last_24h_login_id'   => array('type' => 'INT', 'constraint' => 11, 'null' => true),
						+            );
						+            $this->dbforge->add_field($fields);
						+            $this->dbforge->add_key('login_id', true); // PRIMARY KEY
						+            if (! $this->dbforge->create_table('logins', true)) {
							+                show_error("Error creating database table ".$this->db->dbprefix('logins'));
							+            }
						
						-			// add admin user
						-			$this->user_model->add_user(
						-				$this->input->post('username'),
						-				$this->input->post('email'),
						-				'Admin',
						-				$this->input->post('password'),
						-				'admin'
						-			);
						+            // add admin user
						+            $this->user_model->add_user(
						+                $this->input->post('username'),
						+                $this->input->post('email'),
						+                'Admin',
						+                $this->input->post('password'),
						+                'admin'
						+            );
						
						-			// Using a random string as encryption key
						-			$config_path = rtrim(APPPATH,'/').'/config/config.php';
						-			$config_content = file_get_contents($config_path);
						-			$random_key = random_string('alnum', 32);
						-			$res = @file_put_contents($config_path, str_replace($this->config->item('encryption_key'), $random_key, $config_content));
						-			if ($res === FALSE)
						-				$data['key_changed'] = FALSE;
						-			else
						-				$data['key_changed'] = TRUE;
						+            // Using a random string as encryption key
						+            $config_path = rtrim(APPPATH, '/').'/config/config.php';
						+            $config_content = file_get_contents($config_path);
						+            $random_key = random_string('alnum', 32);
						+            $res = @file_put_contents($config_path, str_replace($this->config->item('encryption_key'), $random_key, $config_content));
						+            if ($res === false) {
							+                $data['key_changed'] = false;
							+            } else {
							+                $data['key_changed'] = true;
							+            }
						
						-			$data['installed'] = TRUE;
						-			$data['enc_key'] = $this->config->item('encryption_key');
						-			$data['random_key'] = random_string('alnum', 32);
						-		}
					+            $data['installed'] = true;
					+            $data['enc_key'] = $this->config->item('encryption_key');
					+            $data['random_key'] = random_string('alnum', 32);
					+        }
				
				
				-		$this->twig->display('pages/admin/install.twig', $data);
				+        $this->twig->display('pages/admin/install.twig', $data);
				
				-	}
			+    }
	}
	
	----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Login.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/controllers/Login.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Login.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Login.php
	@@ -4,167 +4,174 @@
	* @file Login.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Login extends CI_Controller
	{
		+    public function __construct()
		+    {
			+        parent::__construct();
			+    }
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * checks whether the entered registration code is correct or not
		+     *
		+     */
		+    public function _registration_code($code)
		+    {
			+        $rc = $this->settings_model->get_setting('registration_code');
			+        if ($rc == '0') {
				+            return true;
				+        }
			+        if ($rc == $code) {
				+            return true;
				+        }
			+        return false;
			+    }
		
		-	/**
		-	 * checks whether the entered registration code is correct or not
		-	 *
		-	 */
		-	public function _registration_code($code){
			-		$rc = $this->settings_model->get_setting('registration_code');
			-		if ($rc == '0')
			-			return TRUE;
			-		if ($rc == $code)
			-			return TRUE;
			-		return FALSE;
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Login
		+     */
		+    public function index()
		+    {
			+        if ($this->session->userdata('logged_in')) { // if logged in
				+            redirect('dashboard');
				+        }
			+        $this->form_validation->set_rules('username', 'Username', 'required|min_length[3]|max_length[20]|alpha_numeric|lowercase');
			+        $this->form_validation->set_rules('password', 'Password', 'required|min_length[6]|max_length[200]');
			+        $data = array(
			+            'error' => false,
			+            'registration_enabled' => $this->settings_model->get_setting('enable_registration'),
			+        );
			
			-	/**
			-	 * Login
			-	 */
			-	public function index()
			-	{
				-		if ($this->session->userdata('logged_in')) // if logged in
				-			redirect('dashboard');
				-		$this->form_validation->set_rules('username', 'Username', 'required|min_length[3]|max_length[20]|alpha_numeric|lowercase');
				-		$this->form_validation->set_rules('password', 'Password', 'required|min_length[6]|max_length[200]');
				-		$data = array(
				-			'error' => FALSE,
				-			'registration_enabled' => $this->settings_model->get_setting('enable_registration'),
				-		);
				+        if($this->form_validation->run()) {
					+            $username = $this->input->post('username');
					+            $password = $this->input->post('password');
					+            if($this->user_model->validate_user($username, $password)) {
						+                $ip_adrress = $this->input->ip_address();
						
						-		if($this->form_validation->run()){
							-			$username = $this->input->post('username');
							-			$password = $this->input->post('password');
							-			if($this->user_model->validate_user($username, $password)){
								-				$ip_adrress = $this->input->ip_address();
								-			
								-				// setting the session and redirecting to dashboard:
								-				$login_data = array(
								-					'username'  => $username,
								-					'logged_in' => TRUE
								-				);
								-				$this->session->set_userdata($login_data);
								-				$this->user_model->update_login_time($username);
								-				$this->logs_model->insert_to_logs($username,$ip_adrress);
								-				redirect('/');
								-			}
							-			else
							-				// for displaying error message in 'pages/authentication/login' view
							-				$data['error'] = TRUE;
							-		}
						+                // setting the session and redirecting to dashboard:
						+                $login_data = array(
						+                    'username'  => $username,
						+                    'logged_in' => true
						+                );
						+                $this->session->set_userdata($login_data);
						+                $this->user_model->update_login_time($username);
						+                $this->logs_model->insert_to_logs($username, $ip_adrress);
						+                redirect('/');
						+            } else {
						+                // for displaying error message in 'pages/authentication/login' view
						+                $data['error'] = true;
						+            }
					+        }
				
				-		$this->twig->display('pages/authentication/login.twig', $data);
				-	}
			+        $this->twig->display('pages/authentication/login.twig', $data);
			+    }
		
		
		-	// ------------------------------------------------------------------------
		+    // ------------------------------------------------------------------------
		
		
		-	public function register()
		-	{
			-		if ($this->session->userdata('logged_in')) // if logged in
			-			redirect('dashboard');
			-		if ( ! $this->settings_model->get_setting('enable_registration'))
			-			show_error('Registration is closed.');
			-		$this->form_validation->set_rules('registration_code', 'registration code', 'callback__registration_code', array('_registration_code' => 'Invalid %s'));
			-		$this->form_validation->set_rules('username', 'username', 'required|min_length[3]|max_length[20]|alpha_numeric|lowercase|is_unique[users.username]', array('is_unique' => 'This %s already exists.'));
			-		$this->form_validation->set_rules('email', 'email address', 'required|max_length[40]|valid_email|lowercase|is_unique[users.email]', array('is_unique' => 'This %s already exists.'));
			-		$this->form_validation->set_rules('password', 'password', 'required|min_length[6]|max_length[200]');
			-		$this->form_validation->set_rules('password_again', 'password confirmation', 'required|matches[password]');
			-		$data = array(
			-			'registration_code_required' => $this->settings_model->get_setting('registration_code')=='0'?FALSE:TRUE
			-		);
			-		if ($this->form_validation->run()){
				-			$this->user_model->add_user(
				-				$this->input->post('username'),
				-				$this->input->post('email'),
				-				$this->input->post('displayname'),
				-				$this->input->post('password'),
				-				'student'
				-			);
				-			$this->twig->display('pages/authentication/register_success.twig');
				-		}
			-		else
			-			$this->twig->display('pages/authentication/register.twig', $data);
			+    public function register()
			+    {
				+        if ($this->session->userdata('logged_in')) { // if logged in
					+            redirect('dashboard');
					+        }
				+        if (! $this->settings_model->get_setting('enable_registration')) {
					+            show_error('Registration is closed.');
					+        }
				+        $this->form_validation->set_rules('registration_code', 'registration code', 'callback__registration_code', array('_registration_code' => 'Invalid %s'));
				+        $this->form_validation->set_rules('username', 'username', 'required|min_length[3]|max_length[20]|alpha_numeric|lowercase|is_unique[users.username]', array('is_unique' => 'This %s already exists.'));
				+        $this->form_validation->set_rules('email', 'email address', 'required|max_length[40]|valid_email|lowercase|is_unique[users.email]', array('is_unique' => 'This %s already exists.'));
				+        $this->form_validation->set_rules('password', 'password', 'required|min_length[6]|max_length[200]');
				+        $this->form_validation->set_rules('password_again', 'password confirmation', 'required|matches[password]');
				+        $data = array(
				+            'registration_code_required' => $this->settings_model->get_setting('registration_code') == '0' ? false : true
				+        );
				+        if ($this->form_validation->run()) {
					+            $this->user_model->add_user(
					+                $this->input->post('username'),
					+                $this->input->post('email'),
					+                $this->input->post('displayname'),
					+                $this->input->post('password'),
					+                'student'
					+            );
					+            $this->twig->display('pages/authentication/register_success.twig');
					+        } else {
					+            $this->twig->display('pages/authentication/register.twig', $data);
					+        }
				
				-	}
			+    }
		
		
		-	// ------------------------------------------------------------------------
		+    // ------------------------------------------------------------------------
		
		
		-	/**
		-	 * Logs out and redirects to login page
		-	 */
		-	public function logout()
		-	{
			-		$this->session->sess_destroy();
			-		redirect('login');
			-	}
		+    /**
		+     * Logs out and redirects to login page
		+     */
		+    public function logout()
		+    {
			+        $this->session->sess_destroy();
			+        redirect('login');
			+    }
		
		
		-	// ------------------------------------------------------------------------
		+    // ------------------------------------------------------------------------
		
		
		-	public function lost()
		-	{
			-		if ($this->session->userdata('logged_in')) // if logged in
			-			redirect('dashboard');
			-		$this->form_validation->set_rules('email', 'email', 'required|max_length[40]|lowercase|valid_email');
			-		$data = array(
			-			'sent' => FALSE
			-		);
			-		if ($this->form_validation->run())
			-		{
				-			$this->user_model->send_password_reset_mail($this->input->post('email'));
				-			$data['sent'] = TRUE;
				-		}
			+    public function lost()
			+    {
				+        if ($this->session->userdata('logged_in')) { // if logged in
					+            redirect('dashboard');
					+        }
				+        $this->form_validation->set_rules('email', 'email', 'required|max_length[40]|lowercase|valid_email');
				+        $data = array(
				+            'sent' => false
				+        );
				+        if ($this->form_validation->run()) {
					+            $this->user_model->send_password_reset_mail($this->input->post('email'));
					+            $data['sent'] = true;
					+        }
				
				-		$this->twig->display('pages/authentication/lost.twig', $data);
				-	}
			+        $this->twig->display('pages/authentication/lost.twig', $data);
			+    }
		
		
		-	// ------------------------------------------------------------------------
		+    // ------------------------------------------------------------------------
		
		
		-	public function reset($passchange_key = FALSE)
		-	{
			-		if ($passchange_key === FALSE)
			-			show_404();
			-		$result = $this->user_model->passchange_is_valid($passchange_key);
			-		if ($result !== TRUE)
			-			show_error($result);
			-		$this->form_validation->set_rules('password', 'password', 'required|min_length[6]|max_length[200]');
			-		$this->form_validation->set_rules('password_again', 'password confirmation', 'required|matches[password]');
			-		$data = array(
			-			'key' => $passchange_key,
			-			'result' => $result,
			-			'reset' => FALSE
			-		);
			-		if ($this->form_validation->run()){
				-			$this->user_model->reset_password($passchange_key, $this->input->post('password'));
				-			$data['reset'] = TRUE;
				-		}
			+    public function reset($passchange_key = false)
			+    {
				+        if ($passchange_key === false) {
					+            show_404();
					+        }
				+        $result = $this->user_model->passchange_is_valid($passchange_key);
				+        if ($result !== true) {
					+            show_error($result);
					+        }
				+        $this->form_validation->set_rules('password', 'password', 'required|min_length[6]|max_length[200]');
				+        $this->form_validation->set_rules('password_again', 'password confirmation', 'required|matches[password]');
				+        $data = array(
				+            'key' => $passchange_key,
				+            'result' => $result,
				+            'reset' => false
				+        );
				+        if ($this->form_validation->run()) {
					+            $this->user_model->reset_password($passchange_key, $this->input->post('password'));
					+            $data['reset'] = true;
					+        }
				
				-		$this->twig->display('pages/authentication/reset_password.twig', $data);
				-	}
			+        $this->twig->display('pages/authentication/reset_password.twig', $data);
			+    }
		
		
		
		
		----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Logs.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/controllers/Logs.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Logs.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Logs.php
	@@ -4,42 +4,42 @@
	* @file Logs.php
	* @author Stillmen Vallian <stillmen.v@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Logs extends CI_Controller
	{
		+    public function __construct()
		+    {
			+        parent::__construct();
			+        if (! $this->session->userdata('logged_in')) { // if not logged in
				+            redirect('login');
				+        }
			+        if ($this->user->level <= 2) { // permission denied
				+            show_404();
				+        }
			+    }
		
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-		if ( ! $this->session->userdata('logged_in')) // if not logged in
			-			redirect('login');
			-		if ( $this->user->level <= 2) // permission denied
			-			show_404();
			-	}
		
		
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		
		
		+    public function index()
		+    {
			
			+        $data = array(
			+            'logs' => $this->logs_model->get_all_logs()
			+        );
			
			-	public function index()
			-	{
				+        $this->twig->display('pages/admin/logs.twig', $data);
				+    }
			
			-		$data = array(
			-			'logs' => $this->logs_model->get_all_logs()
			-		);
			
			-		$this->twig->display('pages/admin/logs.twig', $data);
			-	}
		
		
		-
		-
		-	// ------------------------------------------------------------------------
		+    // ------------------------------------------------------------------------
		
	}
	
	----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Moss.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/controllers/Moss.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Moss.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Moss.php
	@@ -4,102 +4,109 @@
	* @file Moss.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Moss extends CI_Controller
	{
		+    public function __construct()
		+    {
			+        parent::__construct();
			+        if (! $this->session->userdata('logged_in')) { // if not logged in
				+            redirect('login');
				+        }
			+        if ($this->user->level <= 1) { // permission denied
				+            show_404();
				+        }
			+    }
		
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-		if ( ! $this->session->userdata('logged_in')) // if not logged in
			-			redirect('login');
			-		if ($this->user->level <= 1) // permission denied
			-			show_404();
			-	}
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		+    public function index($assignment_id = false)
		+    {
			+        if ($assignment_id === false) {
				+            show_404();
				+        }
			+        $this->form_validation->set_rules('detect', 'detect', 'required');
			+        if ($this->form_validation->run()) {
				+            if ($this->input->post('detect') !== 'detect') {
					+                exit;
					+            }
				+            $this->_detect($assignment_id);
				+        }
			+        $data = array(
			+            'all_assignments' => $this->assignment_model->all_assignments(),
			+            'moss_userid' => $this->settings_model->get_setting('moss_userid'),
			+            'moss_assignment' => $this->assignment_model->assignment_info($assignment_id),
			+            'update_time' => $this->assignment_model->get_moss_time($assignment_id)
			+        );
			
			+        $data['moss_problems'] = array();
			+        $assignments_path = rtrim($this->settings_model->get_setting('assignments_root'), '/');
			+        for($i = 1; $i <= $data['moss_assignment']['problems']; $i++) {
				+            $data['moss_problems'][$i] = null;
				+            $path = $assignments_path."/assignment_{$assignment_id}/p{$i}/moss_link.txt";
				+            if (file_exists($path)) {
					+                $data['moss_problems'][$i] = file_get_contents($path);
					+            }
				+        }
			
			-	public function index($assignment_id = FALSE)
			-	{
				-		if ($assignment_id === FALSE)
				-			show_404();
				-		$this->form_validation->set_rules('detect', 'detect', 'required');
				-		if ($this->form_validation->run())
				-		{
					-			if ($this->input->post('detect') !== 'detect')
					-				exit;
					-			$this->_detect($assignment_id);
					-		}
				-		$data = array(
				-			'all_assignments' => $this->assignment_model->all_assignments(),
				-			'moss_userid' => $this->settings_model->get_setting('moss_userid'),
				-			'moss_assignment' => $this->assignment_model->assignment_info($assignment_id),
				-			'update_time' => $this->assignment_model->get_moss_time($assignment_id)
				-		);
				+        $this->twig->display('pages/admin/moss.twig', $data);
				+    }
			
			-		$data['moss_problems'] = array();
			-		$assignments_path = rtrim($this->settings_model->get_setting('assignments_root'), '/');
			-		for($i=1; $i<=$data['moss_assignment']['problems']; $i++){
				-			$data['moss_problems'][$i] = NULL;
				-			$path = $assignments_path."/assignment_{$assignment_id}/p{$i}/moss_link.txt";
				-			if (file_exists($path))
				-				$data['moss_problems'][$i] = file_get_contents($path);
				-		}
			
			-		$this->twig->display('pages/admin/moss.twig', $data);
			-	}
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		+    public function update($assignment_id = false)
		+    {
			+        if ($assignment_id === false) {
				+            show_404();
				+        }
			+        $userid = $this->input->post('moss_userid');
			+        $this->settings_model->set_setting('moss_userid', $userid);
			+        $moss_original = trim(file_get_contents(rtrim($this->settings_model->get_setting('tester_path'), '/').'/moss_original'));
			+        $moss_path = rtrim($this->settings_model->get_setting('tester_path'), '/').'/moss';
			+        file_put_contents($moss_path, str_replace('MOSS_USER_ID', $userid, $moss_original));
			+        shell_exec("chmod +x {$moss_path}");
			+        $this->index($assignment_id);
			+    }
		
		
		-	public function update($assignment_id = FALSE)
		-	{
			-		if ($assignment_id === FALSE)
			-			show_404();
			-		$userid = $this->input->post('moss_userid');
			-		$this->settings_model->set_setting('moss_userid', $userid);
			-		$moss_original = trim( file_get_contents(rtrim($this->settings_model->get_setting('tester_path'), '/').'/moss_original') );
			-		$moss_path = rtrim($this->settings_model->get_setting('tester_path'), '/').'/moss';
			-		file_put_contents($moss_path, str_replace('MOSS_USER_ID', $userid, $moss_original));
			-		shell_exec("chmod +x {$moss_path}");
			-		$this->index($assignment_id);
			-	}
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		+    private function _detect($assignment_id = false)
		+    {
			+        if ($assignment_id === false) {
				+            show_404();
				+        }
			+        $this->load->model('submit_model');
			+        $assignments_path = rtrim($this->settings_model->get_setting('assignments_root'), '/');
			+        $tester_path = rtrim($this->settings_model->get_setting('tester_path'), '/');
			+        shell_exec("chmod +x {$tester_path}/moss");
			+        $items = $this->submit_model->get_final_submissions($assignment_id, $this->user->level, $this->user->username);
			+        $groups = array();
			+        foreach ($items as $item) {
				+            if (!isset($groups[$item['problem']])) {
					+                $groups[$item['problem']] = array($item);
					+            } else {
					+                array_push($groups[$item['problem']], $item);
					+            }
				+        }
			+        foreach ($groups as $problem_id => $group) {
				+            $list = '';
				+            $assignment_path = $assignments_path."/assignment_{$assignment_id}";
				+            foreach ($group as $item) {
					+                if ($item['file_type'] !== 'zip' && $item['file_type'] !== 'pdf') {
						+                    $list .= "p{$problem_id}/{$item['username']}/{$item['file_name']}".'.'.filetype_to_extension($item['file_type']). " ";
						+                }
					+            }
				+            shell_exec("list='$list'; cd $assignment_path; $tester_path/moss \$list | grep http >p{$problem_id}/moss_link.txt;");
				+        }
			+        $this->assignment_model->set_moss_time($assignment_id);
			+    }
		
		
		-	private function _detect($assignment_id = FALSE)
		-	{
			-		if ($assignment_id === FALSE)
			-			show_404();
			-		$this->load->model('submit_model');
			-		$assignments_path = rtrim($this->settings_model->get_setting('assignments_root'), '/');
			-		$tester_path = rtrim($this->settings_model->get_setting('tester_path'), '/');
			-		shell_exec("chmod +x {$tester_path}/moss");
			-		$items = $this->submit_model->get_final_submissions($assignment_id, $this->user->level, $this->user->username);
			-		$groups = array();
			-		foreach ($items as $item) {
				-			if (!isset($groups[$item['problem']]))
				-				$groups[$item['problem']] = array($item);
				-			else
				-				array_push($groups[$item['problem']], $item);
				-		}
			-		foreach ($groups as $problem_id => $group) {
				-			$list = '';
				-			$assignment_path = $assignments_path."/assignment_{$assignment_id}";
				-			foreach ($group as $item)
				-				if ($item['file_type'] !== 'zip' && $item['file_type'] !== 'pdf')
				-					$list .= "p{$problem_id}/{$item['username']}/{$item['file_name']}".'.'.filetype_to_extension($item['file_type']). " ";
				-			shell_exec("list='$list'; cd $assignment_path; $tester_path/moss \$list | grep http >p{$problem_id}/moss_link.txt;");
				-		}
			-		$this->assignment_model->set_moss_time($assignment_id);
			-	}
		-
		-
		-}
	\ No newline at end of file
	+}

----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Notifications.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/controllers/Notifications.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Notifications.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Notifications.php
	@@ -4,124 +4,132 @@
	* @file Notifications.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Notifications extends CI_Controller
	{
		+    private $notif_edit;
		
		-	private $notif_edit;
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function __construct()
		+    {
			+        parent::__construct();
			+        if (! $this->session->userdata('logged_in')) { // if not logged in
				+            redirect('login');
				+        }
			+        $this->load->model('notifications_model');
			+        $this->notif_edit = false;
			+    }
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-		if ( ! $this->session->userdata('logged_in')) // if not logged in
			-			redirect('login');
			-		$this->load->model('notifications_model');
			-		$this->notif_edit = FALSE;
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function index()
		+    {
			+        $data = array(
			+            'all_assignments' => $this->assignment_model->all_assignments(),
			+            'notifications' => $this->notifications_model->get_all_notifications()
			+        );
			
			-	public function index()
			-	{
				-		$data = array(
				-			'all_assignments' => $this->assignment_model->all_assignments(),
				-			'notifications' => $this->notifications_model->get_all_notifications()
				-		);
				+        $this->twig->display('pages/notifications.twig', $data);
				
				-		$this->twig->display('pages/notifications.twig', $data);
				+    }
			
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function add()
		+    {
			+        if ($this->user->level <= 1) { // permission denied
				+            show_404();
				+        }
			
			-	public function add()
			-	{
				-		if ( $this->user->level <=1) // permission denied
				-			show_404();
				+        $this->form_validation->set_rules('title', 'title', 'trim');
				+        $this->form_validation->set_rules('text', 'text', ''); /* todo: xss clean */
				
				-		$this->form_validation->set_rules('title', 'title', 'trim');
				-		$this->form_validation->set_rules('text', 'text', ''); /* todo: xss clean */
				+        if($this->form_validation->run()) {
					+            if ($this->input->post('id') === null) {
						+                $this->notifications_model->add_notification($this->input->post('title'), $this->input->post('text'));
						+            } else {
						+                $this->notifications_model->update_notification($this->input->post('id'), $this->input->post('title'), $this->input->post('text'));
						+            }
					+            redirect('notifications');
					+        }
				
				-		if($this->form_validation->run()){
					-			if ($this->input->post('id') === NULL)
					-				$this->notifications_model->add_notification($this->input->post('title'), $this->input->post('text'));
					-			else
					-				$this->notifications_model->update_notification($this->input->post('id'), $this->input->post('title'), $this->input->post('text'));
					-			redirect('notifications');
					-		}
				+        $data = array(
				+            'all_assignments' => $this->assignment_model->all_assignments(),
				+            'notif_edit' => $this->notif_edit
				+        );
				
				-		$data = array(
				-			'all_assignments' => $this->assignment_model->all_assignments(),
				-			'notif_edit' => $this->notif_edit
				-		);
				+        if ($this->notif_edit !== false) {
					+            $data['title'] = 'Edit Notification';
					+        }
				
				-		if ($this->notif_edit !== FALSE)
				-			$data['title'] = 'Edit Notification';
				
				+        $this->twig->display('pages/admin/add_notification.twig', $data);
				
				-		$this->twig->display('pages/admin/add_notification.twig', $data);
				+    }
			
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function edit($notif_id = false)
		+    {
			+        if ($this->user->level <= 1) { // permission denied
				+            show_404();
				+        }
			+        if ($notif_id === false || ! is_numeric($notif_id)) {
				+            show_404();
				+        }
			+        $this->notif_edit = $this->notifications_model->get_notification($notif_id);
			+        $this->add();
			+    }
		
		-	public function edit($notif_id = FALSE)
		-	{
			-		if ($this->user->level <= 1) // permission denied
			-			show_404();
			-			if ($notif_id === FALSE || ! is_numeric($notif_id))
			-			show_404();
			-		$this->notif_edit = $this->notifications_model->get_notification($notif_id);
			-		$this->add();
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function delete()
		+    {
			+        if (! $this->input->is_ajax_request()) {
				+            show_404();
				+        }
			+        if ($this->user->level <= 1) { // permission denied
				+            $json_result = array('done' => 0, 'message' => 'Permission Denied');
				+        } elseif ($this->input->post('id') === null) {
				+            $json_result = array('done' => 0, 'message' => 'Input Error');
				+        } else {
				+            $this->notifications_model->delete_notification($this->input->post('id'));
				+            $json_result = array('done' => 1);
				+        }
			
			-	public function delete()
			-	{
				-		if ( ! $this->input->is_ajax_request() )
				-			show_404();
				-		if ($this->user->level <= 1) // permission denied
				-			$json_result = array('done' => 0, 'message' => 'Permission Denied');
				-		elseif ($this->input->post('id') === NULL)
				-			$json_result = array('done' => 0, 'message' => 'Input Error');
				-		else
				-		{
					-			$this->notifications_model->delete_notification($this->input->post('id'));
					-			$json_result = array('done' => 1);
					-		}
				+        $this->output->set_header('Content-Type: application/json; charset=utf-8');
				+        echo json_encode($json_result);
				+    }
			
			-		$this->output->set_header('Content-Type: application/json; charset=utf-8');
			-		echo json_encode($json_result);
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function check()
		+    {
			+        if (! $this->input->is_ajax_request()) {
				+            show_404();
				+        }
			+        $time  = $this->input->post('time');
			+        if ($time === null) {
				+            exit('error');
				+        }
			+        if ($this->notifications_model->have_new_notification(strtotime($time))) {
				+            exit('new_notification');
				+        }
			+        exit('no_new_notification');
			+    }
		
		-	public function check()
		-	{
			-		if ( ! $this->input->is_ajax_request() )
			-			show_404();
			-		$time  = $this->input->post('time');
			-		if ($time === NULL)
			-			exit('error');
			-		if ($this->notifications_model->have_new_notification(strtotime($time)))
			-			exit('new_notification');
			-		exit('no_new_notification');
			-	}
		-
		-}
	\ No newline at end of file
	+}

----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Problems.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/controllers/Problems.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Problems.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Problems.php
	@@ -4,147 +4,159 @@
	* @file Problems.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Problems extends CI_Controller
	{
		+    private $all_assignments;
		
		-	private $all_assignments;
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function __construct()
		+    {
			+        parent::__construct();
			+        if (! $this->session->userdata('logged_in')) { // if not logged in
				+            redirect('login');
				+        }
			
			-	public function __construct()
			-	{
				-		parent::__construct();
				-		if ( ! $this->session->userdata('logged_in')) // if not logged in
				-			redirect('login');
				+        $this->all_assignments = $this->assignment_model->all_assignments();
				+    }
			
			-		$this->all_assignments = $this->assignment_model->all_assignments();
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Displays detail description of given problem
		+     *
		+     * @param int $assignment_id
		+     * @param int $problem_id
		+     */
		+    public function index($assignment_id = null, $problem_id = 1)
		+    {
			
			-	/**
			-	 * Displays detail description of given problem
			-	 *
			-	 * @param int $assignment_id
			-	 * @param int $problem_id
			-	 */
			-	public function index($assignment_id = NULL, $problem_id = 1)
			-	{
				+        // If no assignment is given, use selected assignment
				+        if ($assignment_id === null) {
					+            $assignment_id = $this->user->selected_assignment['id'];
					+        }
				+        if ($assignment_id == 0) {
					+            show_error('No assignment selected.');
					+        }
				
				-		// If no assignment is given, use selected assignment
				-		if ($assignment_id === NULL)
				-			$assignment_id = $this->user->selected_assignment['id'];
				-		if ($assignment_id == 0)
				-			show_error('No assignment selected.');
				+        $assignment = $this->assignment_model->assignment_info($assignment_id);
				
				-		$assignment = $this->assignment_model->assignment_info($assignment_id);
				+        $data = array(
				+            'all_assignments' => $this->all_assignments,
				+            'all_problems' => $this->assignment_model->all_problems($assignment_id),
				+            'description_assignment' => $assignment,
				+            'can_submit' => true,
				+        );
				
				-		$data = array(
				-			'all_assignments' => $this->all_assignments,
				-			'all_problems' => $this->assignment_model->all_problems($assignment_id),
				-			'description_assignment' => $assignment,
				-			'can_submit' => TRUE,
				-		);
				+        if (! is_numeric($problem_id) || $problem_id < 1 || $problem_id > $data['description_assignment']['problems']) {
					+            show_404();
					+        }
				
				-		if ( ! is_numeric($problem_id) || $problem_id < 1 || $problem_id > $data['description_assignment']['problems'])
				-			show_404();
				+        $languages = explode(',', $data['all_problems'][$problem_id]['allowed_languages']);
				
				-		$languages = explode(',',$data['all_problems'][$problem_id]['allowed_languages']);
				+        $assignments_root = rtrim($this->settings_model->get_setting('assignments_root'), '/');
				+        $problem_dir = "$assignments_root/assignment_{$assignment_id}/p{$problem_id}";
				+        $data['problem'] = array(
				+            'id' => $problem_id,
				+            'description' => '<p>Description not found</p>',
				+            'allowed_languages' => $languages,
				+            'has_pdf' => glob("$problem_dir/*.pdf") != false
				+        );
				
				-		$assignments_root = rtrim($this->settings_model->get_setting('assignments_root'),'/');
				-		$problem_dir = "$assignments_root/assignment_{$assignment_id}/p{$problem_id}";
				-		$data['problem'] = array(
				-			'id' => $problem_id,
				-			'description' => '<p>Description not found</p>',
				-			'allowed_languages' => $languages,
				-			'has_pdf' => glob("$problem_dir/*.pdf") != FALSE
				-		);
				+        $path = "$problem_dir/desc.html";
				+        if (file_exists($path)) {
					+            $data['problem']['description'] = file_get_contents($path);
					+        }
				
				-		$path = "$problem_dir/desc.html";
				-		if (file_exists($path))
				-			$data['problem']['description'] = file_get_contents($path);
				+        if ($assignment['id'] == 0
				+            or ($this->user->level == 0 && ! $assignment['open'])
				+            or shj_now() < strtotime($assignment['start_time'])
				+            or shj_now() > strtotime($assignment['finish_time']) + $assignment['extra_time'] // deadline = finish_time + extra_time
				+            or ! $this->assignment_model->is_participant($assignment['participants'], $this->user->username)
				+        ) {
					+            $data['can_submit'] = false;
					+        }
				
				-		if ( $assignment['id'] == 0
				-			OR ( $this->user->level == 0 && ! $assignment['open'] )
				-			OR shj_now() < strtotime($assignment['start_time'])
				-			OR shj_now() > strtotime($assignment['finish_time'])+$assignment['extra_time'] // deadline = finish_time + extra_time
				-			OR ! $this->assignment_model->is_participant($assignment['participants'], $this->user->username)
				-		)
				-			$data['can_submit'] = FALSE;
				+        $this->twig->display('pages/problems.twig', $data);
				+    }
			
			-		$this->twig->display('pages/problems.twig', $data);
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Edit problem description as html/markdown
		+     *
		+     * $type can be 'md', 'html', or 'plain'
		+     *
		+     * @param string $type
		+     * @param int $assignment_id
		+     * @param int $problem_id
		+     */
		+    public function edit($type = 'md', $assignment_id = null, $problem_id = 1)
		+    {
			+        if ($type !== 'html' && $type !== 'md' && $type !== 'plain') {
				+            show_404();
				+        }
			
			-	/**
			-	 * Edit problem description as html/markdown
			-	 *
			-	 * $type can be 'md', 'html', or 'plain'
			-	 *
			-	 * @param string $type
			-	 * @param int $assignment_id
			-	 * @param int $problem_id
			-	 */
			-	public function edit($type = 'md', $assignment_id = NULL, $problem_id = 1)
			-	{
				-		if ($type !== 'html' && $type !== 'md' && $type !== 'plain')
				-			show_404();
				+        if ($this->user->level <= 1) {
					+            show_404();
					+        }
				
				-		if ($this->user->level <= 1)
				-			show_404();
				+        switch($type) {
					+            case 'html':
					+                $ext = 'html';
					+                break;
					+            case 'md':
					+                $ext = 'md';
					+                break;
					+            case 'plain':
					+                $ext = 'html';
					+                break;
					+        }
				
				-		switch($type)
				-		{
					-			case 'html':
					-				$ext = 'html'; break;
					-			case 'md':
					-				$ext = 'md'; break;
					-			case 'plain':
					-				$ext = 'html'; break;
					-		}
				+        if ($assignment_id === null) {
					+            $assignment_id = $this->user->selected_assignment['id'];
					+        }
				+        if ($assignment_id == 0) {
					+            show_error('No assignment selected.');
					+        }
				
				-		if ($assignment_id === NULL)
				-			$assignment_id = $this->user->selected_assignment['id'];
				-		if ($assignment_id == 0)
				-			show_error('No assignment selected.');
				+        $data = array(
				+            'all_assignments' => $this->assignment_model->all_assignments(),
				+            'description_assignment' => $this->assignment_model->assignment_info($assignment_id),
				+        );
				
				-		$data = array(
				-			'all_assignments' => $this->assignment_model->all_assignments(),
				-			'description_assignment' => $this->assignment_model->assignment_info($assignment_id),
				-		);
				+        if (! is_numeric($problem_id) || $problem_id < 1 || $problem_id > $data['description_assignment']['problems']) {
					+            show_404();
					+        }
				
				-		if ( ! is_numeric($problem_id) || $problem_id < 1 || $problem_id > $data['description_assignment']['problems'])
				-			show_404();
				+        $this->form_validation->set_rules('text', 'text', ''); /* todo: xss clean */
				+        if ($this->form_validation->run()) {
					+            $this->assignment_model->save_problem_description($assignment_id, $problem_id, $this->input->post('text'), $ext);
					+            redirect('problems/'.$assignment_id.'/'.$problem_id);
					+        }
				
				-		$this->form_validation->set_rules('text', 'text' ,''); /* todo: xss clean */
				-		if ($this->form_validation->run())
				-		{
					-			$this->assignment_model->save_problem_description($assignment_id, $problem_id, $this->input->post('text'), $ext);
					-			redirect('problems/'.$assignment_id.'/'.$problem_id);
					-		}
				+        $data['problem'] = array(
				+            'id' => $problem_id,
				+            'description' => ''
				+        );
				
				-		$data['problem'] = array(
				-			'id' => $problem_id,
				-			'description' => ''
				-		);
				+        $path = rtrim($this->settings_model->get_setting('assignments_root'), '/')."/assignment_{$assignment_id}/p{$problem_id}/desc.".$ext;
				+        if (file_exists($path)) {
					+            $data['problem']['description'] = file_get_contents($path);
					+        }
				
				-		$path = rtrim($this->settings_model->get_setting('assignments_root'),'/')."/assignment_{$assignment_id}/p{$problem_id}/desc.".$ext;
				-		if (file_exists($path))
				-			$data['problem']['description'] = file_get_contents($path);
				
				+        $this->twig->display('pages/admin/edit_problem_'.$type.'.twig', $data);
				
				-		$this->twig->display('pages/admin/edit_problem_'.$type.'.twig', $data);
				+    }
			
			-	}
		
		-
		-}
	\ No newline at end of file
	+}

----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Profile.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/controllers/Profile.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Profile.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Profile.php
	@@ -4,113 +4,121 @@
	* @file Profile.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Profile extends CI_Controller
	{
		+    private $form_status;
		+    private $edit_username;
		
		-	private $form_status;
		-	private $edit_username;
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function __construct()
		+    {
			+        parent::__construct();
			+        if (! $this->session->userdata('logged_in')) { // if not logged in
				+            redirect('login');
				+        }
			+        $this->form_status = '';
			+    }
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-		if ( ! $this->session->userdata('logged_in')) // if not logged in
			-			redirect('login');
			-		$this->form_status = '';
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function index($user_id = false)
		+    {
			+        if ($user_id === false) {
				+            $user_id = $this->user_model->username_to_user_id($this->user->username);
				+        }
			
			-	public function index($user_id = FALSE)
			-	{
				-		if ($user_id === FALSE)
				-			$user_id = $this->user_model->username_to_user_id($this->user->username);
				+        if (! is_numeric($user_id)) {
					+            show_404();
					+        }
				
				-		if ( ! is_numeric($user_id))
				-			show_404();
				
				+        $user = $this->user_model->get_user($user_id);
				+        if ($user === false) {
					+            show_404();
					+        }
				+        $this->edit_username = $user->username;
				
				-		$user = $this->user_model->get_user($user_id);
				-		if ($user === FALSE)
				-			show_404();
				-		$this->edit_username = $user->username;
				+        //Non-admins are not able to update others' profile
				+        if ($this->user->level <= 2 && $this->user->username != $this->edit_username) { // permission denied
					+            show_404();
					+        }
				
				-		//Non-admins are not able to update others' profile
				-		if ($this->user->level <= 2 && $this->user->username != $this->edit_username) // permission denied
				-			show_404();
				+        $this->form_validation->set_rules('display_name', 'name', 'max_length[40]');
				+        $this->form_validation->set_rules('email', 'email address', 'required|max_length[40]|valid_email|callback__email_check', array('_email_check' => 'This %s already exists.'));
				+        $this->form_validation->set_rules('password', 'password', 'callback__password_check', array('_password_check' => 'The %s field must be between 6 and 200 characters in length.'));
				+        $this->form_validation->set_rules('password_again', 'password confirmation', 'callback__password_again_check', array('_password_again_check' => 'The %s field does not match the password field.'));
				+        $this->form_validation->set_rules('role', 'role', 'callback__role_check');
				+        if ($this->form_validation->run()) {
					+            $this->user_model->update_profile($user_id);
					+            $user = $this->user_model->get_user($user_id);
					+            $this->form_status = 'ok';
					+        }
				+        $data = array(
				+            'all_assignments' => $this->assignment_model->all_assignments(),
				+            'id' => $user_id,
				+            'edit_username' => $this->edit_username,
				+            'email' => $user->email,
				+            'display_name' => $user->display_name,
				+            'role' => $user->role,
				+            'form_status' => $this->form_status,
				+            'lock_student_display_name' => $this->settings_model->get_setting(lock_student_display_name),
				+        );
				
				-		$this->form_validation->set_rules('display_name', 'name', 'max_length[40]');
				-		$this->form_validation->set_rules('email', 'email address', 'required|max_length[40]|valid_email|callback__email_check', array('_email_check' => 'This %s already exists.'));
				-		$this->form_validation->set_rules('password', 'password', 'callback__password_check', array('_password_check' => 'The %s field must be between 6 and 200 characters in length.'));
				-		$this->form_validation->set_rules('password_again', 'password confirmation', 'callback__password_again_check', array('_password_again_check' => 'The %s field does not match the password field.'));
				-		$this->form_validation->set_rules('role', 'role', 'callback__role_check');
				-		if ($this->form_validation->run()){
					-			$this->user_model->update_profile($user_id);
					-			$user = $this->user_model->get_user($user_id);
					-			$this->form_status = 'ok';
					-		}
				-		$data = array(
				-			'all_assignments' => $this->assignment_model->all_assignments(),
				-			'id' => $user_id,
				-			'edit_username' => $this->edit_username,
				-			'email' => $user->email,
				-			'display_name' => $user->display_name,
				-			'role' => $user->role,
				-			'form_status' => $this->form_status,
				-			'lock_student_display_name' => $this->settings_model->get_setting(lock_student_display_name),
				-		);
				+        $this->twig->display('pages/profile.twig', $data);
				+    }
			
			-		$this->twig->display('pages/profile.twig', $data);
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function _password_check($str)
		+    {
			+        if (strlen($str) == 0 or (strlen($str) >= 6 && strlen($str) <= 200)) {
				+            return true;
				+        }
			+        return false;
			+    }
		
		-	public function _password_check($str)
		-	{
			-		if (strlen($str) == 0 OR (strlen($str) >= 6 && strlen($str) <= 200))
			-			return TRUE;
			-		return FALSE;
			-	}
		+    public function _password_again_check($str)
		+    {
			+        if ($this->input->post('password') !== $this->input->post('password_again')) {
				+            return false;
				+        }
			+        return true;
			+    }
		
		-	public function _password_again_check($str)
		-	{
			-		if ($this->input->post('password') !== $this->input->post('password_again'))
			-			return FALSE;
			-		return TRUE;
			-	}
		+    /**
		+     * Checks whether a user with this email exists
		+     */
		+    public function _email_check($email)
		+    {
			+        if ($this->user_model->have_email($email, $this->edit_username)) {
				+            return false;
				+        }
			+        return true;
			+    }
		
		-	/**
		-	 * Checks whether a user with this email exists
		-	 */
		-	public function _email_check($email)
		-	{
			-		if ($this->user_model->have_email($email, $this->edit_username))
			-			return FALSE;
			-		return TRUE;
			-	}
		+    /**
		+     * For validating user role
		+     */
		+    public function _role_check($role)
		+    {
			+        // Non-admin users should not be able to change user role:
			+        if ($this->user->level <= 2) {
				+            return ($role == '');
				+        }
			
			-	/**
			-	 * For validating user role
			-	 */
			-	public function _role_check($role)
			-	{
				-		// Non-admin users should not be able to change user role:
				-		if ($this->user->level <= 2)
				-			return ($role == '');
				-
				-		// Admins can change everybody's user role:
				-		$roles = array('admin', 'head_instructor', 'instructor', 'student');
				-		return in_array($role, $roles);
				-	}
			+        // Admins can change everybody's user role:
			+        $roles = array('admin', 'head_instructor', 'instructor', 'student');
			+        return in_array($role, $roles);
			+    }
		
		
	}
	
	----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Queue.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/controllers/Queue.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Queue.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Queue.php
	@@ -4,71 +4,74 @@
	* @file Queue.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Queue extends CI_Controller
	{
		+    public function __construct()
		+    {
			+        parent::__construct();
			+        if (! $this->session->userdata('logged_in')) { // if not logged in
				+            redirect('login');
				+        }
			+        if ($this->user->level <= 1) { // permission denied
				+            show_404();
				+        }
			+        $this->load->model('queue_model');
			+    }
		
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-		if ( ! $this->session->userdata('logged_in')) // if not logged in
			-		redirect('login');
			-		if ( $this->user->level <= 1) // permission denied
			-			show_404();
			-		$this->load->model('queue_model');
			-	}
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		+    public function index()
		+    {
			
			+        $data = array(
			+            'all_assignments' => $this->assignment_model->all_assignments(),
			+            'queue' => $this->queue_model->get_queue(),
			+            'working' => $this->settings_model->get_setting('queue_is_working')
			+        );
			
			-	public function index()
			-	{
				+        $this->twig->display('pages/admin/queue.twig', $data);
				+    }
			
			-		$data = array(
			-			'all_assignments' => $this->assignment_model->all_assignments(),
			-			'queue' => $this->queue_model->get_queue(),
			-			'working' => $this->settings_model->get_setting('queue_is_working')
			-		);
			
			-		$this->twig->display('pages/admin/queue.twig', $data);
			-	}
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		+    public function pause()
		+    {
			+        if (! $this->input->is_ajax_request()) {
				+            show_404();
				+        }
			+        $this->settings_model->set_setting('queue_is_working', '0');
			+        echo 'success';
			+    }
		
		
		-	public function pause()
		-	{
			-		if ( ! $this->input->is_ajax_request() )
			-			show_404();
			-		$this->settings_model->set_setting('queue_is_working','0');
			-		echo 'success';
			-	}
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		+    public function resume()
		+    {
			+        if (! $this->input->is_ajax_request()) {
				+            show_404();
				+        }
			+        process_the_queue();
			+        echo 'success';
			+    }
		
		
		-	public function resume()
		-	{
			-		if ( ! $this->input->is_ajax_request() )
			-			show_404();
			-		process_the_queue();
			-		echo 'success';
			-	}
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		-
		-
		-	public function empty_queue()
		-	{
			-		if ( ! $this->input->is_ajax_request() )
			-			show_404();
			-		$this->queue_model->empty_queue();
			-		echo 'success';
			-	}
		-}
	\ No newline at end of file
	+    public function empty_queue()
	+    {
		+        if (! $this->input->is_ajax_request()) {
			+            show_404();
			+        }
		+        $this->queue_model->empty_queue();
		+        echo 'success';
		+    }
	+}

----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Queueprocess.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/controllers/Queueprocess.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Queueprocess.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Queueprocess.php
	@@ -4,155 +4,155 @@
	* @file Queueprocess.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Queueprocess extends CI_Controller
	{
		+    public function __construct()
		+    {
			+        parent::__construct();
			+        // This controller should not be called from a browser
			+        if (! is_cli()) {
				+            show_404();
				+        }
			+        $this->load->model('queue_model')->model('submit_model');
			+    }
		
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-		// This controller should not be called from a browser
			-		if ( ! is_cli() )
			-			show_404();
			-		$this->load->model('queue_model')->model('submit_model');
			-	}
		
		
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		
		
		+    /**
		+     * This is the main function for processing the queue
		+     * This function judges queue items one by one
		+     */
		+    public function run()
		+    {
			
			+        // Set correct base_url
			+        // Because we are in cli mode, base_url is not available, and we get
			+        // it from an environment variable that we have set in shj_helper.php
			+        $this->config->set_item('base_url', getenv('SHJ_BASE_URL'));
			
			-	/**
			-	 * This is the main function for processing the queue
			-	 * This function judges queue items one by one
			-	 */
			-	public function run()
			-	{
				+        $queue_item = $this->queue_model->get_first_item();
				+        if ($queue_item === null) {
					+            $this->settings_model->set_setting('queue_is_working', '0');
					+            exit;
					+        }
				+        if ($this->settings_model->get_setting('queue_is_working')) {
					+            exit;
					+        }
				
				-		// Set correct base_url
				-		// Because we are in cli mode, base_url is not available, and we get
				-		// it from an environment variable that we have set in shj_helper.php
				-		$this->config->set_item('base_url', getenv('SHJ_BASE_URL'));
				+        $this->settings_model->set_setting('queue_is_working', '1');
				
				-		$queue_item = $this->queue_model->get_first_item();
				-		if ($queue_item === NULL) {
					-			$this->settings_model->set_setting('queue_is_working', '0');
					-			exit;
					-		}
				-		if ($this->settings_model->get_setting('queue_is_working'))
				-			exit;
				
				-		$this->settings_model->set_setting('queue_is_working', '1');
				+        do { // loop over queue items
					
					+            $submit_id = $queue_item['submit_id'];
					+            $username = $queue_item['username'];
					+            $assignment = $queue_item['assignment'];
					+            $assignment_info = $this->assignment_model->assignment_info($assignment);
					+            $problem = $this->assignment_model->problem_info($assignment, $queue_item['problem']);
					+            $type = $queue_item['type'];  // $type can be 'judge', 'rejudge', or 'exec'
					
					-		do { // loop over queue items
						+            $submission = $this->submit_model->get_submission($username, $assignment, $problem['id'], $submit_id);
						
						-			$submit_id = $queue_item['submit_id'];
						-			$username = $queue_item['username'];
						-			$assignment = $queue_item['assignment'];
						-			$assignment_info = $this->assignment_model->assignment_info($assignment);
						-			$problem = $this->assignment_model->problem_info($assignment, $queue_item['problem']);
						-			$type = $queue_item['type'];  // $type can be 'judge', 'rejudge', or 'exec'
						+            $file_type = $submission['file_type'];
						+            $file_extension = filetype_to_extension($file_type);
						+            $raw_filename = $submission['file_name'];
						+            $main_filename = $submission['main_file_name'];
						
						-			$submission = $this->submit_model->get_submission($username, $assignment, $problem['id'], $submit_id);
						+            $assignments_dir = rtrim($this->settings_model->get_setting('assignments_root'), '/');
						+            $tester_path = rtrim($this->settings_model->get_setting('tester_path'), '/');
						+            $problemdir = $assignments_dir."/assignment_$assignment/p".$problem['id'];
						+            $userdir = "$problemdir/$username";
						+            //$the_file = "$userdir/$raw_filename.$file_extension";
						
						-			$file_type = $submission['file_type'];
						-			$file_extension = filetype_to_extension($file_type);
						-			$raw_filename = $submission['file_name'];
						-			$main_filename = $submission['main_file_name'];
						+            $op1 = $this->settings_model->get_setting('enable_log');
						+            $op2 = $this->settings_model->get_setting('enable_easysandbox');
						+            $op3 = 0;
						+            if ($file_type === 'c') {
							+                $op3 = $this->settings_model->get_setting('enable_c_shield');
							+            } elseif ($file_type === 'cpp') {
							+                $op3 = $this->settings_model->get_setting('enable_cpp_shield');
							+            }
						+            $op4 = 0;
						+            if ($file_type === 'py2') {
							+                $op4 = $this->settings_model->get_setting('enable_py2_shield');
							+            } elseif ($file_type === 'py3') {
							+                $op4 = $this->settings_model->get_setting('enable_py3_shield');
							+            }
						+            $op5 = $this->settings_model->get_setting('enable_java_policy');
						+            $op6 = $assignment_info['javaexceptions'];
						+            if($type === 'exec') {
							+                $exec_only = true;
							+                $op7 = 1;
							+            } else {
							+                $op7 = 0;
							+            }
						
						-			$assignments_dir = rtrim($this->settings_model->get_setting('assignments_root'), '/');
						-			$tester_path = rtrim($this->settings_model->get_setting('tester_path'), '/');
						-			$problemdir = $assignments_dir."/assignment_$assignment/p".$problem['id'];
						-			$userdir = "$problemdir/$username";
						-			//$the_file = "$userdir/$raw_filename.$file_extension";
						+            if ($file_type === 'c' or $file_type === 'cpp') {
							+                $time_limit = $problem['c_time_limit'] / 1000;
							+            } elseif ($file_type === 'java') {
							+                $time_limit = $problem['java_time_limit'] / 1000;
							+            } elseif ($file_extension === 'py') {
							+                $time_limit = $problem['python_time_limit'] / 1000;
							+            }
						+            $time_limit = round($time_limit, 3);
						+            $time_limit_int = floor($time_limit) + 1;
						
						-			$op1 = $this->settings_model->get_setting('enable_log');
						-			$op2 = $this->settings_model->get_setting('enable_easysandbox');
						-			$op3 = 0;
						-			if ($file_type === 'c')
						-				$op3 = $this->settings_model->get_setting('enable_c_shield');
						-			elseif ($file_type === 'cpp')
						-				$op3 = $this->settings_model->get_setting('enable_cpp_shield');
						-			$op4 = 0;
						-			if ($file_type === 'py2')
						-				$op4 = $this->settings_model->get_setting('enable_py2_shield');
						-			elseif ($file_type === 'py3')
						-				$op4 = $this->settings_model->get_setting('enable_py3_shield');
						-			$op5 = $this->settings_model->get_setting('enable_java_policy');
						-			$op6 = $assignment_info['javaexceptions'];
						-			if($type === 'exec') {
							-				$exec_only = TRUE;
							-				$op7 = 1;
							-			}
						-			else {
							-				$op7 = 0;
							-			}
						-				
						-			if ($file_type === 'c' OR $file_type === 'cpp')
						-				$time_limit = $problem['c_time_limit']/1000;
						-			elseif ($file_type === 'java')
						-				$time_limit = $problem['java_time_limit']/1000;
						-			elseif ($file_extension === 'py')
						-				$time_limit = $problem['python_time_limit']/1000;
						-			$time_limit = round($time_limit, 3);
						-			$time_limit_int = floor($time_limit) + 1;
						+            $memory_limit = $problem['memory_limit'];
						+            $diff_cmd = $problem['diff_cmd'];
						+            $diff_arg = $problem['diff_arg'];
						+            $output_size_limit = $this->settings_model->get_setting('output_size_limit') * 1024;
						
						-			$memory_limit = $problem['memory_limit'];
						-			$diff_cmd = $problem['diff_cmd'];
						-			$diff_arg = $problem['diff_arg'];
						-			$output_size_limit = $this->settings_model->get_setting('output_size_limit') * 1024;
						+            $cmd = "cd $tester_path;\n./tester.sh $problemdir ".escapeshellarg($username).' '.escapeshellarg($main_filename).' '.escapeshellarg($raw_filename)." $file_type $time_limit $time_limit_int $memory_limit $output_size_limit $diff_cmd $diff_arg $op1 $op2 $op3 $op4 $op5 $op6 $op7";
						
						-			$cmd = "cd $tester_path;\n./tester.sh $problemdir ".escapeshellarg($username).' '.escapeshellarg($main_filename).' '.escapeshellarg($raw_filename)." $file_type $time_limit $time_limit_int $memory_limit $output_size_limit $diff_cmd $diff_arg $op1 $op2 $op3 $op4 $op5 $op6 $op7";
						+            file_put_contents($userdir.'/log', $cmd);
						
						-			file_put_contents($userdir.'/log', $cmd);
						+            ///////////////////////////////////////
						+            // Running tester (judging the code) //
						+            ///////////////////////////////////////
						+            putenv('LANG=en_US.UTF-8');
						+            $output = trim(shell_exec($cmd));
						
						-			///////////////////////////////////////
						-			// Running tester (judging the code) //
						-			///////////////////////////////////////
						-			putenv('LANG=en_US.UTF-8');
						-			$output = trim(shell_exec($cmd));
						
						+            // Deleting the jail folder, if still exists
						+            shell_exec("cd $tester_path; rm -rf jail*");
						
						-			// Deleting the jail folder, if still exists
						-			shell_exec("cd $tester_path; rm -rf jail*");
						+            // Saving judge result
						+            if (is_numeric($output) || $output === 'Compilation Error' || $output === 'Syntax Error') {
							+                shell_exec("mv $userdir/result.html $userdir/result-{$submit_id}.html");
							+                shell_exec("mv $userdir/log $userdir/log-{$submit_id}");
							+            }
						
						-			// Saving judge result
						-			if ( is_numeric($output) || $output === 'Compilation Error' || $output === 'Syntax Error' )
						-			{
							-				shell_exec("mv $userdir/result.html $userdir/result-{$submit_id}.html");
							-				shell_exec("mv $userdir/log $userdir/log-{$submit_id}");
							-			}
						+            if (is_numeric($output)) {
							+                $submission['pre_score'] = $output;
							+                $submission['status'] = 'SCORE';
							+            } else {
							+                $submission['pre_score'] = 0;
							+                $submission['status'] = $output;
							+            }
						
						-			if (is_numeric($output)) {
							-				$submission['pre_score'] = $output;
							-				$submission['status'] = 'SCORE';
							-			}
						-			else {
							-				$submission['pre_score'] = 0;
							-				$submission['status'] = $output;
							-			}
						+            //reconnect to database incase we have run test for a long time.
						+            $this->db->reconnect();
						+            // Save the result
						+            $this->queue_model->save_judge_result_in_db($submission, $type);
						
						-			//reconnect to database incase we have run test for a long time.
						-			$this->db->reconnect();
						-			// Save the result
						-			$this->queue_model->save_judge_result_in_db($submission, $type);
						+            // Remove the judged item from queue
						+            $this->queue_model->remove_item($username, $assignment, $problem['id'], $submit_id);
						
						-			// Remove the judged item from queue
						-			$this->queue_model->remove_item($username, $assignment, $problem['id'], $submit_id);
						+            // Get next item from queue
						+            $queue_item = $this->queue_model->get_first_item();
						
						-			// Get next item from queue
						-			$queue_item = $this->queue_model->get_first_item();
						+        } while($queue_item !== null && $this->settings_model->get_setting('queue_is_working'));
					
					-		}while($queue_item !== NULL && $this->settings_model->get_setting('queue_is_working'));
				+        $this->settings_model->set_setting('queue_is_working', '0');
				
				-		$this->settings_model->set_setting('queue_is_working', '0');
				-
				-	}
			+    }
		
	}
	
	----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Rejudge.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/controllers/Rejudge.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Rejudge.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Rejudge.php
	@@ -4,82 +4,81 @@
	* @file Rejudge.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Rejudge extends CI_Controller
	{
		+    public function __construct()
		+    {
			+        parent::__construct();
			+        if (! $this->session->userdata('logged_in')) { // if not logged in
				+            redirect('login');
				+        }
			+        if ($this->user->level <= 1) { // permission denied
				+            show_404();
				+        }
			+        $this->problems = $this->assignment_model->all_problems($this->user->selected_assignment['id']);
			+    }
		
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-		if ( ! $this->session->userdata('logged_in')) // if not logged in
			-			redirect('login');
			-		if ( $this->user->level <= 1) // permission denied
			-			show_404();
			-		$this->problems = $this->assignment_model->all_problems($this->user->selected_assignment['id']);
			-	}
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		+    public function index()
		+    {
			
			+        $this->form_validation->set_rules('problem_id', 'problem id', 'required|integer');
			
			-	public function index()
			-	{
				+        $data = array(
				+            'all_assignments' => $this->assignment_model->all_assignments(),
				+            'problems' => $this->problems,
				+            'msg' => array()
				+        );
				
				-		$this->form_validation->set_rules('problem_id', 'problem id', 'required|integer');
				+        if ($this->form_validation->run()) {
					+            $problem_id = $this->input->post('problem_id');
					+            $this->load->model('queue_model');
					+            $this->queue_model->rejudge($this->user->selected_assignment['id'], $problem_id);
					+            process_the_queue();
					+            $data['msg'] = array('Rejudge in progress');
					+        }
				
				-		$data = array(
				-			'all_assignments' => $this->assignment_model->all_assignments(),
				-			'problems' => $this->problems,
				-			'msg' => array()
				-		);
				+        $this->twig->display('pages/admin/rejudge.twig', $data);
				+    }
			
			-		if ($this->form_validation->run())
			-		{
				-			$problem_id = $this->input->post('problem_id');
				-			$this->load->model('queue_model');
				-			$this->queue_model->rejudge($this->user->selected_assignment['id'], $problem_id);
				-			process_the_queue();
				-			$data['msg'] = array('Rejudge in progress');
				-		}
			
			-		$this->twig->display('pages/admin/rejudge.twig', $data);
			-	}
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		+    public function rejudge_single()
		+    {
			+        if (! $this->input->is_ajax_request()) {
				+            show_404();
				+        }
			
			+        $this->form_validation->set_rules('submit_id', 'submit id', 'required|integer');
			+        $this->form_validation->set_rules('username', 'username', 'required|alpha_numeric');
			+        $this->form_validation->set_rules('assignment', 'assignment', 'required|integer');
			+        $this->form_validation->set_rules('problem', 'problem', 'required|integer');
			
			-	public function rejudge_single()
			-	{
				-		if ( ! $this->input->is_ajax_request() )
				-			show_404();
				+        if ($this->form_validation->run()) {
					+            $this->load->model('queue_model');
					+            $this->queue_model->rejudge_single(
					+                array(
					+                    'submit_id' => $this->input->post('submit_id'),
					+                    'username' => $this->input->post('username'),
					+                    'assignment' => $this->input->post('assignment'),
					+                    'problem' => $this->input->post('problem'),
					+                )
					+            );
					+            process_the_queue();
					+            $json_result = array('done' => 1);
					+        } else {
					+            $json_result = array('done' => 0, 'message' => 'Input Error');
					+        }
				
				-		$this->form_validation->set_rules('submit_id', 'submit id', 'required|integer');
				-		$this->form_validation->set_rules('username', 'username', 'required|alpha_numeric');
				-		$this->form_validation->set_rules('assignment', 'assignment', 'required|integer');
				-		$this->form_validation->set_rules('problem', 'problem', 'required|integer');
				+        $this->output->set_header('Content-Type: application/json; charset=utf-8');
				+        echo json_encode($json_result);
				+    }
			
			-		if ($this->form_validation->run())
			-		{
				-			$this->load->model('queue_model');
				-			$this->queue_model->rejudge_single(
				-				array(
				-					'submit_id' => $this->input->post('submit_id'),
				-					'username' => $this->input->post('username'),
				-					'assignment' => $this->input->post('assignment'),
				-					'problem' => $this->input->post('problem'),
				-				)
				-			);
				-			process_the_queue();
				-			$json_result = array('done' => 1);
				-		}
			-		else
			-			$json_result = array('done' => 0, 'message' => 'Input Error');
			-
			-		$this->output->set_header('Content-Type: application/json; charset=utf-8');
			-		echo json_encode($json_result);
			-	}
		-
		-}
	\ No newline at end of file
	+}

----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Scoreboard.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/controllers/Scoreboard.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Scoreboard.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Scoreboard.php
	@@ -4,37 +4,37 @@
	* @file Scoreboard.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Scoreboard extends CI_Controller
	{
		+    public function __construct()
		+    {
			+        parent::__construct();
			+        if ($this->input->is_cli_request()) {
				+            return;
				+        }
			+        if (! $this->session->userdata('logged_in')) { // if not logged in
				+            redirect('login');
				+        }
			+    }
		
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-		if ($this->input->is_cli_request())
			-			return;
			-		if ( ! $this->session->userdata('logged_in')) // if not logged in
			-			redirect('login');
			-	}
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		+    public function index()
		+    {
			
			+        $this->load->model('scoreboard_model');
			
			-	public function index()
			-	{
				+        $data = array(
				+            'all_assignments' => $this->assignment_model->all_assignments(),
				+            'scoreboard' => $this->scoreboard_model->get_scoreboard($this->user->selected_assignment['id'])
				+        );
				
				-		$this->load->model('scoreboard_model');
				+        $this->twig->display('pages/scoreboard.twig', $data);
				+    }
			
			-		$data = array(
			-			'all_assignments' => $this->assignment_model->all_assignments(),
			-			'scoreboard' => $this->scoreboard_model->get_scoreboard($this->user->selected_assignment['id'])
			-		);
			
			-		$this->twig->display('pages/scoreboard.twig', $data);
			-	}
		-
		-
		-}
	\ No newline at end of file
	+}

----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Server\_time.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/controllers/Server_time.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Server_time.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Server_time.php
	@@ -4,29 +4,30 @@
	* @file Server_time.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Server_time extends CI_Controller
	{
		+    public function __construct()
		+    {
			+        parent::__construct();
			+        if (! $this->input->is_ajax_request()) {
				+            show_404();
				+        }
			+        if (! $this->session->userdata('logged_in')) { // if not logged in
				+            exit;
				+        }
			+    }
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-		if ( ! $this->input->is_ajax_request() )
			-			show_404();
			-		if ( ! $this->session->userdata('logged_in')) // if not logged in
			-			exit;
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		-
		-	/**
		-	 * Prints server time, used for server time synchronization
		-	 */
		-	public function index()
		-	{
			-		echo shj_now_str();
			-	}
		-}
	\ No newline at end of file
	+    /**
	+     * Prints server time, used for server time synchronization
	+     */
	+    public function index()
	+    {
		+        echo shj_now_str();
		+    }
	+}

----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Settings.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/controllers/Settings.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Settings.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Settings.php
	@@ -4,124 +4,135 @@
	* @file Settings.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Settings extends CI_Controller
	{
		+    private $form_status;
		+    private $errors;
		
		-	private $form_status;
		-	private $errors;
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function __construct()
		+    {
			+        parent::__construct();
			+        if (! $this->session->userdata('logged_in')) { // if not logged in
				+            redirect('login');
				+        }
			+        if ($this->user->level <= 2) { // permission denied
				+            show_404();
				+        }
			+        $this->form_status = '';
			+        $this->errors = array();
			+    }
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-		if ( ! $this->session->userdata('logged_in')) // if not logged in
			-			redirect('login');
			-		if ( $this->user->level <= 2) // permission denied
			-			show_404();
			-		$this->form_status = '';
			-		$this->errors = array();
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function index()
		+    {
			+        $settings = $this->settings_model->get_all_settings();
			+        $data = array_merge(
			+            $settings,
			+            array(
			+                'all_assignments' => $this->assignment_model->all_assignments(),
			+                'sandbox_built' => file_exists(rtrim($settings['tester_path'], '/').'/easysandbox/EasySandbox.so'),
			+                'form_status' => $this->form_status,
			+                'errors' => $this->errors
			+            )
			+        );
			+        ob_start();
			+        $data ['defc'] = file_get_contents(rtrim($settings['tester_path'], '/').'/shield/defc.h');
			+        $data ['defcpp'] = file_get_contents(rtrim($settings['tester_path'], '/').'/shield/defcpp.h');
			+        $data ['shield_py2'] = file_get_contents(rtrim($settings['tester_path'], '/').'/shield/shield_py2.py');
			+        $data ['shield_py3'] = file_get_contents(rtrim($settings['tester_path'], '/').'/shield/shield_py3.py');
			+        ob_end_clean();
			+        $this->twig->display('pages/admin/settings.twig', $data);
			+    }
		
		-	public function index()
		-	{
			-		$settings = $this->settings_model->get_all_settings();
			-		$data = array_merge($settings,
			-			array(
			-				'all_assignments' => $this->assignment_model->all_assignments(),
			-				'sandbox_built' => file_exists(rtrim($settings['tester_path'], '/').'/easysandbox/EasySandbox.so'),
			-				'form_status' => $this->form_status,
			-				'errors' => $this->errors
			-			)
			-		);
			-		ob_start();
			-		$data ['defc'] = file_get_contents(rtrim($settings['tester_path'], '/').'/shield/defc.h');
			-		$data ['defcpp'] = file_get_contents(rtrim($settings['tester_path'], '/').'/shield/defcpp.h');
			-		$data ['shield_py2'] = file_get_contents(rtrim($settings['tester_path'], '/').'/shield/shield_py2.py');
			-		$data ['shield_py3'] = file_get_contents(rtrim($settings['tester_path'], '/').'/shield/shield_py3.py');
			-		ob_end_clean();
			-		$this->twig->display('pages/admin/settings.twig', $data);
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function update()
		+    {
			+        $this->form_validation->set_rules('timezone', 'timezone', 'required');
			+        $this->form_validation->set_rules('file_size_limit', 'File size limit', 'integer|greater_than_equal_to[0]');
			+        $this->form_validation->set_rules('output_size_limit', 'Output size limit', 'integer|greater_than_equal_to[0]');
			+        $this->form_validation->set_rules('rpp_all', 'results per page (all submissions)', 'integer|greater_than_equal_to[0]');
			+        $this->form_validation->set_rules('rpp_final', 'results per page (final submissions)', 'integer|greater_than_equal_to[0]');
			+        $this->form_validation->set_rules('mail_from', 'email', 'valid_email');
			+        if($this->form_validation->run()) {
				+            ob_start();
				+            $this->form_status = 'ok';
				+            $tester_path = rtrim($this->settings_model->get_setting('tester_path'), '/');
				+            $defc_path = $tester_path.'/shield/defc.h';
				+            $defcpp_path = $tester_path.'/shield/defcpp.h';
				+            $shpy2_path = $tester_path.'/shield/shield_py2.py';
				+            $shpy3_path = $tester_path.'/shield/shield_py3.py';
				+            if ($this->input->post('def_c') !== file_get_contents($defc_path)) {
					+                if (file_exists($defc_path) && file_put_contents($defc_path, $this->input->post('def_c')) === false) {
						+                    array_push($this->errors, 'File defc.h is not writable. Edit it manually.');
						+                }
					+            }
				+            if ($this->input->post('def_cpp') !== file_get_contents($defcpp_path)) {
					+                if (file_exists($defcpp_path) && file_put_contents($defcpp_path, $this->input->post('def_cpp')) === false) {
						+                    array_push($this->errors, 'File defcpp.h is not writable. Edit it manually.');
						+                }
					+            }
				+            if ($this->input->post('shield_py2') !== file_get_contents($shpy2_path)) {
					+                if (file_exists($shpy2_path) && file_put_contents($shpy2_path, $this->input->post('shield_py2')) === false) {
						+                    array_push($this->errors, 'File shield_py2.py is not writable. Edit it manually.');
						+                }
					+            }
				+            if ($this->input->post('shield_py3') !== file_get_contents($shpy3_path)) {
					+                if (file_exists($shpy3_path) && file_put_contents($shpy3_path, $this->input->post('shield_py3')) === false) {
						+                    array_push($this->errors, 'File shield_py3.py is not writable. Edit it manually.');
						+                }
					+            }
				+            ob_end_clean();
				+            $timezone = $this->input->post('timezone');
				+            // if timezone is invalid, set it to 'Asia/Tehran' :
				+            if (! in_array($timezone, DateTimeZone::listIdentifiers())) {
					+                $timezone = 'Asia/Tehran';
					+            }
				
				-	public function update()
				-	{
					-		$this->form_validation->set_rules('timezone', 'timezone', 'required');
					-		$this->form_validation->set_rules('file_size_limit', 'File size limit', 'integer|greater_than_equal_to[0]');
					-		$this->form_validation->set_rules('output_size_limit', 'Output size limit', 'integer|greater_than_equal_to[0]');
					-		$this->form_validation->set_rules('rpp_all', 'results per page (all submissions)', 'integer|greater_than_equal_to[0]');
					-		$this->form_validation->set_rules('rpp_final', 'results per page (final submissions)', 'integer|greater_than_equal_to[0]');
					-		$this->form_validation->set_rules('mail_from', 'email', 'valid_email');
					-		if($this->form_validation->run()){
						-			ob_start();
						-			$this->form_status = 'ok';
						-			$tester_path = rtrim($this->settings_model->get_setting('tester_path'), '/');
						-			$defc_path = $tester_path.'/shield/defc.h';
						-			$defcpp_path = $tester_path.'/shield/defcpp.h';
						-			$shpy2_path = $tester_path.'/shield/shield_py2.py';
						-			$shpy3_path = $tester_path.'/shield/shield_py3.py';
						-			if ($this->input->post('def_c') !== file_get_contents($defc_path))
						-				if (file_exists($defc_path) && file_put_contents($defc_path,$this->input->post('def_c')) === FALSE)
						-					array_push($this->errors, 'File defc.h is not writable. Edit it manually.');
						-			if ($this->input->post('def_cpp') !== file_get_contents($defcpp_path))
						-				if (file_exists($defcpp_path) && file_put_contents($defcpp_path,$this->input->post('def_cpp')) === FALSE)
						-					array_push($this->errors, 'File defcpp.h is not writable. Edit it manually.');
						-			if ($this->input->post('shield_py2') !== file_get_contents($shpy2_path))
						-				if (file_exists($shpy2_path) && file_put_contents($shpy2_path,$this->input->post('shield_py2')) === FALSE)
						-					array_push($this->errors, 'File shield_py2.py is not writable. Edit it manually.');
						-			if ($this->input->post('shield_py3') !== file_get_contents($shpy3_path))
						-				if (file_exists($shpy3_path) && file_put_contents($shpy3_path,$this->input->post('shield_py3')) === FALSE)
						-					array_push($this->errors, 'File shield_py3.py is not writable. Edit it manually.');
						-			ob_end_clean();
						-			$timezone = $this->input->post('timezone');
						-			// if timezone is invalid, set it to 'Asia/Tehran' :
						-			if ( ! in_array($timezone, DateTimeZone::listIdentifiers()) )
						-				$timezone='Asia/Tehran';
						+            $this->settings_model->set_settings(
						+                array(
						+                    'timezone' => $timezone,
						+                    'tester_path' => $this->input->post('tester_path'),
						+                    'assignments_root' => $this->input->post('assignments_root'),
						+                    'file_size_limit' => $this->input->post('file_size_limit'),
						+                    'output_size_limit' => $this->input->post('output_size_limit'),
						+                    'default_late_rule' => $this->input->post('default_late_rule'),
						+                    'enable_easysandbox' => $this->input->post('enable_easysandbox') === null ? 0 : 1,
						+                    'enable_c_shield' => $this->input->post('enable_c_shield') === null ? 0 : 1,
						+                    'enable_cpp_shield' => $this->input->post('enable_cpp_shield') === null ? 0 : 1,
						+                    'enable_py2_shield' => $this->input->post('enable_py2_shield') === null ? 0 : 1,
						+                    'enable_py3_shield' => $this->input->post('enable_py3_shield') === null ? 0 : 1,
						+                    'enable_java_policy' => $this->input->post('enable_java_policy') === null ? 0 : 1,
						+                    'enable_log' => $this->input->post('enable_log') === null ? 0 : 1,
						+                    'enable_registration' => $this->input->post('enable_registration') === null ? 0 : 1,
						+                    'registration_code' => $this->input->post('registration_code'),
						+                    'mail_from' => $this->input->post('mail_from'),
						+                    'mail_from_name' => $this->input->post('mail_from_name'),
						+                    'reset_password_mail' => $this->input->post('reset_password_mail'),
						+                    'add_user_mail' => $this->input->post('add_user_mail'),
						+                    'results_per_page_all' => $this->input->post('rpp_all'),
						+                    'results_per_page_final' => $this->input->post('rpp_final'),
						+                    'week_start' => $this->input->post('week_start'),
						+                    'lock_student_display_name' => $this->input->post('lock_student_display_name') === null ? 0 : 1,
						+                )
						+            );
						
						-			$this->settings_model->set_settings(
						-				array(
						-					'timezone' => $timezone,
						-					'tester_path' => $this->input->post('tester_path'),
						-					'assignments_root' => $this->input->post('assignments_root'),
						-					'file_size_limit' => $this->input->post('file_size_limit'),
						-					'output_size_limit' => $this->input->post('output_size_limit'),
						-					'default_late_rule' => $this->input->post('default_late_rule'),
						-					'enable_easysandbox' => $this->input->post('enable_easysandbox')===NULL?0:1,
						-					'enable_c_shield' => $this->input->post('enable_c_shield')===NULL?0:1,
						-					'enable_cpp_shield' => $this->input->post('enable_cpp_shield')===NULL?0:1,
						-					'enable_py2_shield' => $this->input->post('enable_py2_shield')===NULL?0:1,
						-					'enable_py3_shield' => $this->input->post('enable_py3_shield')===NULL?0:1,
						-					'enable_java_policy' => $this->input->post('enable_java_policy')===NULL?0:1,
						-					'enable_log' => $this->input->post('enable_log')===NULL?0:1,
						-					'enable_registration' => $this->input->post('enable_registration')===NULL?0:1,
						-					'registration_code' => $this->input->post('registration_code'),
						-					'mail_from' => $this->input->post('mail_from'),
						-					'mail_from_name' => $this->input->post('mail_from_name'),
						-					'reset_password_mail' => $this->input->post('reset_password_mail'),
						-					'add_user_mail' => $this->input->post('add_user_mail'),
						-					'results_per_page_all' => $this->input->post('rpp_all'),
						-					'results_per_page_final' => $this->input->post('rpp_final'),
						-					'week_start' => $this->input->post('week_start'),
						-					'lock_student_display_name' => $this->input->post('lock_student_display_name')===NULL?0:1,
						-				)
						-			);
						-
						-		}
					-		else
					-			$this->form_status = 'error';
					-		$this->index();
					-	}
				+        } else {
				+            $this->form_status = 'error';
				+        }
			+        $this->index();
			+    }
		
		
	}
	
	----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Submissions.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/controllers/Submissions.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Submissions.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Submissions.php
	@@ -4,7 +4,7 @@
	* @file Submissions.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	use PhpOffice\PhpSpreadsheet\Spreadsheet;
	use PhpOffice\PhpSpreadsheet\IOFactory;
	@@ -15,539 +15,566 @@
	
	class Submissions extends CI_Controller
	{
		+    private $problems;
		
		-	private $problems;
		+    private $filter_user;
		+    private $filter_problem;
		+    private $page_number;
		
		-	private $filter_user;
		-	private $filter_problem;
		-	private $page_number;
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function __construct()
		+    {
			+        parent::__construct();
			+        if (! $this->session->userdata('logged_in')) { // if not logged in
				+            redirect('login');
				+        }
			+        $this->load->model('submit_model');
			+        $this->problems = $this->assignment_model->all_problems($this->user->selected_assignment['id']);
			
			-	public function __construct()
			-	{
				-		parent::__construct();
				-		if ( ! $this->session->userdata('logged_in')) // if not logged in
				-			redirect('login');
				-		$this->load->model('submit_model');
				-		$this->problems = $this->assignment_model->all_problems($this->user->selected_assignment['id']);
				+        $input = $this->uri->uri_to_assoc();
				+        $this->filter_user = $this->filter_problem = null;
				+        $this->page_number = 1;
				+        if (array_key_exists('user', $input) && $input['user']) {
					+            if ($this->user->level > 0) { // students are not able to filter submissions by user
						+                $this->filter_user = $this->form_validation->alpha_numeric($input['user']) ? $input['user'] : null;
						+            }
					+        }
				+        if (array_key_exists('problem', $input) && $input['problem']) {
					+            $this->filter_problem = is_numeric($input['problem']) ? $input['problem'] : null;
					+        }
				+        if (array_key_exists('page', $input) && $input['page']) {
					+            $this->page_number = is_numeric($input['page']) ? $input['page'] : 1;
					+        }
				
				-		$input = $this->uri->uri_to_assoc();
				-		$this->filter_user = $this->filter_problem = NULL;
				-		$this->page_number = 1;
				-		if (array_key_exists('user', $input) && $input['user'])
				-			if ($this->user->level > 0) // students are not able to filter submissions by user
				-				$this->filter_user = $this->form_validation->alpha_numeric($input['user'])?$input['user']:NULL;
				-		if (array_key_exists('problem', $input) && $input['problem'])
				-			$this->filter_problem = is_numeric($input['problem'])?$input['problem']:NULL;
				-		if (array_key_exists('page', $input) && $input['page'])
				-			$this->page_number = is_numeric($input['page'])?$input['page']:1;
				+    }
			
			-	}
		
		
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Uses PHPExcel library to generate excel file of submissions
		+     */
		+    private function _download_excel($view)
		+    {
			+        if (! in_array($view, array('all', 'final'))) {
				+            exit;
				+        }
			
			-	/**
			-	 * Uses PHPExcel library to generate excel file of submissions
			-	 */
			-	private function _download_excel($view)
			-	{
				-		if ( ! in_array($view, array('all', 'final')))
				-			exit;
				+        $now = shj_now_str(); // current time
				
				-		$now = shj_now_str(); // current time
				+        // Load PHPExcel library
				+        $phpspreedsheet = new Spreadsheet();
				
				-		// Load PHPExcel library
				-		$phpspreedsheet = new Spreadsheet();
				+        // Set document properties
				+        $phpspreedsheet->getProperties()->setCreator('SharIF Judge')
				+            ->setLastModifiedBy('SharIF Judge')
				+            ->setTitle('SharIF Judge Users')
				+            ->setSubject('SharIF Judge Users')
				+            ->setDescription('List of SharIF Judge users ('.$now.')');
				
				-		// Set document properties
				-		$phpspreedsheet->getProperties()->setCreator('SharIF Judge')
				-			->setLastModifiedBy('SharIF Judge')
				-			->setTitle('SharIF Judge Users')
				-			->setSubject('SharIF Judge Users')
				-			->setDescription('List of SharIF Judge users ('.$now.')');
				+        // Name of the file sent to browser
				+        $output_filename = 'judge_'.$view.'_submissions';
				
				-		// Name of the file sent to browser
				-		$output_filename = 'judge_'.$view.'_submissions';
				+        // Set active sheet
				+        $phpspreedsheet->setActiveSheetIndex(0);
				+        $sheet = $phpspreedsheet->getActiveSheet();
				
				-		// Set active sheet
				-		$phpspreedsheet->setActiveSheetIndex(0);
				-		$sheet = $phpspreedsheet->getActiveSheet();
				+        // Add current assignment, time, username filter, and problem filter to document
				+        $sheet->fromArray(array('Assignment:',$this->user->selected_assignment['name']), null, 'A1', true);
				+        $sheet->fromArray(array('Time:',$now), null, 'A2', true);
				+        $sheet->fromArray(array('Username Filter:', $this->filter_user ? $this->filter_user : 'No filter'), null, 'A3', true);
				+        $sheet->fromArray(array('Problem Filter:', $this->filter_problem ? $this->filter_problem : 'No filter'), null, 'A4', true);
				
				-		// Add current assignment, time, username filter, and problem filter to document
				-		$sheet->fromArray(array('Assignment:',$this->user->selected_assignment['name']), null, 'A1', true);
				-		$sheet->fromArray(array('Time:',$now), null, 'A2', true);
				-		$sheet->fromArray(array('Username Filter:', $this->filter_user?$this->filter_user:'No filter'), null, 'A3', true);
				-		$sheet->fromArray(array('Problem Filter:', $this->filter_problem?$this->filter_problem:'No filter'), null, 'A4', true);
				+        // Prepare header
				+        if ($this->user->level === 0) {
					+            $header = array('Final','Problem','Submit Time','Score','Delay (HH:MM)','Coefficient','Final Score','Language','Status');
					+        } else {
					+            $header = array('Final','Submit ID','Username','Name','Problem','Submit Time','Score','Delay (HH:MM)','Coefficient','Final Score','Language','Status');
					+            if ($view === 'final') {
						+                array_unshift($header, "#2");
						+                array_unshift($header, "#1");
						+            }
					+        }
				
				-		// Prepare header
				-		if ($this->user->level === 0)
				-			$header=array('Final','Problem','Submit Time','Score','Delay (HH:MM)','Coefficient','Final Score','Language','Status');
				-		else{
					-			$header=array('Final','Submit ID','Username','Name','Problem','Submit Time','Score','Delay (HH:MM)','Coefficient','Final Score','Language','Status');
					-			if ($view === 'final'){
						-				array_unshift($header, "#2");
						-				array_unshift($header, "#1");
						-			}
					-		}
				+        // Add header to document
				+        $sheet->fromArray($header, null, 'A6', true);
				+        $highest_column = $sheet->getHighestColumn();
				
				-		// Add header to document
				-		$sheet->fromArray($header, null, 'A6', true);
				-		$highest_column = $sheet->getHighestColumn();
				+        // Set custom style for header
				+        $sheet->getStyle('A6:'.$highest_column.'6')->applyFromArray(
				+            array(
				+                'fill' => array(
				+                    'fillType' => Fill::FILL_SOLID,
				+                    'color' => array('rgb' => '173C45')
				+                ),
				+                'font'  => array(
				+                    'bold'  => true,
				+                    'color' => array('rgb' => 'FFFFFF'),
				+                    //'size'  => 14
				+                )
				+            )
				+        );
				
				-		// Set custom style for header
				-		$sheet->getStyle('A6:'.$highest_column.'6')->applyFromArray(
				-			array(
				-				'fill' => array(
				-					'fillType' => Fill::FILL_SOLID,
				-					'color' => array('rgb' => '173C45')
				-				),
				-				'font'  => array(
				-					'bold'  => true,
				-					'color' => array('rgb' => 'FFFFFF'),
				-					//'size'  => 14
				-				)
				-			)
				-		);
				+        // Prepare data (in $rows array)
				+        if ($view === 'final') {
					+            $items = $this->submit_model->get_final_submissions($this->user->selected_assignment['id'], $this->user->level, $this->user->username, null, $this->filter_user, $this->filter_problem);
					+        } else {
					+            $items = $this->submit_model->get_all_submissions($this->user->selected_assignment['id'], $this->user->level, $this->user->username, null, $this->filter_user, $this->filter_problem);
					+        }
				
				-		// Prepare data (in $rows array)
				-		if ($view === 'final')
				-			$items = $this->submit_model->get_final_submissions($this->user->selected_assignment['id'], $this->user->level, $this->user->username, NULL, $this->filter_user, $this->filter_problem);
				-		else
				-			$items = $this->submit_model->get_all_submissions($this->user->selected_assignment['id'], $this->user->level, $this->user->username, NULL, $this->filter_user, $this->filter_problem);
				+        $names = $this->user_model->get_names();
				
				-		$names = $this->user_model->get_names();
				+        $finish = strtotime($this->user->selected_assignment['finish_time']);
				+        $i = 0;
				+        $j = 0;
				+        $un = '';
				+        $rows = array();
				+        foreach ($items as $item) {
					+            $i++;
					+            if ($item['username'] != $un) {
						+                $j++;
						+            }
					+            $un = $item['username'];
					
					-		$finish = strtotime($this->user->selected_assignment['finish_time']);
					-		$i=0; $j=0; $un='';
					-		$rows = array();
					-		foreach ($items as $item){
						-			$i++;
						-			if ($item['username'] != $un)
						-				$j++;
						-			$un = $item['username'];
						+            $pi = $this->problems[$item['problem']];
						
						-			$pi = $this->problems[$item['problem']];
						+            $pre_score = ceil($item['pre_score'] * $pi['score'] / 10000);
						
						-			$pre_score = ceil($item['pre_score']*$pi['score']/10000);
						+            $checked = '';
						+            if ($item['is_final']) {
							+                $checked = '*';
							+            }
						
						-			$checked='';
						-			if ($item['is_final'])
						-				$checked='*';
						+            $delay = strtotime($item['time']) - $finish;
						+            if ($item['coefficient'] === 'error') {
							+                $final_score = 0;
							+            } else {
							+                $final_score = ceil($pre_score * $item['coefficient'] / 100);
							+            }
						
						-			$delay = strtotime($item['time'])-$finish;
						-			if ($item['coefficient'] === 'error')
						-				$final_score = 0;
						-			else
						-				$final_score = ceil($pre_score*$item['coefficient']/100);
						
						+            if ($this->user->level === 0) {
							+                $row = array(
							+                    $checked,
							+                    $item['problem'].' ('.$pi['name'].')',
							+                    $item['time'],
							+                    $pre_score,
							+                    ($delay <= 0 ? 'No Delay' : time_hhmm($delay)),
							+                    $item['coefficient'],
							+                    $final_score,
							+                    filetype_to_language($item['file_type']),
							+                    $item['status'],
							+                );
							+            } else {
							+                $row = array(
							+                    $checked,
							+                    $item['submit_id'],
							+                    $item['username'],
							+                    $names[$item['username']],
							+                    $item['problem'].' ('.$pi['name'].')',
							+                    $item['time'],
							+                    $pre_score,
							+                    ($delay <= 0 ? 'No Delay' : time_hhmm($delay)),
							+                    $item['coefficient'],
							+                    $final_score,
							+                    filetype_to_language($item['file_type']),
							+                    $item['status'],
							+                );
							+                if ($view === 'final') {
								+                    array_unshift($row, $j);
								+                    array_unshift($row, $i);
								+                }
							+            }
						+            array_push($rows, $row);
						+        }
					
					-			if ($this->user->level === 0)
					-				$row = array(
					-					$checked,
					-					$item['problem'].' ('.$pi['name'].')',
					-					$item['time'],
					-					$pre_score,
					-					($delay<=0?'No Delay':time_hhmm($delay)),
					-					$item['coefficient'],
					-					$final_score,
					-					filetype_to_language($item['file_type']),
					-					$item['status'],
					-				);
					-			else {
						-				$row = array(
						-					$checked,
						-					$item['submit_id'],
						-					$item['username'],
						-					$names[$item['username']],
						-					$item['problem'].' ('.$pi['name'].')',
						-					$item['time'],
						-					$pre_score,
						-					($delay<=0?'No Delay':time_hhmm($delay)),
						-					$item['coefficient'],
						-					$final_score,
						-					filetype_to_language($item['file_type']),
						-					$item['status'],
						-				);
						-				if ($view === 'final'){
							-					array_unshift($row,$j);
							-					array_unshift($row,$i);
							-				}
						-			}
					-			array_push($rows, $row);
					-		}
				+        // Add rows to document
				+        $sheet->fromArray($rows, null, 'A7', true);
				+        // Add alternative colors to rows
				+        for ($i = 7; $i < count($rows) + 7; $i++) {
					+            $sheet->getStyle('A'.$i.':'.$highest_column.$i)->applyFromArray(
					+                array(
					+                    'fill' => array(
					+                        'fillType' => Fill::FILL_SOLID,
					+                        'color' => array('rgb' => (($i % 2) ? 'F0F0F0' : 'FAFAFA'))
					+                    )
					+                )
					+            );
					+        }
				
				-		// Add rows to document
				-		$sheet->fromArray($rows, null, 'A7', true);
				-		// Add alternative colors to rows
				-		for ($i=7; $i<count($rows)+7; $i++){
					-			$sheet->getStyle('A'.$i.':'.$highest_column.$i)->applyFromArray(
					-				array(
					-					'fill' => array(
					-						'fillType' => Fill::FILL_SOLID,
					-						'color' => array('rgb' => (($i%2)?'F0F0F0':'FAFAFA'))
					-					)
					-				)
					-			);
					-		}
				+        // Set text align to center
				+        $sheet->getStyle($sheet->calculateWorksheetDimension())
				+            ->getAlignment()
				+            ->setHorizontal(Alignment::HORIZONTAL_CENTER);
				
				-		// Set text align to center
				-		$sheet->getStyle( $sheet->calculateWorksheetDimension() )
				-			->getAlignment()
				-			->setHorizontal(Alignment::HORIZONTAL_CENTER);
				+        // Making columns autosize
				+        for ($i = 2;$i < count($header);$i++) {
					+            $sheet->getColumnDimension(chr(65 + $i))->setAutoSize(true);
					+        }
				
				-		// Making columns autosize
				-		for ($i=2;$i<count($header);$i++)
				-			$sheet->getColumnDimension(chr(65+$i))->setAutoSize(true);
				+        // Set Border
				+        $sheet->getStyle('A7:'.$highest_column.$sheet->getHighestRow())->applyFromArray(
				+            array(
				+                'borders' => array(
				+                    'outline' => array(
				+                        'borderStyle' => Border::BORDER_THIN,
				+                        'color' => array('rgb' => '444444'),
				+                    ),
				+                )
				+            )
				+        );
				
				-		// Set Border
				-		$sheet->getStyle('A7:'.$highest_column.$sheet->getHighestRow())->applyFromArray(
				-			array(
				-				'borders' => array(
				-					'outline' => array(
				-						'borderStyle' => Border::BORDER_THIN,
				-						'color' => array('rgb' => '444444'),
				-					),
				-				)
				-			)
				-		);
				+        // Send the file to browser
				
				-		// Send the file to browser
				+        $ext = 'xlsx';
				+        if (! class_exists('ZipArchive')) { // If class ZipArchive does not exist, export to excel5 instead of excel 2007
					+            $ext = 'xls';
					+        }
				
				-		$ext = 'xlsx';
				-		if ( ! class_exists('ZipArchive') ) // If class ZipArchive does not exist, export to excel5 instead of excel 2007
				-			$ext = 'xls';
				+        header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
				+        header('Content-Disposition: attachment;filename="'.$output_filename.'.'.$ext.'"');
				+        header('Cache-Control: max-age=0');
				+        $objWriter = IOFactory::createWriter($phpspreedsheet, ucfirst($ext));
				+        $objWriter->save('php://output');
				+    }
			
			-		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			-		header('Content-Disposition: attachment;filename="'.$output_filename.'.'.$ext.'"');
			-		header('Cache-Control: max-age=0');
			-		$objWriter = IOFactory::createWriter($phpspreedsheet, ucfirst($ext));
			-		$objWriter->save('php://output');
			-	}
		
		
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		
		
		+    public function final_excel()
		+    {
			+        $this->_download_excel('final');
			+    }
		
		-	public function final_excel()
		-	{
			-		$this->_download_excel('final');
			-	}
		
		
		+    public function all_excel()
		+    {
			+        $this->_download_excel('all');
			+    }
		
		-	public function all_excel()
		-	{
			-		$this->_download_excel('all');
			-	}
		
		
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		
		
		+    public function the_final()
		+    {
			
			-	public function the_final()
			-	{
				+        if (! is_numeric($this->page_number)) {
					+            show_404();
					+        }
				
				-		if ( ! is_numeric($this->page_number))
				-			show_404();
				+        if ($this->page_number < 1) {
					+            show_404();
					+        }
				
				-		if ($this->page_number<1)
				-			show_404();
				+        $config = array(
				+            'base_url' => site_url('submissions/final'.($this->filter_user ? '/user/'.$this->filter_user : '').($this->filter_problem ? '/problem/'.$this->filter_problem : '')),
				+            'cur_page' => $this->page_number,
				+            'total_rows' => $this->submit_model->count_final_submissions($this->user->selected_assignment['id'], $this->user->level, $this->user->username, $this->filter_user, $this->filter_problem),
				+            'per_page' => $this->settings_model->get_setting('results_per_page_final'),
				+            'num_links' => 5,
				+            'full_ul_class' => 'shj_pagination',
				+            'cur_li_class' => 'current_page'
				+        );
				+        if ($config['per_page'] == 0) {
					+            $config['per_page'] = $config['total_rows'];
					+        }
				+        $this->load->library('shj_pagination', $config);
				
				-		$config = array(
				-			'base_url' => site_url('submissions/final'.($this->filter_user?'/user/'.$this->filter_user:'').($this->filter_problem?'/problem/'.$this->filter_problem:'')),
				-			'cur_page' => $this->page_number,
				-			'total_rows' => $this->submit_model->count_final_submissions($this->user->selected_assignment['id'], $this->user->level, $this->user->username, $this->filter_user, $this->filter_problem),
				-			'per_page' => $this->settings_model->get_setting('results_per_page_final'),
				-			'num_links' => 5,
				-			'full_ul_class' => 'shj_pagination',
				-			'cur_li_class' => 'current_page'
				-		);
				-		if ($config['per_page'] == 0)
				-			$config['per_page'] = $config['total_rows'];
				-		$this->load->library('shj_pagination', $config);
				+        $submissions = $this->submit_model->get_final_submissions($this->user->selected_assignment['id'], $this->user->level, $this->user->username, $this->page_number, $this->filter_user, $this->filter_problem);
				
				-		$submissions = $this->submit_model->get_final_submissions($this->user->selected_assignment['id'], $this->user->level, $this->user->username, $this->page_number, $this->filter_user, $this->filter_problem);
				+        $names = $this->user_model->get_names();
				
				-		$names = $this->user_model->get_names();
				+        foreach ($submissions as &$item) {
					+            $item['name'] = $names[$item['username']];
					+            $item['fullmark'] = ($item['pre_score'] == 10000);
					+            $item['pre_score'] = ceil($item['pre_score'] * $this->problems[$item['problem']]['score'] / 10000);
					+            $item['delay'] = strtotime($item['time']) - strtotime($this->user->selected_assignment['finish_time']);
					+            $item['language'] = filetype_to_language($item['file_type']);
					+            if ($item['coefficient'] === 'error') {
						+                $item['final_score'] = 0;
						+            } else {
						+                $item['final_score'] = ceil($item['pre_score'] * $item['coefficient'] / 100);
						+            }
					+        }
				
				-		foreach ($submissions as &$item)
				-		{
					-			$item['name'] = $names[$item['username']];
					-			$item['fullmark'] = ($item['pre_score'] == 10000);
					-			$item['pre_score'] = ceil($item['pre_score']*$this->problems[$item['problem']]['score']/10000);
					-			$item['delay'] = strtotime($item['time'])-strtotime($this->user->selected_assignment['finish_time']);
					-			$item['language'] = filetype_to_language($item['file_type']);
					-			if ($item['coefficient'] === 'error')
					-				$item['final_score'] = 0;
					-			else
					-				$item['final_score'] = ceil($item['pre_score']*$item['coefficient']/100);
					-		}
				
				+        $data = array(
				+            'view' => 'final',
				+            'all_assignments' => $this->assignment_model->all_assignments(),
				+            'problems' => $this->problems,
				+            'submissions' => $submissions,
				+            'excel_link' => site_url('submissions/final_excel'.($this->filter_user ? '/user/'.$this->filter_user : '').($this->filter_problem ? '/problem/'.$this->filter_problem : '')),
				+            'filter_user' => $this->filter_user,
				+            'filter_problem' => $this->filter_problem,
				+            'pagination' => $this->shj_pagination->create_links(),
				+            'page_number' => $this->page_number,
				+            'per_page' => $config['per_page'],
				+        );
				
				-		$data = array(
				-			'view' => 'final',
				-			'all_assignments' => $this->assignment_model->all_assignments(),
				-			'problems' => $this->problems,
				-			'submissions' => $submissions,
				-			'excel_link' => site_url('submissions/final_excel'.($this->filter_user?'/user/'.$this->filter_user:'').($this->filter_problem?'/problem/'.$this->filter_problem:'')),
				-			'filter_user' => $this->filter_user,
				-			'filter_problem' => $this->filter_problem,
				-			'pagination' => $this->shj_pagination->create_links(),
				-			'page_number' => $this->page_number,
				-			'per_page' => $config['per_page'],
				-		);
				+        $this->twig->display('pages/submissions.twig', $data);
				+    }
			
			-		$this->twig->display('pages/submissions.twig', $data);
			-	}
		
		
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		
		
		+    public function all()
		+    {
			
			-	public function all()
			-	{
				+        if (! is_numeric($this->page_number)) {
					+            show_404();
					+        }
				
				-		if ( ! is_numeric($this->page_number))
				-			show_404();
				+        if ($this->page_number < 1) {
					+            show_404();
					+        }
				
				-		if ($this->page_number < 1)
				-			show_404();
				+        $config = array(
				+            'base_url' => site_url('submissions/all'.($this->filter_user ? '/user/'.$this->filter_user : '').($this->filter_problem ? '/problem/'.$this->filter_problem : '')),
				+            'cur_page' => $this->page_number,
				+            'total_rows' => $this->submit_model->count_all_submissions($this->user->selected_assignment['id'], $this->user->level, $this->user->username, $this->filter_user, $this->filter_problem),
				+            'per_page' => $this->settings_model->get_setting('results_per_page_all'),
				+            'num_links' => 5,
				+            'full_ul_class' => 'shj_pagination',
				+            'cur_li_class' => 'current_page'
				+        );
				+        if ($config['per_page'] == 0) {
					+            $config['per_page'] = $config['total_rows'];
					+        }
				+        $this->load->library('shj_pagination', $config);
				
				-		$config = array(
				-			'base_url' => site_url('submissions/all'.($this->filter_user?'/user/'.$this->filter_user:'').($this->filter_problem?'/problem/'.$this->filter_problem:'')),
				-			'cur_page' => $this->page_number,
				-			'total_rows' => $this->submit_model->count_all_submissions($this->user->selected_assignment['id'], $this->user->level, $this->user->username, $this->filter_user, $this->filter_problem),
				-			'per_page' => $this->settings_model->get_setting('results_per_page_all'),
				-			'num_links' => 5,
				-			'full_ul_class' => 'shj_pagination',
				-			'cur_li_class' => 'current_page'
				-		);
				-		if ($config['per_page']==0)
				-			$config['per_page'] = $config['total_rows'];
				-		$this->load->library('shj_pagination', $config);
				+        $submissions = $this->submit_model->get_all_submissions($this->user->selected_assignment['id'], $this->user->level, $this->user->username, $this->page_number, $this->filter_user, $this->filter_problem);
				
				-		$submissions = $this->submit_model->get_all_submissions($this->user->selected_assignment['id'], $this->user->level, $this->user->username, $this->page_number, $this->filter_user, $this->filter_problem);
				+        $names = $this->user_model->get_names();
				
				-		$names = $this->user_model->get_names();
				+        foreach ($submissions as &$item) {
					+            $item['name'] = $names[$item['username']];
					+            $item['fullmark'] = ($item['pre_score'] == 10000);
					+            $item['pre_score'] = ceil($item['pre_score'] * $this->problems[$item['problem']]['score'] / 10000);
					+            $item['delay'] = strtotime($item['time']) - strtotime($this->user->selected_assignment['finish_time']);
					+            $item['language'] = filetype_to_language($item['file_type']);
					+            if ($item['coefficient'] === 'error') {
						+                $item['final_score'] = 0;
						+            } else {
						+                $item['final_score'] = ceil($item['pre_score'] * $item['coefficient'] / 100);
						+            }
					+        }
				
				-		foreach ($submissions as &$item)
				-		{
					-			$item['name'] = $names[$item['username']];
					-			$item['fullmark'] = ($item['pre_score'] == 10000);
					-			$item['pre_score'] = ceil($item['pre_score']*$this->problems[$item['problem']]['score']/10000);
					-			$item['delay'] = strtotime($item['time'])-strtotime($this->user->selected_assignment['finish_time']);
					-			$item['language'] = filetype_to_language($item['file_type']);
					-			if ($item['coefficient'] === 'error')
					-				$item['final_score'] = 0;
					-			else
					-				$item['final_score'] = ceil($item['pre_score']*$item['coefficient']/100);
					-		}
				+        $data = array(
				+            'view' => 'all',
				+            'all_assignments' => $this->assignment_model->all_assignments(),
				+            'problems' => $this->problems,
				+            'submissions' => $submissions,
				+            'excel_link' => site_url('submissions/all_excel'.($this->filter_user ? '/user/'.$this->filter_user : '').($this->filter_problem ? '/problem/'.$this->filter_problem : '')),
				+            'filter_user' => $this->filter_user,
				+            'filter_problem' => $this->filter_problem,
				+            'pagination' => $this->shj_pagination->create_links(),
				+        );
				
				-		$data = array(
				-			'view' => 'all',
				-			'all_assignments' => $this->assignment_model->all_assignments(),
				-			'problems' => $this->problems,
				-			'submissions' => $submissions,
				-			'excel_link' => site_url('submissions/all_excel'.($this->filter_user?'/user/'.$this->filter_user:'').($this->filter_problem?'/problem/'.$this->filter_problem:'')),
				-			'filter_user' => $this->filter_user,
				-			'filter_problem' => $this->filter_problem,
				-			'pagination' => $this->shj_pagination->create_links(),
				-		);
				+        $this->twig->display('pages/submissions.twig', $data);
				+    }
			
			-		$this->twig->display('pages/submissions.twig', $data);
			-	}
		
		
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		
		
		+    /**
		+     * Used by ajax request (for selecting final submission)
		+     */
		+    public function select()
		+    {
			+        if (! $this->input->is_ajax_request()) {
				+            show_404();
				+        }
			
			-	/**
			-	 * Used by ajax request (for selecting final submission)
			-	 */
			-	public function select()
			-	{
				-		if ( ! $this->input->is_ajax_request() )
				-			show_404();
				+        // Students cannot change their final submission after finish_time + extra_time
				+        if ($this->user->level === 0) {
					+            if (shj_now() > strtotime($this->user->selected_assignment['finish_time']) + $this->user->selected_assignment['extra_time']) {
						+                $json_result = array(
						+                    'done' => 0,
						+                    'message' => 'This assignment is finished. You cannot change your final submissions.'
						+                );
						+                $this->output->set_header('Content-Type: application/json; charset=utf-8');
						+                echo json_encode($json_result);
						+                return;
						+            }
					+        }
				
				-		// Students cannot change their final submission after finish_time + extra_time
				-		if ($this->user->level === 0)
				-			if ( shj_now() > strtotime($this->user->selected_assignment['finish_time'])+$this->user->selected_assignment['extra_time'])
				-			{
					-				$json_result = array(
					-					'done' => 0,
					-					'message' => 'This assignment is finished. You cannot change your final submissions.'
					-				);
					-				$this->output->set_header('Content-Type: application/json; charset=utf-8');
					-				echo json_encode($json_result);
					-				return;
					-			}
				+        $this->form_validation->set_rules('submit_id', 'Submit ID', 'integer|greater_than[0]');
				+        $this->form_validation->set_rules('problem', 'problem', 'integer|greater_than[0]');
				+        $this->form_validation->set_rules('username', 'Username', 'required|min_length[3]|max_length[20]|alpha_numeric');
				
				-		$this->form_validation->set_rules('submit_id', 'Submit ID', 'integer|greater_than[0]');
				-		$this->form_validation->set_rules('problem', 'problem', 'integer|greater_than[0]');
				-		$this->form_validation->set_rules('username', 'Username', 'required|min_length[3]|max_length[20]|alpha_numeric');
				+        if ($this->form_validation->run()) {
					+            $username = $this->input->post('username');
					+            if ($this->user->level === 0) {
						+                $username = $this->user->username;
						+            }
					
					-		if ($this->form_validation->run())
					-		{
						-			$username = $this->input->post('username');
						-			if ($this->user->level === 0)
						-				$username = $this->user->username;
						+            $res = $this->submit_model->set_final_submission(
						+                $username,
						+                $this->user->selected_assignment['id'],
						+                $this->input->post('problem'),
						+                $this->input->post('submit_id')
						+            );
						
						-			$res = $this->submit_model->set_final_submission(
						-				$username,
						-				$this->user->selected_assignment['id'],
						-				$this->input->post('problem'),
						-				$this->input->post('submit_id')
						-			);
						+            if ($res) {
							+                // each time a user changes final submission, we should update scoreboard of that assignment
							+                $this->load->model('scoreboard_model');
							+                $this->scoreboard_model->update_scoreboard($this->user->selected_assignment['id']);
							+                $json_result = array('done' => 1);
							+            } else {
							+                $json_result = array('done' => 0, 'message' => 'Selecting Final Submission Failed');
							+            }
						+        } else {
						+            $json_result = array('done' => 0, 'message' => 'Input Error');
						+        }
					
					-			if ($res) {
						-				// each time a user changes final submission, we should update scoreboard of that assignment
						-				$this->load->model('scoreboard_model');
						-				$this->scoreboard_model->update_scoreboard($this->user->selected_assignment['id']);
						-				$json_result = array('done' => 1);
						-			}
					-			else
					-				$json_result = array('done' => 0, 'message' => 'Selecting Final Submission Failed');
					-		}
				-		else
				-			$json_result = array('done' => 0, 'message' => 'Input Error');
				+        $this->output->set_header('Content-Type: application/json; charset=utf-8');
				+        echo json_encode($json_result);
				+    }
			
			-		$this->output->set_header('Content-Type: application/json; charset=utf-8');
			-		echo json_encode($json_result);
			-	}
		
		
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function _check_type($type)
		+    {
			+        return ($type === 'code' || $type === 'result' || $type === 'log');
			+    }
		
		-	public function _check_type($type)
		-	{
			-		return ($type === 'code' || $type === 'result' || $type === 'log');
			-	}
		
		+    /**
		+     * For "view code" or "view result" or "view log"
		+     */
		+    public function view_code()
		+    {
			+        if (! $this->input->is_ajax_request()) {
				+            show_404();
				+        }
			+        $this->form_validation->set_rules('type', 'type', 'callback__check_type');
			+        $this->form_validation->set_rules('username', 'username', 'required|min_length[3]|max_length[20]|alpha_numeric');
			+        $this->form_validation->set_rules('assignment', 'assignment', 'integer|greater_than[0]');
			+        $this->form_validation->set_rules('problem', 'problem', 'integer|greater_than[0]');
			+        $this->form_validation->set_rules('submit_id', 'submit_id', 'integer|greater_than[0]');
			
			-	/**
			-	 * For "view code" or "view result" or "view log"
			-	 */
			-	public function view_code()
			-	{
				-		if ( ! $this->input->is_ajax_request() )
				-			show_404();
				-		$this->form_validation->set_rules('type','type','callback__check_type');
				-		$this->form_validation->set_rules('username','username','required|min_length[3]|max_length[20]|alpha_numeric');
				-		$this->form_validation->set_rules('assignment','assignment','integer|greater_than[0]');
				-		$this->form_validation->set_rules('problem','problem','integer|greater_than[0]');
				-		$this->form_validation->set_rules('submit_id','submit_id','integer|greater_than[0]');
				+        if($this->form_validation->run()) {
					+            $submission = $this->submit_model->get_submission(
					+                $this->input->post('username'),
					+                $this->input->post('assignment'),
					+                $this->input->post('problem'),
					+                $this->input->post('submit_id')
					+            );
					+            if ($submission === false) {
						+                show_404();
						+            }
					
					-		if($this->form_validation->run())
					-		{
						-			$submission = $this->submit_model->get_submission(
						-				$this->input->post('username'),
						-				$this->input->post('assignment'),
						-				$this->input->post('problem'),
						-				$this->input->post('submit_id')
						-			);
						-			if ($submission === FALSE)
						-				show_404();
						+            $type = $this->input->post('type'); // $type is 'code', 'result', or 'log'
						
						-			$type = $this->input->post('type'); // $type is 'code', 'result', or 'log'
						+            if ($this->user->level === 0 && $type === 'log') {
							+                show_404();
							+            }
						
						-			if ($this->user->level === 0 && $type === 'log')
						-				show_404();
						+            if ($this->user->level === 0 && $this->user->username != $submission['username']) {
							+                exit('Don\'t try to see submitted codes :)');
							+            }
						
						-			if ($this->user->level === 0 && $this->user->username != $submission['username'])
						-				exit('Don\'t try to see submitted codes :)');
						+            if ($type === 'result') {
							+                $file_path = rtrim($this->settings_model->get_setting('assignments_root'), '/').
							+                    "/assignment_{$submission['assignment']}/p{$submission['problem']}/{$submission['username']}/result-{$submission['submit_id']}.html";
							+            } elseif ($type === 'code') {
							+                $file_path = rtrim($this->settings_model->get_setting('assignments_root'), '/').
							+                    "/assignment_{$submission['assignment']}/p{$submission['problem']}/{$submission['username']}/{$submission['file_name']}.".filetype_to_extension($submission['file_type']);
							+            } elseif ($type === 'log') {
							+                $file_path = rtrim($this->settings_model->get_setting('assignments_root'), '/').
							+                    "/assignment_{$submission['assignment']}/p{$submission['problem']}/{$submission['username']}/log-{$submission['submit_id']}";
							+            } else {
							+                $file_path = '/nowhere';
							+            } // This line is never reached!
						
						-			if ($type === 'result')
						-				$file_path = rtrim($this->settings_model->get_setting('assignments_root'),'/').
						-					"/assignment_{$submission['assignment']}/p{$submission['problem']}/{$submission['username']}/result-{$submission['submit_id']}.html";
						-			elseif ($type === 'code')
						-				$file_path = rtrim($this->settings_model->get_setting('assignments_root'),'/').
						-					"/assignment_{$submission['assignment']}/p{$submission['problem']}/{$submission['username']}/{$submission['file_name']}.".filetype_to_extension($submission['file_type']);
						-			elseif ($type === 'log')
						-				$file_path = rtrim($this->settings_model->get_setting('assignments_root'),'/').
						-					"/assignment_{$submission['assignment']}/p{$submission['problem']}/{$submission['username']}/log-{$submission['submit_id']}";
						-			else
						-				$file_path = '/nowhere'; // This line is never reached!
						+            $result = array(
						+                'file_name' => $submission['main_file_name'].'.'.filetype_to_extension($submission['file_type']),
						+                'text' => file_exists($file_path) ? file_get_contents($file_path) : 'File Not Found'
						+            );
						
						-			$result = array(
						-				'file_name' => $submission['main_file_name'].'.'.filetype_to_extension($submission['file_type']),
						-				'text' => file_exists($file_path)?file_get_contents($file_path):'File Not Found'
						-			);
						+            if ($type === 'code') {
							+                $result['lang'] = $submission['file_type'];
							+                if ($result['lang'] == 'py2' || $result['lang'] == 'py3') {
								+                    $result['lang'] = 'python';
								+                }
							+            }
						
						-			if ($type === 'code') {
							-				$result['lang'] = $submission['file_type'];
							-				if ($result['lang'] == 'py2' || $result['lang'] == 'py3')
							-					$result['lang'] = 'python';
							-			}
						+            $this->output->set_content_type('application/json')->set_output(json_encode($result));
						
						-			$this->output->set_content_type('application/json')->set_output(json_encode($result));
						+        } else {
						+            exit('Are you trying to see other users\' codes? :)');
						+        }
					+    }
				
				-		}
			-		else
			-			exit('Are you trying to see other users\' codes? :)');
			-	}
		
		
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		
		
		+    public function download_file()
		+    {
			+        $username = $this->uri->segment(3);
			+        $assignment = $this->uri->segment(4);
			+        $problem = $this->uri->segment(5);
			+        $submit_id = $this->uri->segment(6);
			
			-	public function download_file()
			-	{
				-		$username = $this->uri->segment(3);
				-		$assignment = $this->uri->segment(4);
				-		$problem = $this->uri->segment(5);
				-		$submit_id = $this->uri->segment(6);
				+        $submission = $this->submit_model->get_submission(
				+            $username,
				+            $assignment,
				+            $problem,
				+            $submit_id
				+        );
				+        if ($submission === false) {
					+            show_404();
					+        }
				
				-		$submission = $this->submit_model->get_submission(
				-			$username,
				-			$assignment,
				-			$problem,
				-			$submit_id
				-		);
				-		if ($submission === FALSE)
				-			show_404();
				+        if ($this->user->level === 0 && $this->user->username != $submission['username']) {
					+            exit('Don\'t try to see submitted codes :)');
					+        }
				
				-		if ($this->user->level === 0 && $this->user->username != $submission['username'])
				-			exit('Don\'t try to see submitted codes :)');
				+        $file_path = rtrim($this->settings_model->get_setting('assignments_root'), '/').
				+        "/assignment_{$submission['assignment']}/p{$submission['problem']}/{$submission['username']}/{$submission['file_name']}.".filetype_to_extension($submission['file_type']);
				
				-		$file_path = rtrim($this->settings_model->get_setting('assignments_root'),'/').
				-		"/assignment_{$submission['assignment']}/p{$submission['problem']}/{$submission['username']}/{$submission['file_name']}.".filetype_to_extension($submission['file_type']);
				+        $this->load->helper('download');
				+        force_download(
				+            "{$submission['file_name']}.".filetype_to_extension($submission['file_type']),
				+            file_get_contents($file_path)
				+        );
				
				-		$this->load->helper('download');
				-		force_download(
				-			"{$submission['file_name']}.".filetype_to_extension($submission['file_type']),
				-			file_get_contents($file_path)
				-		);
				-
				-	}
			+    }
		
		
	}
	
	----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Submit.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/controllers/Submit.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Submit.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Submit.php
	@@ -4,487 +4,482 @@
	* @file Submit.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Submit extends CI_Controller
	{
		+    private $data; //data sent to view
		+    private $assignment_root;
		+    private $problems;
		+    private $problem;//submitted problem id
		+    private $filetype; //type of submitted file
		+    private $ext; //uploaded file extension
		+    private $file_name; //uploaded file name without extension
		+    private $coefficient;
		
		-	private $data; //data sent to view
		-	private $assignment_root;
		-	private $problems;
		-	private $problem;//submitted problem id
		-	private $filetype; //type of submitted file
		-	private $ext; //uploaded file extension
		-	private $file_name; //uploaded file name without extension
		-	private $coefficient;
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function __construct()
		+    {
			+        parent::__construct();
			+        if (! $this->session->userdata('logged_in')) { // if not logged in
				+            redirect('login');
				+        }
			+        $this->load->library('upload')->model('queue_model');
			+        $this->assignment_root = $this->settings_model->get_setting('assignments_root');
			+        $this->problems = $this->assignment_model->all_problems($this->user->selected_assignment['id']);
			
			-	public function __construct()
			-	{
				-		parent::__construct();
				-		if ( ! $this->session->userdata('logged_in')) // if not logged in
				-			redirect('login');
				-		$this->load->library('upload')->model('queue_model');
				-		$this->assignment_root = $this->settings_model->get_setting('assignments_root');
				-		$this->problems = $this->assignment_model->all_problems($this->user->selected_assignment['id']);
				+        $extra_time = $this->user->selected_assignment['extra_time'];
				+        $delay = shj_now() - strtotime($this->user->selected_assignment['finish_time']);
				+        ;
				+        ob_start();
				+        if (eval($this->user->selected_assignment['late_rule']) === false) {
					+            $coefficient = "error";
					+        }
				+        if (!isset($coefficient)) {
					+            $coefficient = "error";
					+        }
				+        ob_end_clean();
				+        $this->coefficient = $coefficient;
				+    }
			
			-		$extra_time = $this->user->selected_assignment['extra_time'];
			-		$delay = shj_now()-strtotime($this->user->selected_assignment['finish_time']);;
			-		ob_start();
			-		if ( eval($this->user->selected_assignment['late_rule']) === FALSE )
			-			$coefficient = "error";
			-		if (!isset($coefficient))
			-			$coefficient = "error";
			-		ob_end_clean();
			-		$this->coefficient = $coefficient;
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function _language_to_type($language)
		+    {
			+        $language = strtolower($language);
			+        switch ($language) {
				+            case 'c': return 'c';
				+            case 'c++': return 'cpp';
				+            case 'python 2': return 'py2';
				+            case 'python 3': return 'py3';
				+            case 'java': return 'java';
				+            case 'zip': return 'zip';
				+            case 'pdf': return 'pdf';
				+            case 'txt': return 'txt';
				+            default: return false;
				+        }
			+    }
		
		-	public function _language_to_type($language)
		-	{
			-		$language = strtolower ($language);
			-		switch ($language) {
				-			case 'c': return 'c';
				-			case 'c++': return 'cpp';
				-			case 'python 2': return 'py2';
				-			case 'python 3': return 'py3';
				-			case 'java': return 'java';
				-			case 'zip': return 'zip';
				-			case 'pdf': return 'pdf';
				-			case 'txt': return 'txt';
				-			default: return FALSE;
				-		}
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function _language_to_ext($language)
		+    {
			+        $language = strtolower($language);
			+        switch ($language) {
				+            case 'c': return 'c';
				+            case 'c++': return 'cpp';
				+            case 'python 2': return 'py';
				+            case 'python 3': return 'py';
				+            case 'java': return 'java';
				+            case 'zip': return 'zip';
				+            case 'pdf': return 'pdf';
				+            case 'txt': return 'txt';
				+            default: return false;
				+        }
			+    }
		
		-		public function _language_to_ext($language)
		-		{
			-			$language = strtolower ($language);
			-			switch ($language) {
				-				case 'c': return 'c';
				-				case 'c++': return 'cpp';
				-				case 'python 2': return 'py';
				-				case 'python 3': return 'py';
				-				case 'java': return 'java';
				-				case 'zip': return 'zip';
				-				case 'pdf': return 'pdf';
				-				case 'txt': return 'txt';
				-				default: return FALSE;
				-			}
			-		}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function _match($type, $extension)
		+    {
			+        switch ($type) {
				+            case 'c': return ($extension === 'c' ? true : false);
				+            case 'cpp': return ($extension === 'cpp' ? true : false);
				+            case 'py2': return ($extension === 'py' ? true : false);
				+            case 'py3': return ($extension === 'py' ? true : false);
				+            case 'java': return ($extension === 'java' ? true : false);
				+            case 'zip': return ($extension === 'zip' ? true : false);
				+            case 'pdf': return ($extension === 'pdf' ? true : false);
				+            case 'txt': return ($extension === 'txt' ? true : false);
				+        }
			+    }
		
		-	public function _match($type, $extension)
		-	{
			-		switch ($type) {
				-			case 'c': return ($extension==='c'?TRUE:FALSE);
				-			case 'cpp': return ($extension==='cpp'?TRUE:FALSE);
				-			case 'py2': return ($extension==='py'?TRUE:FALSE);
				-			case 'py3': return ($extension==='py'?TRUE:FALSE);
				-			case 'java': return ($extension==='java'?TRUE:FALSE);
				-			case 'zip': return ($extension==='zip'?TRUE:FALSE);
				-			case 'pdf': return ($extension==='pdf'?TRUE:FALSE);
				-			case 'txt': return ($extension==='txt'?TRUE:FALSE);
				-		}
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function _check_language($str)
		+    {
			+        if ($str == '0') {
				+            return false;
				+        }
			+        if (in_array(strtolower($str), array('c', 'c++', 'python 2', 'python 3', 'java', 'zip', 'pdf', 'txt'))) {
				+            return true;
				+        }
			+        return false;
			+    }
		
		-	public function _check_language($str)
		-	{
			-		if ($str=='0')
			-			return FALSE;
			-		if (in_array( strtolower($str),array('c', 'c++', 'python 2', 'python 3', 'java', 'zip', 'pdf', 'txt')))
			-			return TRUE;
			-		return FALSE;
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function index()
		+    {
			+        $this->form_validation->set_rules('problem', 'problem', 'required|integer|greater_than[0]', array('greater_than' => 'Select a %s.'));
			+        $this->form_validation->set_rules('language', 'language', 'required|callback__check_language', array('_check_language' => 'Select a valid %s.'));
			
			-	public function index()
			-	{
				-		$this->form_validation->set_rules('problem', 'problem', 'required|integer|greater_than[0]', array('greater_than' => 'Select a %s.'));
				-		$this->form_validation->set_rules('language', 'language', 'required|callback__check_language', array('_check_language' => 'Select a valid %s.'));
				+        if ($this->form_validation->run()) {
					+            if ($this->_upload()) {
						+                redirect('submissions/all');
						+            } else {
						+                show_error('Error Uploading File: '.$this->upload->display_errors());
						+            }
					+        }
				
				-		if ($this->form_validation->run())
				-		{
					-			if ($this->_upload())
					-				redirect('submissions/all');
					-			else
					-				show_error('Error Uploading File: '.$this->upload->display_errors());
					-		}
				+        $this->data = array(
				+            'all_assignments' => $this->assignment_model->all_assignments(),
				+            'problems' => $this->problems,
				+            'in_queue' => false,
				+            'coefficient' => $this->coefficient,
				+            'upload_state' => '',
				+            'problems_js' => '',
				+            'error' => '',
				+        );
				+        foreach ($this->problems as $problem) {
					+            $languages = explode(',', $problem['allowed_languages']);
					+            $items = '';
					+            foreach ($languages as $language) {
						+                $items = $items."'".trim($language)."',";
						+            }
					+            $items = substr($items, 0, strlen($items) - 1);
					+            $this->data['problems_js'] .= "shj.p[{$problem['id']}]=[{$items}]; ";
					+        }
				+        if ($this->user->selected_assignment['id'] == 0) {
					+            $this->data['error'] = 'Please select an assignment first.';
					+        } elseif ($this->user->level == 0 && ! $this->user->selected_assignment['open']) {
					+            // if assignment is closed, non-student users (admin, instructors) still can submit
					+            $this->data['error'] = 'Selected assignment is closed.';
					+        } elseif (shj_now() < strtotime($this->user->selected_assignment['start_time'])) {
					+            $this->data['error'] = 'Selected assignment has not started.';
					+        } elseif (shj_now() > strtotime($this->user->selected_assignment['finish_time']) + $this->user->selected_assignment['extra_time']) { // deadline = finish_time + extra_time
					+            $this->data['error'] = 'Selected assignment has finished.';
					+        } elseif (! $this->assignment_model->is_participant($this->user->selected_assignment['participants'], $this->user->username)) {
					+            $this->data['error'] = 'You are not registered for submitting.';
					+        } else {
					+            $this->data['error'] = 'none';
					+        }
				
				-		$this->data = array(
				-			'all_assignments' => $this->assignment_model->all_assignments(),
				-			'problems' => $this->problems,
				-			'in_queue' => FALSE,
				-			'coefficient' => $this->coefficient,
				-			'upload_state' => '',
				-			'problems_js' => '',
				-			'error' => '',
				-		);
				-		foreach ($this->problems as $problem)
				-		{
					-			$languages = explode(',', $problem['allowed_languages']);
					-			$items='';
					-			foreach ($languages as $language)
					-			{
						-				$items = $items."'".trim($language)."',";
						-			}
					-			$items = substr($items,0,strlen($items)-1);
					-			$this->data['problems_js'] .= "shj.p[{$problem['id']}]=[{$items}]; ";
					-		}
				-		if ($this->user->selected_assignment['id'] == 0)
				-			$this->data['error']='Please select an assignment first.';
				-		elseif ($this->user->level == 0 && ! $this->user->selected_assignment['open'])
				-			// if assignment is closed, non-student users (admin, instructors) still can submit
				-			$this->data['error'] = 'Selected assignment is closed.';
				-		elseif (shj_now() < strtotime($this->user->selected_assignment['start_time']))
				-			$this->data['error'] = 'Selected assignment has not started.';
				-		elseif (shj_now() > strtotime($this->user->selected_assignment['finish_time'])+$this->user->selected_assignment['extra_time']) // deadline = finish_time + extra_time
				-			$this->data['error'] = 'Selected assignment has finished.';
				-		elseif ( ! $this->assignment_model->is_participant($this->user->selected_assignment['participants'],$this->user->username) )
				-			$this->data['error'] = 'You are not registered for submitting.';
				-		else
				-			$this->data['error'] = 'none';
				+        $this->twig->display('pages/submit.twig', $this->data);
				+    }
			
			-		$this->twig->display('pages/submit.twig', $this->data);
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Saves submitted code and adds it to queue for judging
		+     */
		+    private function _upload()
		+    {
			+        $now = shj_now();
			+        foreach($this->problems as $item) {
				+            if ($item['id'] == $this->input->post('problem')) {
					+                $this->problem = $item;
					+                break;
					+            }
				+        }
			+        $this->filetype = $this->_language_to_type(strtolower(trim($this->input->post('language'))));
			+        $this->ext = substr(strrchr($_FILES['userfile']['name'], '.'), 1); // uploaded file extension
			+        $this->file_name = basename($_FILES['userfile']['name'], ".{$this->ext}"); // uploaded file name without extension
			+        if ($this->queue_model->in_queue($this->user->username, $this->user->selected_assignment['id'], $this->problem['id'])) {
				+            show_error('You have already submitted for this problem. Your last submission is still in queue.');
				+        }
			+        if ($this->user->level == 0 && !$this->user->selected_assignment['open']) {
				+            show_error('Selected assignment has been closed.');
				+        }
			+        if ($now < strtotime($this->user->selected_assignment['start_time'])) {
				+            show_error('Selected assignment has not started.');
				+        }
			+        if ($now > strtotime($this->user->selected_assignment['finish_time']) + $this->user->selected_assignment['extra_time']) {
				+            show_error('Selected assignment has finished.');
				+        }
			+        if (! $this->assignment_model->is_participant($this->user->selected_assignment['participants'], $this->user->username)) {
				+            show_error('You are not registered for submitting.');
				+        }
			+        $filetypes = explode(",", $this->problem['allowed_languages']);
			+        foreach ($filetypes as &$filetype) {
				+            $filetype = $this->_language_to_type(strtolower(trim($filetype)));
				+        }
			+        if ($_FILES['userfile']['error'] == 4) {
				+            show_error('No file chosen.');
				+        }
			+        if (! in_array($this->filetype, $filetypes)) {
				+            show_error('This file type is not allowed for this problem.');
				+        }
			+        if (! $this->_match($this->filetype, $this->ext)) {
				+            show_error('This file type does not match your selected language.');
				+        }
			+        if (! preg_match('/^[a-zA-Z0-9_\-()]+$/', $this->file_name)) {
				+            show_error('Invalid characters in file name.');
				+        }
			
			-	/**
			-	 * Saves submitted code and adds it to queue for judging
			-	 */
			-	private function _upload()
			-	{
				-		$now = shj_now();
				-		foreach($this->problems as $item)
				-			if ($item['id'] == $this->input->post('problem'))
				-			{
					-				$this->problem = $item;
					-				break;
					-			}
				-		$this->filetype = $this->_language_to_type(strtolower(trim($this->input->post('language'))));
				-		$this->ext = substr(strrchr($_FILES['userfile']['name'],'.'),1); // uploaded file extension
				-		$this->file_name = basename($_FILES['userfile']['name'], ".{$this->ext}"); // uploaded file name without extension
				-		if ( $this->queue_model->in_queue($this->user->username,$this->user->selected_assignment['id'], $this->problem['id']) )
				-			show_error('You have already submitted for this problem. Your last submission is still in queue.');
				-		if ($this->user->level==0 && !$this->user->selected_assignment['open'])
				-			show_error('Selected assignment has been closed.');
				-		if ($now < strtotime($this->user->selected_assignment['start_time']))
				-			show_error('Selected assignment has not started.');
				-		if ($now > strtotime($this->user->selected_assignment['finish_time'])+$this->user->selected_assignment['extra_time'])
				-			show_error('Selected assignment has finished.');
				-		if ( ! $this->assignment_model->is_participant($this->user->selected_assignment['participants'],$this->user->username) )
				-			show_error('You are not registered for submitting.');
				-		$filetypes = explode(",",$this->problem['allowed_languages']);
				-		foreach ($filetypes as &$filetype)
				-		{
					-			$filetype = $this->_language_to_type(strtolower(trim($filetype)));
					-		}
				-		if ($_FILES['userfile']['error'] == 4)
				-			show_error('No file chosen.');
				-		if ( ! in_array($this->filetype, $filetypes))
				-			show_error('This file type is not allowed for this problem.');
				-		if ( ! $this->_match($this->filetype, $this->ext) )
				-			show_error('This file type does not match your selected language.');
				-		if ( ! preg_match('/^[a-zA-Z0-9_\-()]+$/', $this->file_name) )
				-			show_error('Invalid characters in file name.');
				+        $user_dir = rtrim($this->assignment_root, '/').'/assignment_'.$this->user->selected_assignment['id'].'/p'.$this->problem['id'].'/'.$this->user->username;
				+        if (! file_exists($user_dir)) {
					+            mkdir($user_dir, 0700);
					+        }
				
				-		$user_dir = rtrim($this->assignment_root, '/').'/assignment_'.$this->user->selected_assignment['id'].'/p'.$this->problem['id'].'/'.$this->user->username;
				-		if ( ! file_exists($user_dir))
				-			mkdir($user_dir, 0700);
				+        $config['upload_path'] = $user_dir;
				+        $config['allowed_types'] = '*';
				+        $config['max_size']	= $this->settings_model->get_setting('file_size_limit');
				+        $config['file_name'] = $this->file_name."-".($this->user->selected_assignment['total_submits'] + 1).".".$this->ext;
				+        $config['max_file_name'] = 20;
				+        $config['remove_spaces'] = true;
				+        $this->upload->initialize($config);
				
				-		$config['upload_path'] = $user_dir;
				-		$config['allowed_types'] = '*';
				-		$config['max_size']	= $this->settings_model->get_setting('file_size_limit');
				-		$config['file_name'] = $this->file_name."-".($this->user->selected_assignment['total_submits']+1).".".$this->ext;
				-		$config['max_file_name'] = 20;
				-		$config['remove_spaces'] = TRUE;
				-		$this->upload->initialize($config);
				+        if ($this->upload->do_upload('userfile')) {
					+            $result = $this->upload->data();
					+            $this->load->model('submit_model');
					
					-		if ($this->upload->do_upload('userfile'))
					-		{
						-			$result = $this->upload->data();
						-			$this->load->model('submit_model');
						+            $submit_info = array(
						+                'submit_id' => $this->assignment_model->increase_total_submits($this->user->selected_assignment['id']),
						+                'username' => $this->user->username,
						+                'assignment' => $this->user->selected_assignment['id'],
						+                'problem' => $this->problem['id'],
						+                'file_name' => $result['raw_name'],
						+                'main_file_name' => $this->file_name,
						+                'file_type' => $this->filetype,
						+                'coefficient' => $this->coefficient,
						+                'pre_score' => 0,
						+                'time' => shj_now_str(),
						+            );
						+            if ($this->problem['is_upload_only'] == 0) {
							+                $this->queue_model->add_to_queue($submit_info);
							+                process_the_queue();
							+            } else {
							+                $this->submit_model->add_upload_only($submit_info);
							+            }
						
						-			$submit_info = array(
						-				'submit_id' => $this->assignment_model->increase_total_submits($this->user->selected_assignment['id']),
						-				'username' => $this->user->username,
						-				'assignment' => $this->user->selected_assignment['id'],
						-				'problem' => $this->problem['id'],
						-				'file_name' => $result['raw_name'],
						-				'main_file_name' => $this->file_name,
						-				'file_type' => $this->filetype,
						-				'coefficient' => $this->coefficient,
						-				'pre_score' => 0,
						-				'time' => shj_now_str(),
						-			);
						-			if ($this->problem['is_upload_only'] == 0)
						-			{
							-				$this->queue_model->add_to_queue($submit_info);
							-				process_the_queue();
							-			}
						-			else
						-			{
							-				$this->submit_model->add_upload_only($submit_info);
							-			}
						+            return true;
						+        }
					
					-			return TRUE;
					-		}
				+        return false;
				+    }
			
			-		return FALSE;
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		+    /**
		+     * Load code from editor file
		+     */
		+    public function load($problem_id)
		+    {
			+        $user_dir = rtrim($this->assignment_root, '/').'/assignment_'.$this->user->selected_assignment['id'].'/p'.$problem_id.'/'.$this->user->username;
			+        $file_path = $user_dir.'/'.EDITOR_FILE_NAME.'.'.EDITOR_FILE_EXT;
			+        $input_path = $user_dir.'/'.EDITOR_IN_NAME.'.'.EDITOR_FILE_EXT;
			+        $output_path = $user_dir.'/'.EDITOR_OUT_NAME.'.'.EDITOR_FILE_EXT;
			
			-	/**
			-	 * Load code from editor file
			-	 */
			-	public function load($problem_id){
				-		$user_dir = rtrim($this->assignment_root, '/').'/assignment_'.$this->user->selected_assignment['id'].'/p'.$problem_id.'/'.$this->user->username;
				-		$file_path = $user_dir.'/'.EDITOR_FILE_NAME.'.'.EDITOR_FILE_EXT;
				-		$input_path = $user_dir.'/'.EDITOR_IN_NAME.'.'.EDITOR_FILE_EXT;
				-		$output_path = $user_dir.'/'.EDITOR_OUT_NAME.'.'.EDITOR_FILE_EXT;
				-		
				-		$this->load->helper('file');
				-		if(!write_file($input_path, ' ')){}
				-		if(!write_file($output_path, ' ')){}
				-		if (!file_exists($file_path)){
					-			$response = json_encode(array(content=>'', message=>'No saved file'));
					-		}
				-		else{
					-			$file_content = file_get_contents($file_path);
					-			if ($file_content === FALSE){
						-				$response = json_encode(array(content=>'', message=>'Unable to load'));
						-			}
					-			else{
						-				addslashes($file_content);
						-				$response = json_encode(array(content=>$file_content, message=>'Loaded'));
						-			}
					-		}
				-		echo $response;
				-	}
			+        $this->load->helper('file');
			+        if(!write_file($input_path, ' ')) {
				+        }
			+        if(!write_file($output_path, ' ')) {
				+        }
			+        if (!file_exists($file_path)) {
				+            $response = json_encode(array(content => '', message => 'No saved file'));
				+        } else {
				+            $file_content = file_get_contents($file_path);
				+            if ($file_content === false) {
					+                $response = json_encode(array(content => '', message => 'Unable to load'));
					+            } else {
					+                addslashes($file_content);
					+                $response = json_encode(array(content => $file_content, message => 'Loaded'));
					+            }
				+        }
			+        echo $response;
			+    }
		
		
		-	// ------------------------------------------------------------------------
		+    // ------------------------------------------------------------------------
		
		-	/**
		-	 * Save code to editor file and submit/execute if needed
		-	 */
		-	public function save($type = FALSE){
			-		$data = $_POST['code_editor'];
			-		$problem_id = $_POST['problem_id'];
			-		$language = $_POST['language'];
			-		
			-		$user_dir = rtrim($this->assignment_root, '/').'/assignment_'.$this->user->selected_assignment['id'].'/p'.$problem_id.'/'.$this->user->username;
			-		if (!file_exists($user_dir)){
				-			mkdir($user_dir, 0700);
				-		}
			-		$file_path = $user_dir.'/'.EDITOR_FILE_NAME.'.'.EDITOR_FILE_EXT;
			-		$input_path = $user_dir.'/'.EDITOR_IN_NAME.'.'.EDITOR_FILE_EXT;
			+    /**
			+     * Save code to editor file and submit/execute if needed
			+     */
			+    public function save($type = false)
			+    {
				+        $data = $_POST['code_editor'];
				+        $problem_id = $_POST['problem_id'];
				+        $language = $_POST['language'];
				
				-		$this->load->helper('file');
				-		if (!write_file($file_path, $data)){
					-			$response = json_encode(array(status=>FALSE, message=>'Unable to save'));
					-			echo $response;
					-		}
				-		else{
					-			$response = json_encode(array(status=>TRUE, message=>'Saved'));
					-			if($type === FALSE){
						-				echo $response;
						-			}
					-			else{
						-				$now = shj_now();
						-				if ( $this->queue_model->in_queue($this->user->username,$this->user->selected_assignment['id'], $this->problem['id'])){
							-					$response = json_encode(array(status=>FALSE, message=>'You have already submitted for this problem. Your last submission is still in queue.'));
							-					echo $response;
							-				}
						-				else if ($this->user->level==0 && !$this->user->selected_assignment['open']){
							-					$response = json_encode(array(status=>FALSE, message=>'Selected assignment has been closed.'));
							-					echo $response;
							-				}
						-				else if ($now < strtotime($this->user->selected_assignment['start_time'])){
							-					$response = json_encode(array(status=>FALSE, message=>'Selected assignment has not started.'));
							-					echo $response;
							-				}
						-				else if ($now > strtotime($this->user->selected_assignment['finish_time'])+$this->user->selected_assignment['extra_time']){
							-					$response = json_encode(array(status=>FALSE, message=>'Selected assignment has finished.'));
							-					echo $response;
							-				}
						-				else if ( ! $this->assignment_model->is_participant($this->user->selected_assignment['participants'],$this->user->username)){
							-					$response = json_encode(array(status=>FALSE, message=>'You are not registered for submitting.'));
							-					echo $response;
							-				}
						-				else{
							-					if($type === 'submit'){
								-						$this->_submit($data, $problem_id, $language, $user_dir);
								-					}
							-					else if($type === 'execute'){
								-						$editor_input =  $_POST['editor_input'];
								-						if (!write_file($input_path, $editor_input)){
									-							$response = json_encode(array(status=>FALSE, message=>'Unable to write input file'));
									-							echo $response;
									-						}
								-						else{
									-							$this->_execute($data, $problem_id, $language, $user_dir);
									-						}
								-					}
							-				}
						-			}
					-		}
				+        $user_dir = rtrim($this->assignment_root, '/').'/assignment_'.$this->user->selected_assignment['id'].'/p'.$problem_id.'/'.$this->user->username;
				+        if (!file_exists($user_dir)) {
					+            mkdir($user_dir, 0700);
					+        }
				+        $file_path = $user_dir.'/'.EDITOR_FILE_NAME.'.'.EDITOR_FILE_EXT;
				+        $input_path = $user_dir.'/'.EDITOR_IN_NAME.'.'.EDITOR_FILE_EXT;
				
				+        $this->load->helper('file');
				+        if (!write_file($file_path, $data)) {
					+            $response = json_encode(array(status => false, message => 'Unable to save'));
					+            echo $response;
					+        } else {
					+            $response = json_encode(array(status => true, message => 'Saved'));
					+            if($type === false) {
						+                echo $response;
						+            } else {
						+                $now = shj_now();
						+                if ($this->queue_model->in_queue($this->user->username, $this->user->selected_assignment['id'], $this->problem['id'])) {
							+                    $response = json_encode(array(status => false, message => 'You have already submitted for this problem. Your last submission is still in queue.'));
							+                    echo $response;
							+                } elseif ($this->user->level == 0 && !$this->user->selected_assignment['open']) {
							+                    $response = json_encode(array(status => false, message => 'Selected assignment has been closed.'));
							+                    echo $response;
							+                } elseif ($now < strtotime($this->user->selected_assignment['start_time'])) {
							+                    $response = json_encode(array(status => false, message => 'Selected assignment has not started.'));
							+                    echo $response;
							+                } elseif ($now > strtotime($this->user->selected_assignment['finish_time']) + $this->user->selected_assignment['extra_time']) {
							+                    $response = json_encode(array(status => false, message => 'Selected assignment has finished.'));
							+                    echo $response;
							+                } elseif (! $this->assignment_model->is_participant($this->user->selected_assignment['participants'], $this->user->username)) {
							+                    $response = json_encode(array(status => false, message => 'You are not registered for submitting.'));
							+                    echo $response;
							+                } else {
							+                    if($type === 'submit') {
								+                        $this->_submit($data, $problem_id, $language, $user_dir);
								+                    } elseif($type === 'execute') {
								+                        $editor_input =  $_POST['editor_input'];
								+                        if (!write_file($input_path, $editor_input)) {
									+                            $response = json_encode(array(status => false, message => 'Unable to write input file'));
									+                            echo $response;
									+                        } else {
									+                            $this->_execute($data, $problem_id, $language, $user_dir);
									+                        }
								+                    }
							+                }
						+            }
					+        }
				
				-	}
			
			+    }
		
		-	// ------------------------------------------------------------------------
		
		-	/**
		-	 * Add code to queue for judging
		-	 */
		-	private function _submit($data, $problem_id, $language, $user_dir){
			-		$file_type = $this->_language_to_type(strtolower(trim($language)));
			-		$file_ext = $this->_language_to_ext(strtolower(trim($language)));
			-		$file_name = EDITOR_FILE_NAME;
			-		$file_fname = $file_name.'-'.($this->user->selected_assignment['total_submits']+1);
			-		$file_path = $user_dir.'/'.$file_fname.'.'.$file_ext;
			+    // ------------------------------------------------------------------------
			
			-		foreach($this->problems as $item)
			-			if ($item['id'] == $problem_id)
			-			{
				-				$this->problem = $item;
				-				break;
				-			}
			+    /**
			+     * Add code to queue for judging
			+     */
			+    private function _submit($data, $problem_id, $language, $user_dir)
			+    {
				+        $file_type = $this->_language_to_type(strtolower(trim($language)));
				+        $file_ext = $this->_language_to_ext(strtolower(trim($language)));
				+        $file_name = EDITOR_FILE_NAME;
				+        $file_fname = $file_name.'-'.($this->user->selected_assignment['total_submits'] + 1);
				+        $file_path = $user_dir.'/'.$file_fname.'.'.$file_ext;
				
				-		if (!write_file($file_path, $data)){
					-			$response = json_encode(array(status=>FALSE, message=>'Unable to submit'));
					-		}
				-		else{
					-			$this->load->model('submit_model');
					+        foreach($this->problems as $item) {
						+            if ($item['id'] == $problem_id) {
							+                $this->problem = $item;
							+                break;
							+            }
						+        }
					
					-			$submit_info = array(
					-				'submit_id' => $this->assignment_model->increase_total_submits($this->user->selected_assignment['id']),
					-				'username' => $this->user->username,
					-				'assignment' => $this->user->selected_assignment['id'],
					-				'problem' => $problem_id,
					-				'file_name' => $file_fname,
					-				'main_file_name' => $file_name,
					-				'file_type' => $file_type,
					-				'coefficient' => $this->coefficient,
					-				'pre_score' => 0,
					-				'time' => shj_now_str(),
					-			);
					-			if ($this->problem['is_upload_only'] == 0)
					-			{
						-				$this->queue_model->add_to_queue($submit_info);
						-				process_the_queue();
						-			}
					-			else
					-			{
						-				$this->submit_model->add_upload_only($submit_info);
						-			}
					+        if (!write_file($file_path, $data)) {
						+            $response = json_encode(array(status => false, message => 'Unable to submit'));
						+        } else {
						+            $this->load->model('submit_model');
						
						-			$response = json_encode(array(status=>TRUE, message=>"Submitted"));
						-		}
					-		echo $response;
					-	}
				+            $submit_info = array(
				+                'submit_id' => $this->assignment_model->increase_total_submits($this->user->selected_assignment['id']),
				+                'username' => $this->user->username,
				+                'assignment' => $this->user->selected_assignment['id'],
				+                'problem' => $problem_id,
				+                'file_name' => $file_fname,
				+                'main_file_name' => $file_name,
				+                'file_type' => $file_type,
				+                'coefficient' => $this->coefficient,
				+                'pre_score' => 0,
				+                'time' => shj_now_str(),
				+            );
				+            if ($this->problem['is_upload_only'] == 0) {
					+                $this->queue_model->add_to_queue($submit_info);
					+                process_the_queue();
					+            } else {
					+                $this->submit_model->add_upload_only($submit_info);
					+            }
				
				+            $response = json_encode(array(status => true, message => "Submitted"));
				+        }
			+        echo $response;
			+    }
		
		-	// ------------------------------------------------------------------------
		
		-	/**
		-	 * Add code to queue for execution only
		-	 */
		-	private function _execute($data, $problem_id, $language, $user_dir){
			-		$file_type = $this->_language_to_type(strtolower(trim($language)));
			-		$file_ext = $this->_language_to_ext(strtolower(trim($language)));
			-		$file_name = EDITOR_FILE_NAME;
			-		$file_fname = $file_name.'-'.EDITOR_SUBMIT_ID;
			-		$file_path = $user_dir.'/'.$file_fname.'.'.$file_ext;
			-		$output_path = $user_dir.'/'.EDITOR_OUT_NAME.'.'.EDITOR_FILE_EXT;
			+    // ------------------------------------------------------------------------
			
			-		if (!write_file($file_path, $data)){
				-			$response = json_encode(array(status=>FALSE, message=>'Unable to execute', debug=>$file_path));
				-		}
			-		else{
				-			$submit_info = array(
				-				'submit_id' => EDITOR_SUBMIT_ID,
				-				'username' => $this->user->username,
				-				'assignment' => $this->user->selected_assignment['id'],
				-				'problem' => $problem_id,
				-				'file_name' => $file_fname,
				-				'main_file_name' => $file_name,
				-				'file_type' => $file_type,
				-				'coefficient' => $this->coefficient,
				-				'pre_score' => 0,
				-				'time' => shj_now_str(),
				-			);
				+    /**
				+     * Add code to queue for execution only
				+     */
				+    private function _execute($data, $problem_id, $language, $user_dir)
				+    {
					+        $file_type = $this->_language_to_type(strtolower(trim($language)));
					+        $file_ext = $this->_language_to_ext(strtolower(trim($language)));
					+        $file_name = EDITOR_FILE_NAME;
					+        $file_fname = $file_name.'-'.EDITOR_SUBMIT_ID;
					+        $file_path = $user_dir.'/'.$file_fname.'.'.$file_ext;
					+        $output_path = $user_dir.'/'.EDITOR_OUT_NAME.'.'.EDITOR_FILE_EXT;
					
					-			if($this->queue_model->add_to_queue_exec($submit_info)){
						-				if (!write_file($output_path, 'Queueing...')){
							-					$response = json_encode(array(status=>FALSE, message=>'Unable to write output file'));
							-				}
						-				else{
							-					process_the_queue();
							-					$response = json_encode(array(status=>TRUE, message=>'Executing'));
							-				}
						-			}
					-			else{
						-				$response = json_encode(array(status=>FALSE, message=>'Still in queue'));
						-			}
					-		}
				-		echo $response;
				-	}
			-	
			+        if (!write_file($file_path, $data)) {
				+            $response = json_encode(array(status => false, message => 'Unable to execute', debug => $file_path));
				+        } else {
				+            $submit_info = array(
				+                'submit_id' => EDITOR_SUBMIT_ID,
				+                'username' => $this->user->username,
				+                'assignment' => $this->user->selected_assignment['id'],
				+                'problem' => $problem_id,
				+                'file_name' => $file_fname,
				+                'main_file_name' => $file_name,
				+                'file_type' => $file_type,
				+                'coefficient' => $this->coefficient,
				+                'pre_score' => 0,
				+                'time' => shj_now_str(),
				+            );
				
				-	// ------------------------------------------------------------------------
				+            if($this->queue_model->add_to_queue_exec($submit_info)) {
					+                if (!write_file($output_path, 'Queueing...')) {
						+                    $response = json_encode(array(status => false, message => 'Unable to write output file'));
						+                } else {
						+                    process_the_queue();
						+                    $response = json_encode(array(status => true, message => 'Executing'));
						+                }
					+            } else {
					+                $response = json_encode(array(status => false, message => 'Still in queue'));
					+            }
				+        }
			+        echo $response;
			+    }
		
		-	/**
		-	 * Load output file as execution result
		-	 */
		-	public function get_output($problem_id){
			-		$user_dir = rtrim($this->assignment_root, '/').'/assignment_'.$this->user->selected_assignment['id'].'/p'.$problem_id.'/'.$this->user->username;
			-		$file_path = $user_dir.'/'.EDITOR_OUT_NAME.'.'.EDITOR_FILE_EXT;
			
			-		if (!file_exists($file_path)){
				-			$response = json_encode(array(status=>FALSE, content=>''));
				-		}
			-		else{
				-			$this->load->helper('file');
				-			$file_content = file_get_contents($file_path);
				-			if ($file_content === FALSE){
					-				$response = json_encode(array(status=>FALSE, content=>''));
					-			}
				-			else{
					-				$complete_status = strpos($file_content, 'Total Execution Time');
					-				if($complete_status === FALSE){
						-					$response = json_encode(array(status=>FALSE, content=>$file_content));
						-				}
					-				else{
						-					$response = json_encode(array(status=>TRUE, content=>$file_content));
						-				}
					-			}
				-		}
			-		echo $response;
			-	}
		+    // ------------------------------------------------------------------------
		+
		+    /**
		+     * Load output file as execution result
		+     */
		+    public function get_output($problem_id)
		+    {
			+        $user_dir = rtrim($this->assignment_root, '/').'/assignment_'.$this->user->selected_assignment['id'].'/p'.$problem_id.'/'.$this->user->username;
			+        $file_path = $user_dir.'/'.EDITOR_OUT_NAME.'.'.EDITOR_FILE_EXT;
			+
			+        if (!file_exists($file_path)) {
				+            $response = json_encode(array(status => false, content => ''));
				+        } else {
				+            $this->load->helper('file');
				+            $file_content = file_get_contents($file_path);
				+            if ($file_content === false) {
					+                $response = json_encode(array(status => false, content => ''));
					+            } else {
					+                $complete_status = strpos($file_content, 'Total Execution Time');
					+                if($complete_status === false) {
						+                    $response = json_encode(array(status => false, content => $file_content));
						+                } else {
						+                    $response = json_encode(array(status => true, content => $file_content));
						+                }
					+            }
				+        }
			+        echo $response;
			+    }
	}
	
	----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Users.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/controllers/Users.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Users.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/controllers/Users.php
	@@ -4,7 +4,7 @@
	* @file Users.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	use PhpOffice\PhpSpreadsheet\Spreadsheet;
	use PhpOffice\PhpSpreadsheet\IOFactory;
	@@ -15,245 +15,249 @@
	
	class Users extends CI_Controller
	{
		+    public function __construct()
		+    {
			+        parent::__construct();
			+        if (! $this->session->userdata('logged_in')) { // if not logged in
				+            redirect('login');
				+        }
			+        if ($this->user->level <= 2) { // permission denied
				+            show_404();
				+        }
			+    }
		
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-		if ( ! $this->session->userdata('logged_in')) // if not logged in
			-			redirect('login');
			-		if ( $this->user->level <= 2) // permission denied
			-			show_404();
			-	}
		
		
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		
		
		+    public function index()
		+    {
			
			+        $data = array(
			+            'all_assignments' => $this->assignment_model->all_assignments(),
			+            'users' => $this->user_model->get_all_users()
			+        );
			
			-	public function index()
			-	{
				+        $this->twig->display('pages/admin/users.twig', $data);
				+    }
			
			-		$data = array(
			-			'all_assignments' => $this->assignment_model->all_assignments(),
			-			'users' => $this->user_model->get_all_users()
			-		);
			
			-		$this->twig->display('pages/admin/users.twig', $data);
			-	}
		
		
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		
		
		+    public function add()
		+    {
			+        $data = array(
			+            'all_assignments' => $this->assignment_model->all_assignments(),
			+        );
			+        $this->form_validation->set_rules('new_users', 'New Users', 'required');
			+        if ($this->form_validation->run()) {
				+            if (! $this->input->is_ajax_request()) {
					+                exit;
					+            }
				+            list($ok, $error) = $this->user_model->add_users(
				+                $this->input->post('new_users'),
				+                $this->input->post('send_mail'),
				+                $this->input->post('delay')
				+            );
				+            $this->twig->display('pages/admin/add_user_result.twig', array('ok' => $ok, 'error' => $error));
				+        } else {
				+            $this->twig->display('pages/admin/add_user.twig', $data);
				+        }
			+    }
		
		
		-	public function add()
		-	{
			-		$data = array(
			-			'all_assignments' => $this->assignment_model->all_assignments(),
			-		);
			-		$this->form_validation->set_rules('new_users', 'New Users', 'required');
			-		if ($this->form_validation->run())
			-		{
				-			if ( ! $this->input->is_ajax_request() )
				-				exit;
				-			list($ok, $error) = $this->user_model->add_users(
				-				$this->input->post('new_users'),
				-				$this->input->post('send_mail'),
				-				$this->input->post('delay')
				-			);
				-			$this->twig->display('pages/admin/add_user_result.twig', array('ok' => $ok, 'error' => $error));
				-		}
			-		else
			-		{
				-			$this->twig->display('pages/admin/add_user.twig', $data);
				-		}
			-	}
		
		
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		
		
		+    /**
		+     * Controller for deleting a user
		+     * Called by ajax request
		+     */
		+    public function delete()
		+    {
			+        if (! $this->input->is_ajax_request()) {
				+            show_404();
				+        }
			+        $user_id = $this->input->post('user_id');
			+        if (! is_numeric($user_id)) {
				+            $json_result = array('done' => 0, 'message' => 'Input Error');
				+        } elseif ($this->user_model->delete_user($user_id)) {
				+            $json_result = array('done' => 1);
				+        } else {
				+            $json_result = array('done' => 0, 'message' => 'Deleting User Failed');
				+        }
			
			+        $this->output->set_header('Content-Type: application/json; charset=utf-8');
			+        echo json_encode($json_result);
			+    }
		
		-	/**
		-	 * Controller for deleting a user
		-	 * Called by ajax request
		-	 */
		-	public function delete()
		-	{
			-		if ( ! $this->input->is_ajax_request() )
			-			show_404();
			-		$user_id = $this->input->post('user_id');
			-		if ( ! is_numeric($user_id) )
			-			$json_result = array('done' => 0, 'message' => 'Input Error');
			-		elseif ($this->user_model->delete_user($user_id))
			-			$json_result = array('done' => 1);
			-		else
			-			$json_result = array('done' => 0, 'message' => 'Deleting User Failed');
			
			-		$this->output->set_header('Content-Type: application/json; charset=utf-8');
			-		echo json_encode($json_result);
			-	}
		
		
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		
		
		+    /**
		+     * Controller for deleting a user's submissions
		+     * Called by ajax request
		+     */
		+    public function delete_submissions()
		+    {
			+        if (! $this->input->is_ajax_request()) {
				+            show_404();
				+        }
			+        $user_id = $this->input->post('user_id');
			+        if (! is_numeric($user_id)) {
				+            $json_result = array('done' => 0, 'message' => 'Input Error');
				+        } elseif ($this->user_model->delete_submissions($user_id)) {
				+            $json_result = array('done' => 1);
				+        } else {
				+            $json_result = array('done' => 0, 'message' => 'Deleting Submissions Failed');
				+        }
			
			+        $this->output->set_header('Content-Type: application/json; charset=utf-8');
			+        echo json_encode($json_result);
			+    }
		
		-	/**
		-	 * Controller for deleting a user's submissions
		-	 * Called by ajax request
		-	 */
		-	public function delete_submissions()
		-	{
			-		if ( ! $this->input->is_ajax_request() )
			-			show_404();
			-		$user_id = $this->input->post('user_id');
			-		if ( ! is_numeric($user_id) )
			-			$json_result = array('done' => 0, 'message' => 'Input Error');
			-		elseif ($this->user_model->delete_submissions($user_id))
			-			$json_result = array('done' => 1);
			-		else
			-			$json_result = array('done' => 0, 'message' => 'Deleting Submissions Failed');
			
			-		$this->output->set_header('Content-Type: application/json; charset=utf-8');
			-		echo json_encode($json_result);
			-	}
		
		
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		
		
		+    /**
		+     * Uses PHPExcel library to generate excel file of users list
		+     */
		+    public function list_excel()
		+    {
			
			+        $now = shj_now_str(); // current time
			
			-	/**
			-	 * Uses PHPExcel library to generate excel file of users list
			-	 */
			-	public function list_excel()
			-	{
				+        // Load PHPExcel library
				+        $phpspreedsheet = new Spreadsheet();
				
				-		$now = shj_now_str(); // current time
				+        // Set document properties
				+        $phpspreedsheet->getProperties()->setCreator('SharIF Judge')
				+            ->setLastModifiedBy('SharIF Judge')
				+            ->setTitle('SharIF Judge Users')
				+            ->setSubject('SharIF Judge Users')
				+            ->setDescription('List of SharIF Judge users ('.$now.')');
				
				-		// Load PHPExcel library
				-		$phpspreedsheet = new Spreadsheet();
				+        // Name of the file sent to browser
				+        $output_filename = 'sharifjudge_users';
				
				-		// Set document properties
				-		$phpspreedsheet->getProperties()->setCreator('SharIF Judge')
				-			->setLastModifiedBy('SharIF Judge')
				-			->setTitle('SharIF Judge Users')
				-			->setSubject('SharIF Judge Users')
				-			->setDescription('List of SharIF Judge users ('.$now.')');
				+        // Set active sheet
				+        $phpspreedsheet->setActiveSheetIndex(0);
				+        $sheet = $phpspreedsheet->getActiveSheet();
				
				-		// Name of the file sent to browser
				-		$output_filename = 'sharifjudge_users';
				+        // Add current time to document
				+        $sheet->fromArray(array('Time:',$now), null, 'A1', true);
				
				-		// Set active sheet
				-		$phpspreedsheet->setActiveSheetIndex(0);
				-		$sheet = $phpspreedsheet->getActiveSheet();
				+        // Add header to document
				+        $header = array('#','User ID','Username','Display Name','Email','Role','First Login','Last Login');
				+        $sheet->fromArray($header, null, 'A3', true);
				+        $highest_column = $sheet->getHighestColumn();
				
				-		// Add current time to document
				-		$sheet->fromArray(array('Time:',$now), null, 'A1', true);
				+        // Set custom style for header
				+        $sheet->getStyle('A3:'.$highest_column.'3')->applyFromArray(
				+            array(
				+                'fill' => array(
				+                    'fillType' => Fill::FILL_SOLID,
				+                    'color' => array('rgb' => '173C45')
				+                ),
				+                'font'  => array(
				+                    'bold'  => true,
				+                    'color' => array('rgb' => 'FFFFFF'),
				+                    //'size'  => 14
				+                )
				+            )
				+        );
				
				-		// Add header to document
				-		$header=array('#','User ID','Username','Display Name','Email','Role','First Login','Last Login');
				-		$sheet->fromArray($header, null, 'A3', true);
				-		$highest_column = $sheet->getHighestColumn();
				+        // Prepare user data (in $rows array)
				+        $users = $this->user_model->get_all_users();
				+        $i = 0;
				+        $rows = array();
				+        foreach ($users as $user) {
					+            array_push($rows, array(
					+                ++$i,
					+                $user['id'],
					+                $user['username'],
					+                $user['display_name'],
					+                $user['email'],
					+                $user['role'],
					+                $user['first_login_time'] === null ? 'Never' : $user['first_login_time'],
					+                $user['last_login_time'] === null ? 'Never' : $user['last_login_time']
					+            ));
					+        }
				
				-		// Set custom style for header
				-		$sheet->getStyle('A3:'.$highest_column.'3')->applyFromArray(
				-			array(
				-				'fill' => array(
				-					'fillType' => Fill::FILL_SOLID,
				-					'color' => array('rgb' => '173C45')
				-				),
				-				'font'  => array(
				-					'bold'  => true,
				-					'color' => array('rgb' => 'FFFFFF'),
				-					//'size'  => 14
				-				)
				-			)
				-		);
				+        // Add rows to document and set a background color of #7BD1BE
				+        $sheet->fromArray($rows, null, 'A4', true);
				+        // Add alternative colors to rows
				+        for ($i = 4; $i < count($rows) + 4; $i++) {
					+            $sheet->getStyle('A'.$i.':'.$highest_column.$i)->applyFromArray(
					+                array(
					+                    'fill' => array(
					+                        'fillType' => Fill::FILL_SOLID,
					+                        'color' => array('rgb' => (($i % 2) ? 'F0F0F0' : 'FAFAFA'))
					+                    )
					+                )
					+            );
					+        }
				
				-		// Prepare user data (in $rows array)
				-		$users = $this->user_model->get_all_users();
				-		$i=0;
				-		$rows = array();
				-		foreach ($users as $user){
					-			array_push($rows, array(
					-				++$i,
					-				$user['id'],
					-				$user['username'],
					-				$user['display_name'],
					-				$user['email'],
					-				$user['role'],
					-				$user['first_login_time']===NULL?'Never':$user['first_login_time'],
					-				$user['last_login_time']===NULL?'Never':$user['last_login_time']
					-			));
					-		}
				+        // Set text align to center
				+        $sheet->getStyle($sheet->calculateWorksheetDimension())
				+            ->getAlignment()
				+            ->setHorizontal(Alignment::HORIZONTAL_CENTER);
				
				-		// Add rows to document and set a background color of #7BD1BE
				-		$sheet->fromArray($rows, null, 'A4', true);
				-		// Add alternative colors to rows
				-		for ($i=4; $i<count($rows)+4; $i++){
					-			$sheet->getStyle('A'.$i.':'.$highest_column.$i)->applyFromArray(
					-				array(
					-					'fill' => array(
					-						'fillType' => Fill::FILL_SOLID,
					-						'color' => array('rgb' => (($i%2)?'F0F0F0':'FAFAFA'))
					-					)
					-				)
					-			);
					-		}
				+        // Making columns autosize
				+        for ($i = 2;$i < count($header);$i++) {
					+            $sheet->getColumnDimension(chr(65 + $i))->setAutoSize(true);
					+        }
				
				-		// Set text align to center
				-		$sheet->getStyle( $sheet->calculateWorksheetDimension() )
				-			->getAlignment()
				-			->setHorizontal(Alignment::HORIZONTAL_CENTER);
				+        // Set Border
				+        $sheet->getStyle('A4:'.$highest_column.$sheet->getHighestRow())->applyFromArray(
				+            array(
				+                'borders' => array(
				+                    'outline' => array(
				+                        'borderStyle' => Border::BORDER_THIN,
				+                        'color' => array('rgb' => '444444'),
				+                    ),
				+                )
				+            )
				+        );
				
				-		// Making columns autosize
				-		for ($i=2;$i<count($header);$i++)
				-			$sheet->getColumnDimension(chr(65+$i))->setAutoSize(true);
				+        // Send the file to browser
				
				-		// Set Border
				-		$sheet->getStyle('A4:'.$highest_column.$sheet->getHighestRow())->applyFromArray(
				-			array(
				-				'borders' => array(
				-					'outline' => array(
				-						'borderStyle' => Border::BORDER_THIN,
				-						'color' => array('rgb' => '444444'),
				-					),
				-				)
				-			)
				-		);
				+        // If class ZipArchive exists, export to excel2007, otherwise export to excel5
				+        if (class_exists('ZipArchive')) {
					+            $ext = 'xlsx';
					+        } else {
					+            $ext = 'xls';
					+        }
				
				-		// Send the file to browser
				-
				-		// If class ZipArchive exists, export to excel2007, otherwise export to excel5
				-		if ( class_exists('ZipArchive') )
				-			$ext = 'xlsx';
				-		else
				-			$ext = 'xls';
				-
				-		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
				-		header('Content-Disposition: attachment;filename="'.$output_filename.'.'.$ext.'"');
				-		header('Cache-Control: max-age=0');
				-		$objWriter = IOFactory::createWriter($phpspreedsheet, ucfirst($ext));
				-		$objWriter->save('php://output');
				-	}
			+        header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			+        header('Content-Disposition: attachment;filename="'.$output_filename.'.'.$ext.'"');
			+        header('Cache-Control: max-age=0');
			+        $objWriter = IOFactory::createWriter($phpspreedsheet, ucfirst($ext));
			+        $objWriter->save('php://output');
			+    }
		
		
	}
	
	----------- end diff -----------
\end{lstlisting}


% helpers
\begin{lstlisting}[language=diff, caption=Perubahan pada kode shj\_helper.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/helpers/shj_helper.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/helpers/shj_helper.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/helpers/shj_helper.php
	@@ -4,148 +4,141 @@
	* @file shj_helper.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	
	-if ( ! function_exists('shj_now'))
	-{
		-	/**
		-	 * Returns server time (uses time zone in settings table)
		-	 */
		-	function shj_now()
		-	{
			-		if ( ! defined('SHJ_NOW') )
			-		{
				-			$CI =& get_instance();
				-			$CI->load->model('settings_model');
				-			$now = new DateTime('now', new DateTimeZone($CI->settings_model->get_setting('timezone')));
				-			sscanf($now->format('j-n-Y G:i:s'), '%d-%d-%d %d:%d:%d', $day, $month, $year, $hour, $minute, $second);
				-			define('SHJ_NOW', mktime($hour, $minute, $second, $month, $day, $year));
				-		}
			-		return SHJ_NOW;
			-	}
		+if (! function_exists('shj_now')) {
			+    /**
			+     * Returns server time (uses time zone in settings table)
			+     */
			+    function shj_now()
			+    {
				+        if (! defined('SHJ_NOW')) {
					+            $CI = & get_instance();
					+            $CI->load->model('settings_model');
					+            $now = new DateTime('now', new DateTimeZone($CI->settings_model->get_setting('timezone')));
					+            sscanf($now->format('j-n-Y G:i:s'), '%d-%d-%d %d:%d:%d', $day, $month, $year, $hour, $minute, $second);
					+            define('SHJ_NOW', mktime($hour, $minute, $second, $month, $day, $year));
					+        }
				+        return SHJ_NOW;
				+    }
		}
		
		
		
		-if ( ! function_exists('shj_now_str'))
		-{
			-	/**
			-	 * Returns server time (uses time zone in settings table)
			-	 */
			-	function shj_now_str()
			-	{
				-		if ( ! defined('SHJ_NOW_STR') )
				-			define('SHJ_NOW_STR', date("Y-m-d H:i:s", shj_now()));
				-		return SHJ_NOW_STR;
				-	}
			+if (! function_exists('shj_now_str')) {
				+    /**
				+     * Returns server time (uses time zone in settings table)
				+     */
				+    function shj_now_str()
				+    {
					+        if (! defined('SHJ_NOW_STR')) {
						+            define('SHJ_NOW_STR', date("Y-m-d H:i:s", shj_now()));
						+        }
					+        return SHJ_NOW_STR;
					+    }
			}
			
			
			
			-if ( ! function_exists('time_hhmm') )
			-{
				-	/**
				-	 * Formats time (HH:MM)
				-	 *
				-	 * HH is total hours
				-	 *
				-	 * @param $seconds
				-	 * @return string
				-	 */
				-	function time_hhmm($seconds)
				-	{
					-		$m = floor($seconds / 60);
					-		$hours = str_pad(floor($m / 60), 2, '0', STR_PAD_LEFT);
					-		$minutes = str_pad($m % 60, 2, '0', STR_PAD_LEFT);
					-		return "$hours:$minutes";
					-	}
				+if (! function_exists('time_hhmm')) {
					+    /**
					+     * Formats time (HH:MM)
					+     *
					+     * HH is total hours
					+     *
					+     * @param $seconds
					+     * @return string
					+     */
					+    function time_hhmm($seconds)
					+    {
						+        $m = floor($seconds / 60);
						+        $hours = str_pad(floor($m / 60), 2, '0', STR_PAD_LEFT);
						+        $minutes = str_pad($m % 60, 2, '0', STR_PAD_LEFT);
						+        return "$hours:$minutes";
						+    }
				}
				
				
				
				-if ( ! function_exists('filetype_to_extension'))
				-{
					+if (! function_exists('filetype_to_extension')) {
						
						-	/**
						-	 * Converts code type to file extension
						-	 */
						-	function filetype_to_extension($file_type)
						-	{
							-		$file_type = strtolower($file_type);
							-		switch ($file_type) {
								-			case 'c': return 'c';
								-			case 'cpp': return 'cpp';
								-			case 'py2': return 'py';
								-			case 'py3': return 'py';
								-			case 'java': return 'java';
								-			case 'zip': return 'zip';
								-			case 'pdf': return 'pdf';
								-			case 'txt': return 'txt';
								-			default: return FALSE;
								-		}
							-	}
						+    /**
						+     * Converts code type to file extension
						+     */
						+    function filetype_to_extension($file_type)
						+    {
							+        $file_type = strtolower($file_type);
							+        switch ($file_type) {
								+            case 'c': return 'c';
								+            case 'cpp': return 'cpp';
								+            case 'py2': return 'py';
								+            case 'py3': return 'py';
								+            case 'java': return 'java';
								+            case 'zip': return 'zip';
								+            case 'pdf': return 'pdf';
								+            case 'txt': return 'txt';
								+            default: return false;
								+        }
							+    }
					}
					
					
					-if ( ! function_exists('filetype_to_language'))
					-{
						+if (! function_exists('filetype_to_language')) {
							
							-	/**
							-	 * Converts code type to language
							-	 */
							-	function filetype_to_language($file_type)
							-	{
								-		$file_type = strtolower($file_type);
								-		switch ($file_type) {
									-			case 'c': return 'C';
									-			case 'cpp': return 'C++';
									-			case 'py2': return 'Py 2';
									-			case 'py3': return 'Py 3';
									-			case 'java': return 'Java';
									-			case 'zip': return 'Zip';
									-			case 'pdf': return 'PDF';
									-			case 'txt': return 'TXT';
									-			default: return FALSE;
									-		}
								-	}
							+    /**
							+     * Converts code type to language
							+     */
							+    function filetype_to_language($file_type)
							+    {
								+        $file_type = strtolower($file_type);
								+        switch ($file_type) {
									+            case 'c': return 'C';
									+            case 'cpp': return 'C++';
									+            case 'py2': return 'Py 2';
									+            case 'py3': return 'Py 3';
									+            case 'java': return 'Java';
									+            case 'zip': return 'Zip';
									+            case 'pdf': return 'PDF';
									+            case 'txt': return 'TXT';
									+            default: return false;
									+        }
								+    }
						}
						
						
						-if ( ! function_exists('process_the_queue'))
						-{
							-	function process_the_queue()
							-	{
								-		shell_exec(
								-			'export SHJ_BASE_URL='.escapeshellarg(base_url()).'; '.
								-			'php '.escapeshellarg(FCPATH.'index.php')." queueprocess run >/dev/null 2>/dev/null &"
								-		);
								-	}
							+if (! function_exists('process_the_queue')) {
								+    function process_the_queue()
								+    {
									+        shell_exec(
									+            'export SHJ_BASE_URL='.escapeshellarg(base_url()).'; '.
									+            'php '.escapeshellarg(FCPATH.'index.php')." queueprocess run >/dev/null 2>/dev/null &"
									+        );
									+    }
							}
							
							
							-if ( ! function_exists('shj_random_password'))
							-{
								-	function shj_random_password($len = 6)
								-	{
									-		$pool = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ|!@#$%^&*()_-+=\\/[]{}\'":;?<>.,~';
									-		$password = '';
									-		for ($i = 0; $i < $len; $i++)
									-			$password .= $pool [ rand(0, strlen($pool)-1) ];
									-		return $password;
									-	}
								+if (! function_exists('shj_random_password')) {
									+    function shj_random_password($len = 6)
									+    {
										+        $pool = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ|!@#$%^&*()_-+=\\/[]{}\'":;?<>.,~';
										+        $password = '';
										+        for ($i = 0; $i < $len; $i++) {
											+            $password .= $pool [ rand(0, strlen($pool) - 1) ];
											+        }
										+        return $password;
										+    }
								}
								
								
								
								-if ( ! function_exists('shj_basename'))
								-{
									-	function shj_basename($path)
									-	{
										-		return preg_replace('$^.*[\\\\/]$', '', $path);
										-	}
									+if (! function_exists('shj_basename')) {
										+    function shj_basename($path)
										+    {
											+        return preg_replace('$^.*[\\\\/]$', '', $path);
											+    }
									}
									
									
									/* End of file shj_helper.php */
									-/* Location: ./application/helpers/shj_helper.php */
									\ No newline at end of file
									+/* Location: ./application/helpers/shj_helper.php */
									
									----------- end diff -----------
\end{lstlisting}


% language/english
\begin{lstlisting}[language=diff, caption=Perubahan pada kode form\_validation\_lang.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/language/english/form_validation_lang.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/language/english/form_validation_lang.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/language/english/form_validation_lang.php
	@@ -4,9 +4,9 @@
	* @file form_validation_lang.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	$lang['form_validation_lowercase']		= 'The {field} field must be lowercase.';
	
	/* End of file form_validation_lang.php */
	-/* Location: ./system/language/english/form_validation_lang.php */
	\ No newline at end of file
	+/* Location: ./system/language/english/form_validation_lang.php */
	
	----------- end diff -----------
\end{lstlisting}


% libraries
\begin{lstlisting}[language=diff, caption=Perubahan pada kode MY\_Form\_validation.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/libraries/MY_Form_validation.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/libraries/MY_Form_validation.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/libraries/MY_Form_validation.php
	@@ -4,40 +4,39 @@
	* @file MY_Form_validation.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	
	class MY_Form_validation extends CI_Form_validation
	{
		+    /**
		+     * Required
		+     *
		+     * @param	string
		+     * @return	bool
		+     */
		+    public function required($str)
		+    {
			+        return is_array($str) ? (bool) count($str) : ($str !== '');
			+    }
		
		-	/**
		-	 * Required
		-	 *
		-	 * @param	string
		-	 * @return	bool
		-	 */
		-	public function required($str)
		-	{
			-		return is_array($str) ? (bool) count($str) : ($str !== '');
			-	}
		
		+    // -------------------------------------------------------------------------
		
		-	// -------------------------------------------------------------------------
		
		+    /**
		+     * Is Lowercase
		+     *
		+     * @param $str
		+     * @return bool
		+     */
		+    public function lowercase($str)
		+    {
			+        return (strtolower($str) === $str);
			+    }
		
		-	/**
		-	 * Is Lowercase
		-	 *
		-	 * @param $str
		-	 * @return bool
		-	 */
		-	public function lowercase($str)
		-	{
			-		return (strtolower($str) === $str);
			-	}
		
		-
	}
	
	/* End of file MY_Form_validation.php */
	-/* Location: ./application/libraries/MY_Form_validation.php */
	\ No newline at end of file
	+/* Location: ./application/libraries/MY_Form_validation.php */
	
	----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode MY\_Profiler.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/libraries/MY_Profiler.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/libraries/MY_Profiler.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/libraries/MY_Profiler.php
	@@ -1,9 +1,10 @@
	<?php
	+
	class MY_Profiler extends CI_Profiler
	{
		-	public function run()
		-	{
			-		$output = parent::run();
			-		file_put_contents('/home/mohammad/profiler.html', $output);
			-	}
		-}
	\ No newline at end of file
	+    public function run()
	+    {
		+        $output = parent::run();
		+        file_put_contents('/home/mohammad/profiler.html', $output);
		+    }
	+}

----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Shj\_pagination.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/libraries/Shj_pagination.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/libraries/Shj_pagination.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/libraries/Shj_pagination.php
	@@ -4,79 +4,81 @@
	* @file Shj_pagination.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Shj_pagination
	{
		+    private $base_url;
		+    private $cur_page;
		+    private $total_rows;
		+    private $per_page;
		+    private $num_links;
		+    private $ul_class;
		+    private $cur_li_class;
		+    private $total_pages;
		
		-	private $base_url;
		-	private $cur_page;
		-	private $total_rows;
		-	private $per_page;
		-	private $num_links;
		-	private $ul_class;
		-	private $cur_li_class;
		-	private $total_pages;
		+    public function __construct($config = array())
		+    {
			+        $this->base_url = $config['base_url']; // assuming it has no trailing slash
			+        $this->cur_page = $config['cur_page'];
			+        $this->total_rows = $config['total_rows'];
			+        $this->per_page = $config['per_page'];
			+        $this->num_links = $config['num_links'];
			+        $this->ul_class = $config['full_ul_class'];
			+        $this->cur_li_class = $config['cur_li_class'];
			+        if ($config['per_page'] != 0) {
				+            $this->total_pages = ceil($config['total_rows'] / $config['per_page']);
				+        }
			+    }
		
		-	public function __construct($config = array())
		-	{
			-		$this->base_url = $config['base_url']; // assuming it has no trailing slash
			-		$this->cur_page = $config['cur_page'];
			-		$this->total_rows = $config['total_rows'];
			-		$this->per_page = $config['per_page'];
			-		$this->num_links = $config['num_links'];
			-		$this->ul_class = $config['full_ul_class'];
			-		$this->cur_li_class = $config['cur_li_class'];
			-		if ($config['per_page'] != 0)
			-			$this->total_pages = ceil($config['total_rows']/$config['per_page']);
			-	}
		+    public function create_links()
		+    {
			+        if ($this->per_page == 0) {
				+            return '';
				+        }
			
			-	public function create_links()
			-	{
				-		if ($this->per_page == 0)
				-			return '';
				+        $output = '<ul class="'.$this->ul_class.'">';
				
				-		$output = '<ul class="'.$this->ul_class.'">';
				+        if ($this->cur_page > $this->total_pages) {
					+            $this->cur_page = $this->total_pages;
					+        }
				
				-		if ($this->cur_page > $this->total_pages)
				-			$this->cur_page = $this->total_pages;
				+        $start_page = $this->cur_page - $this->num_links;
				+        if ($start_page <= 0) {
					+            $start_page = 1;
					+        }
				
				-		$start_page = $this->cur_page - $this->num_links;
				-		if ($start_page <= 0)
				-			$start_page = 1;
				+        $end_page = $this->cur_page + $this->num_links;
				+        if ($end_page > $this->total_pages) {
					+            $end_page = $this->total_pages;
					+        }
				
				-		$end_page = $this->cur_page + $this->num_links;
				-		if ($end_page > $this->total_pages)
				-			$end_page = $this->total_pages;
				+        if ($end_page == 1 || $end_page == 0) {
					+            return '';
					+        }
				
				-		if ($end_page == 1 || $end_page == 0)
				-			return '';
				+        // Rendering Output
				
				-		// Rendering Output
				+        if ($this->cur_page != 1) {
					+            $output .= '<li><a href="'.$this->base_url.'">&lsaquo; First</a></li>';
					+            $output .= '<li><a href="'.$this->base_url.'/page/'.($this->cur_page - 1).'">&lsaquo;</a></li>';
					+        }
				
				-		if ($this->cur_page != 1)
				-		{
					-			$output .= '<li><a href="'.$this->base_url.'">&lsaquo; First</a></li>';
					-			$output .= '<li><a href="'.$this->base_url.'/page/'.($this->cur_page-1).'">&lsaquo;</a></li>';
					-		}
				+        for ($i = $start_page; $i <= $end_page; $i++) {
					+            $output .= '<li'.($i == $this->cur_page ? ' class="current_page"' : '').'><a href="'.$this->base_url.'/page/'.$i.'">'.$i.'</a></li>';
					+        }
				
				-		for ($i = $start_page; $i <= $end_page; $i++)
				-		{
					-			$output .= '<li'.($i==$this->cur_page?' class="current_page"':'').'><a href="'.$this->base_url.'/page/'.$i.'">'.$i.'</a></li>';
					-		}
				+        if ($this->cur_page != $this->total_pages) {
					+            $output .= '<li><a href="'.$this->base_url.'/page/'.($this->cur_page + 1).'">&rsaquo;</a></li>';
					+            $output .= '<li><a href="'.$this->base_url.'/page/'.$this->total_pages.'">Last ('.$this->total_pages.') &rsaquo;</a></li>';
					+        }
				
				-		if ($this->cur_page != $this->total_pages)
				-		{
					-			$output .= '<li><a href="'.$this->base_url.'/page/'.($this->cur_page+1).'">&rsaquo;</a></li>';
					-			$output .= '<li><a href="'.$this->base_url.'/page/'.$this->total_pages.'">Last ('.$this->total_pages.') &rsaquo;</a></li>';
					-		}
				+        $output .= '</ul>';
				
				-		$output .= '</ul>';
				+        return $output;
				
				-		return $output;
				-
				-	}
			+    }
	}
	
	/* End of file Shj_pagination.php */
	-/* Location: ./application/libraries/Shj_pagination.php */
	\ No newline at end of file
	+/* Location: ./application/libraries/Shj_pagination.php */
	
	----------- end diff -----------
\end{lstlisting}


% models
\begin{lstlisting}[language=diff, caption=Perubahan pada kode Assignment\_model.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/models/Assignment_model.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/models/Assignment_model.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/models/Assignment_model.php
	@@ -4,485 +4,491 @@
	* @file Assignment_model.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Assignment_model extends CI_Model
	{
		+    public function __construct()
		+    {
			+        parent::__construct();
			+    }
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-	}
		
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		
		+    /**
		+     * Add New Assignment to DB / Edit Existing Assignment
		+     *
		+     * @param $id
		+     * @param bool $edit
		+     * @return bool
		+     */
		+    public function add_assignment($id, $edit = false)
		+    {
			+        // Start Database Transaction
			+        $this->db->trans_start();
			
			-	/**
			-	 * Add New Assignment to DB / Edit Existing Assignment
			-	 *
			-	 * @param $id
			-	 * @param bool $edit
			-	 * @return bool
			-	 */
			-	public function add_assignment($id, $edit = FALSE)
			-	{
				-		// Start Database Transaction
				-		$this->db->trans_start();
				+        $extra_items = explode('*', $this->input->post('extra_time'));
				+        $extra_time = 1;
				+        foreach($extra_items as $extra_item) {
					+            $extra_time *= $extra_item;
					+        }
				
				-		$extra_items = explode('*', $this->input->post('extra_time'));
				-		$extra_time = 1;
				-		foreach($extra_items as $extra_item)
				-		{
					-			$extra_time *= $extra_item;
					-		}
				+        $archived_assignment = $archived_assignment = $this->input->post('archived_assignment') !== null ? 1 : 0;
				
				-		$archived_assignment = $archived_assignment = $this->input->post('archived_assignment')!==NULL ? 1 : 0;
				+        $assignment = array(
				+            'id' => $id,
				+            'name' => $this->input->post('assignment_name'),
				+            'problems' => $this->input->post('number_of_problems'),
				+            'total_submits' => 0,
				+            'open' => ($this->input->post('open') === null ? 0 : 1),
				+            'scoreboard' => ($this->input->post('scoreboard') === null ? 0 : 1),
				+            'javaexceptions' => ($this->input->post('javaexceptions') === null ? 0 : 1),
				+            'description' => '', /* todo */
				+            'start_time' => date('Y-m-d H:i:s', strtotime($this->input->post('start_time'))),
				+            'finish_time' => date('Y-m-d H:i:s', strtotime($this->input->post('finish_time'))),
				+            'extra_time' => $extra_time * 60,
				+            'late_rule' => $this->input->post('late_rule'),
				+            'participants' => $this->input->post('participants'),
				+            'archived_assignment' => $archived_assignment
				+        );
				+        if($edit) {
					+            $before = $this->db->get_where('assignments', array('id' => $id))->row_array();
					+            unset($assignment['total_submits']);
					+            $this->db->where('id', $id)->update('assignments', $assignment);
					+            // each time we edit an assignment, we should update coefficient of all submissions of that assignment
					+            if ($assignment['extra_time'] != $before['extra_time'] or $assignment['start_time'] != $before['start_time'] or $assignment['finish_time'] != $before['finish_time'] or $assignment['late_rule'] != $before['late_rule']) {
						+                $this->_update_coefficients($id, $assignment['extra_time'], $assignment['finish_time'], $assignment['late_rule']);
						+            }
					+        } else {
					+            $this->db->insert('assignments', $assignment);
					+        }
				
				-		$assignment = array(
				-			'id' => $id,
				-			'name' => $this->input->post('assignment_name'),
				-			'problems' => $this->input->post('number_of_problems'),
				-			'total_submits' => 0,
				-			'open' => ($this->input->post('open')===NULL?0:1),
				-			'scoreboard' => ($this->input->post('scoreboard')===NULL?0:1),
				-			'javaexceptions' => ($this->input->post('javaexceptions')===NULL?0:1),
				-			'description' => '', /* todo */
				-			'start_time' => date('Y-m-d H:i:s', strtotime($this->input->post('start_time'))),
				-			'finish_time' => date('Y-m-d H:i:s', strtotime($this->input->post('finish_time'))),
				-			'extra_time' => $extra_time*60,
				-			'late_rule' => $this->input->post('late_rule'),
				-			'participants' => $this->input->post('participants'),
				-			'archived_assignment' => $archived_assignment
				-		);
				-		if($edit)
				-		{
					-			$before = $this->db->get_where('assignments', array('id'=>$id))->row_array();
					-			unset($assignment['total_submits']);
					-			$this->db->where('id', $id)->update('assignments', $assignment);
					-			// each time we edit an assignment, we should update coefficient of all submissions of that assignment
					-			if ($assignment['extra_time']!=$before['extra_time'] OR $assignment['start_time']!=$before['start_time'] OR $assignment['finish_time']!=$before['finish_time'] OR $assignment['late_rule']!=$before['late_rule'])
					-				$this->_update_coefficients($id, $assignment['extra_time'], $assignment['finish_time'], $assignment['late_rule']);
					-		}
				-		else
				-			$this->db->insert('assignments', $assignment);
				+        /* **** Adding problems to "problems" table **** */
				
				-		/* **** Adding problems to "problems" table **** */
				+        //First remove all previous problems
				+        $this->db->delete('problems', array('assignment' => $id));
				
				-		//First remove all previous problems
				-		$this->db->delete('problems', array('assignment'=>$id));
				+        //Now add new problems:
				+        $names = $this->input->post('name');
				+        $scores = $this->input->post('score');
				+        $c_tl = $this->input->post('c_time_limit');
				+        $py_tl = $this->input->post('python_time_limit');
				+        $java_tl = $this->input->post('java_time_limit');
				+        $ml = $this->input->post('memory_limit');
				+        $ft = $this->input->post('languages');
				+        $dc = $this->input->post('diff_cmd');
				+        $da = $this->input->post('diff_arg');
				+        $uo = $this->input->post('is_upload_only');
				+        if ($uo === null) {
					+            $uo = array();
					+        }
				+        for ($i = 1; $i <= $this->input->post('number_of_problems'); $i++) {
					+            $items = explode(',', $ft[$i - 1]);
					+            $ft[$i - 1] = '';
					+            foreach ($items as $item) {
						+                $item = trim($item);
						+                $item2 = strtolower($item);
						+                $item = ucfirst($item2);
						+                if ($item2 === 'python2') {
							+                    $item = 'Python 2';
							+                } elseif ($item2 === 'python3') {
							+                    $item = 'Python 3';
							+                } elseif ($item2 === 'pdf') {
							+                    $item = 'PDF';
							+                }
						+                $item2 = strtolower($item);
						+                if (! in_array($item2, array('c','c++','python 2','python 3','java','zip','pdf','txt'))) {
							+                    continue;
							+                }
						+                // If the problem is not Upload-Only, its language should be one of {C,C++,Python 2, Python 3,Java}
						+                if (! in_array($i, $uo) && ! in_array($item2, array('c','c++','python 2','python 3','java'))) {
							+                    continue;
							+                }
						+                $ft[$i - 1] .= $item.",";
						+            }
					+            $ft[$i - 1] = substr($ft[$i - 1], 0, strlen($ft[$i - 1]) - 1); // remove last ','
					+            $problem = array(
					+                'assignment' => $id,
					+                'id' => $i,
					+                'name' => $names[$i - 1],
					+                'score' => $scores[$i - 1],
					+                'is_upload_only' => in_array($i, $uo) ? 1 : 0,
					+                'c_time_limit' => $c_tl[$i - 1],
					+                'python_time_limit' => $py_tl[$i - 1],
					+                'java_time_limit' => $java_tl[$i - 1],
					+                'memory_limit' => $ml[$i - 1],
					+                'allowed_languages' => $ft[$i - 1],
					+                'diff_cmd' => $dc[$i - 1],
					+                'diff_arg' => $da[$i - 1],
					+            );
					+            $this->db->insert('problems', $problem);
					+        }
				
				-		//Now add new problems:
				-		$names = $this->input->post('name');
				-		$scores = $this->input->post('score');
				-		$c_tl = $this->input->post('c_time_limit');
				-		$py_tl = $this->input->post('python_time_limit');
				-		$java_tl = $this->input->post('java_time_limit');
				-		$ml = $this->input->post('memory_limit');
				-		$ft = $this->input->post('languages');
				-		$dc = $this->input->post('diff_cmd');
				-		$da = $this->input->post('diff_arg');
				-		$uo = $this->input->post('is_upload_only');
				-		if ($uo === NULL)
				-			$uo = array();
				-		for ($i=1; $i<=$this->input->post('number_of_problems'); $i++)
				-		{
					-			$items = explode(',', $ft[$i-1]);
					-			$ft[$i-1] = '';
					-			foreach ($items as $item){
						-				$item = trim($item);
						-				$item2 = strtolower($item);
						-				$item = ucfirst($item2);
						-				if ($item2 === 'python2')
						-					$item = 'Python 2';
						-				elseif ($item2 === 'python3')
						-					$item = 'Python 3';
						-				elseif ($item2 === 'pdf')
						-					$item = 'PDF';
						-				$item2 = strtolower($item);
						-				if ( ! in_array($item2, array('c','c++','python 2','python 3','java','zip','pdf','txt')))
						-					continue;
						-				// If the problem is not Upload-Only, its language should be one of {C,C++,Python 2, Python 3,Java}
						-				if ( ! in_array($i, $uo) && ! in_array($item2, array('c','c++','python 2','python 3','java')) )
						-					continue;
						-				$ft[$i-1] .= $item.",";
						-			}
					-			$ft[$i-1] = substr($ft[$i-1],0,strlen($ft[$i-1])-1); // remove last ','
					-			$problem = array(
					-				'assignment' => $id,
					-				'id' => $i,
					-				'name' => $names[$i-1],
					-				'score' => $scores[$i-1],
					-				'is_upload_only' => in_array($i,$uo)?1:0,
					-				'c_time_limit' => $c_tl[$i-1],
					-				'python_time_limit' => $py_tl[$i-1],
					-				'java_time_limit' => $java_tl[$i-1],
					-				'memory_limit' => $ml[$i-1],
					-				'allowed_languages' => $ft[$i-1],
					-				'diff_cmd' => $dc[$i-1],
					-				'diff_arg' => $da[$i-1],
					-			);
					-			$this->db->insert('problems', $problem);
					-		}
				+        if ($edit) {
					+            // We must update scoreboard of the assignment
					+            $this->load->model('scoreboard_model');
					+            $this->scoreboard_model->update_scoreboard($id);
					+        }
				
				-		if ($edit)
				-		{
					-			// We must update scoreboard of the assignment
					-			$this->load->model('scoreboard_model');
					-			$this->scoreboard_model->update_scoreboard($id);
					-		}
				+        // Complete Database Transaction
				+        $this->db->trans_complete();
				
				-		// Complete Database Transaction
				-		$this->db->trans_complete();
				+        return $this->db->trans_status();
				+    }
			
			-		return $this->db->trans_status();
			-	}
		
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		
		+    /**
		+     * Delete An Assignment
		+     *
		+     * @param $assignment_id
		+     */
		+    public function delete_assignment($assignment_id)
		+    {
			+        $this->db->trans_start();
			
			-	/**
			-	 * Delete An Assignment
			-	 *
			-	 * @param $assignment_id
			-	 */
			-	public function delete_assignment($assignment_id)
			-	{
				-		$this->db->trans_start();
				+        // Phase 1: Delete this assignment and its submissions from database
				+        $this->db->delete('assignments', array('id' => $assignment_id));
				+        $this->db->delete('problems', array('assignment' => $assignment_id));
				+        $this->db->delete('submissions', array('assignment' => $assignment_id));
				
				-		// Phase 1: Delete this assignment and its submissions from database
				-		$this->db->delete('assignments', array('id'=>$assignment_id));
				-		$this->db->delete('problems', array('assignment'=>$assignment_id));
				-		$this->db->delete('submissions', array('assignment'=>$assignment_id));
				+        $this->db->trans_complete();
				
				-		$this->db->trans_complete();
				+        if ($this->db->trans_status()) {
					+            // Phase 2: Delete assignment's folder (all test cases and submitted codes)
					+            $cmd = 'rm -rf '.rtrim($this->settings_model->get_setting('assignments_root'), '/').'/assignment_'.$assignment_id;
					+            shell_exec($cmd);
					+        }
				+    }
			
			-		if ($this->db->trans_status())
			-		{
				-			// Phase 2: Delete assignment's folder (all test cases and submitted codes)
				-			$cmd = 'rm -rf '.rtrim($this->settings_model->get_setting('assignments_root'), '/').'/assignment_'.$assignment_id;
				-			shell_exec($cmd);
				-		}
			-	}
		
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		
		+    /**
		+     * All Assignments
		+     *
		+     * Returns a list of all assignments and their information
		+     *
		+     * @return mixed
		+     */
		+    public function all_assignments()
		+    {
			+        $result = $this->db->order_by('id')->get('assignments')->result_array();
			+        $assignments = array();
			+        foreach ($result as $item) {
				+            $assignments[$item['id']] = $item;
				+        }
			+        return $assignments;
			+    }
		
		-	/**
		-	 * All Assignments
		-	 *
		-	 * Returns a list of all assignments and their information
		-	 *
		-	 * @return mixed
		-	 */
		-	public function all_assignments()
		-	{
			-		$result = $this->db->order_by('id')->get('assignments')->result_array();
			-		$assignments = array();
			-		foreach ($result as $item)
			-		{
				-			$assignments[$item['id']] = $item;
				-		}
			-		return $assignments;
			-	}
		
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		
		+    /**
		+     * New Assignment ID
		+     *
		+     * Finds the smallest integer that can be uses as id for a new assignment
		+     *
		+     * @return int
		+     */
		+    public function new_assignment_id()
		+    {
			+        $max = ($this->db->select_max('id', 'max_id')->get('assignments')->row()->max_id) + 1;
			
			-	/**
			-	 * New Assignment ID
			-	 *
			-	 * Finds the smallest integer that can be uses as id for a new assignment
			-	 *
			-	 * @return int
			-	 */
			-	public function new_assignment_id()
			-	{
				-		$max = ($this->db->select_max('id', 'max_id')->get('assignments')->row()->max_id) + 1;
				+        $assignments_root = rtrim($this->settings_model->get_setting('assignments_root'), '/');
				+        while (file_exists($assignments_root.'/assignment_'.$max)) {
					+            $max++;
					+        }
				
				-		$assignments_root = rtrim($this->settings_model->get_setting('assignments_root'), '/');
				-		while (file_exists($assignments_root.'/assignment_'.$max)){
					-			$max++;
					-		}
				+        return $max;
				+    }
			
			-		return $max;
			-	}
		
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		
		+    /**
		+     * All Problems of an Assignment
		+     *
		+     * Returns an array containing all problems of given assignment
		+     *
		+     * @param $assignment_id
		+     * @return mixed
		+     */
		+    public function all_problems($assignment_id)
		+    {
			+        $result = $this->db->order_by('id')->get_where('problems', array('assignment' => $assignment_id))->result_array();
			+        $problems = array();
			+        foreach ($result as $row) {
				+            $problems[$row['id']] = $row;
				+        }
			+        return $problems;
			+    }
		
		-	/**
		-	 * All Problems of an Assignment
		-	 *
		-	 * Returns an array containing all problems of given assignment
		-	 *
		-	 * @param $assignment_id
		-	 * @return mixed
		-	 */
		-	public function all_problems($assignment_id)
		-	{
			-		$result = $this->db->order_by('id')->get_where('problems', array('assignment'=>$assignment_id))->result_array();
			-		$problems = array();
			-		foreach ($result as $row)
			-			$problems[$row['id']] = $row;
			-		return $problems;
			-	}
		
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		
		+    /**
		+     * Problem Info
		+     *
		+     * Returns database row for given problem (from given assignment)
		+     *
		+     * @param $assignment_id
		+     * @param $problem_id
		+     * @return mixed
		+     */
		+    public function problem_info($assignment_id, $problem_id)
		+    {
			+        return $this->db->get_where('problems', array('assignment' => $assignment_id, 'id' => $problem_id))->row_array();
			+    }
		
		-	/**
		-	 * Problem Info
		-	 *
		-	 * Returns database row for given problem (from given assignment)
		-	 *
		-	 * @param $assignment_id
		-	 * @param $problem_id
		-	 * @return mixed
		-	 */
		-	public function problem_info($assignment_id, $problem_id)
		-	{
			-		return $this->db->get_where('problems', array('assignment'=>$assignment_id, 'id'=>$problem_id))->row_array();
			-	}
		
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		
		+    /**
		+     * Assignment Info
		+     *
		+     * Returns database row for given assignment
		+     *
		+     * @param $assignment_id
		+     * @return array
		+     */
		+    public function assignment_info($assignment_id)
		+    {
			+        $query = $this->db->get_where('assignments', array('id' => $assignment_id));
			+        if ($query->num_rows() != 1) {
				+            return array(
				+                'id' => 0,
				+                'name' => 'Not Selected',
				+                'finish_time' => 0,
				+                'extra_time' => 0,
				+                'problems' => 0
				+            );
				+        }
			+        return $query->row_array();
			+    }
		
		-	/**
		-	 * Assignment Info
		-	 *
		-	 * Returns database row for given assignment
		-	 *
		-	 * @param $assignment_id
		-	 * @return array
		-	 */
		-	public function assignment_info($assignment_id)
		-	{
			-		$query = $this->db->get_where('assignments', array('id'=>$assignment_id));
			-		if ($query->num_rows() != 1)
			-			return array(
			-				'id' => 0,
			-				'name' => 'Not Selected',
			-				'finish_time' => 0,
			-				'extra_time' => 0,
			-				'problems' => 0
			-			);
			-		return $query->row_array();
			-	}
		
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		
		+    /**
		+     * Is Participant
		+     *
		+     * Returns TRUE if $username if one of the $participants
		+     * Examples for participants: "ALL" or "user1, user2,user3"
		+     *
		+     * @param $participants
		+     * @param $username
		+     * @return bool
		+     */
		+    public function is_participant($participants, $username)
		+    {
			+        $participants = explode(',', $participants);
			+        foreach ($participants as &$participant) {
				+            $participant = trim($participant);
				+        }
			+        if(in_array('ALL', $participants)) {
				+            return true;
				+        }
			+        if(in_array($username, $participants)) {
				+            return true;
				+        }
			+        return false;
			+    }
		
		-	/**
		-	 * Is Participant
		-	 *
		-	 * Returns TRUE if $username if one of the $participants
		-	 * Examples for participants: "ALL" or "user1, user2,user3"
		-	 *
		-	 * @param $participants
		-	 * @param $username
		-	 * @return bool
		-	 */
		-	public function is_participant($participants, $username)
		-	{
			-		$participants = explode(',', $participants);
			-		foreach ($participants as &$participant){
				-			$participant = trim($participant);
				-		}
			-		if(in_array('ALL', $participants))
			-			return TRUE;
			-		if(in_array($username, $participants))
			-			return TRUE;
			-		return FALSE;
			-	}
		
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		
		+    /**
		+     * Increase Total Submits
		+     *
		+     * Increases number of total submits for given assignment by one
		+     *
		+     * @param $assignment_id
		+     * @return mixed
		+     */
		+    public function increase_total_submits($assignment_id)
		+    {
			+        // Get total submits
			+        $total = $this->db->select('total_submits')->get_where('assignments', array('id' => $assignment_id))->row()->total_submits;
			+        // Save total+1 in DB
			+        $this->db->where('id', $assignment_id)->update('assignments', array('total_submits' => ($total + 1)));
			
			-	/**
			-	 * Increase Total Submits
			-	 *
			-	 * Increases number of total submits for given assignment by one
			-	 *
			-	 * @param $assignment_id
			-	 * @return mixed
			-	 */
			-	public function increase_total_submits($assignment_id)
			-	{
				-		// Get total submits
				-		$total = $this->db->select('total_submits')->get_where('assignments', array('id'=>$assignment_id))->row()->total_submits;
				-		// Save total+1 in DB
				-		$this->db->where('id', $assignment_id)->update('assignments', array('total_submits'=>($total+1)));
				+        // Return new total
				+        return ($total + 1);
				+    }
			
			-		// Return new total
			-		return ($total+1);
			-	}
		
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		
		+    /**
		+     * Set Moss Time
		+     *
		+     * Updates "Moss Update Time" for given assignment
		+     *
		+     * @param $assignment_id
		+     */
		+    public function set_moss_time($assignment_id)
		+    {
			+        $now = shj_now_str();
			+        $this->db->where('id', $assignment_id)->update('assignments', array('moss_update' => $now));
			+    }
		
		-	/**
		-	 * Set Moss Time
		-	 *
		-	 * Updates "Moss Update Time" for given assignment
		-	 *
		-	 * @param $assignment_id
		-	 */
		-	public function set_moss_time($assignment_id)
		-	{
			-		$now = shj_now_str();
			-		$this->db->where('id', $assignment_id)->update('assignments', array('moss_update'=>$now));
			-	}
		
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		
		+    /**
		+     * Get Moss Time
		+     *
		+     * Returns "Moss Update Time" for given assignment
		+     *
		+     * @param $assignment_id
		+     * @return string
		+     */
		+    public function get_moss_time($assignment_id)
		+    {
			+        $query = $this->db->select('moss_update')->get_where('assignments', array('id' => $assignment_id));
			+        if($query->num_rows() != 1) {
				+            return 'Never';
				+        }
			+        return $query->row()->moss_update;
			+    }
		
		-	/**
		-	 * Get Moss Time
		-	 *
		-	 * Returns "Moss Update Time" for given assignment
		-	 *
		-	 * @param $assignment_id
		-	 * @return string
		-	 */
		-	public function get_moss_time($assignment_id)
		-	{
			-		$query = $this->db->select('moss_update')->get_where('assignments', array('id'=>$assignment_id));
			-		if($query->num_rows() != 1) return 'Never';
			-		return $query->row()->moss_update;
			-	}
		
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Save Problem Description
		+     *
		+     * Saves (Adds/Updates) problem description (html or markdown)
		+     *
		+     * @param $assignment_id
		+     * @param $problem_id
		+     * @param $text
		+     * @param $type
		+     */
		+    public function save_problem_description($assignment_id, $problem_id, $text, $type)
		+    {
			+        $assignments_root = rtrim($this->settings_model->get_setting('assignments_root'), '/');
			
			-	/**
			-	 * Save Problem Description
			-	 *
			-	 * Saves (Adds/Updates) problem description (html or markdown)
			-	 *
			-	 * @param $assignment_id
			-	 * @param $problem_id
			-	 * @param $text
			-	 * @param $type
			-	 */
			-	public function save_problem_description($assignment_id, $problem_id, $text, $type)
			-	{
				-		$assignments_root = rtrim($this->settings_model->get_setting('assignments_root'), '/');
				+        if ($type === 'html') {
					+            // Remove the markdown code
					+            unlink("$assignments_root/assignment_{$assignment_id}/p{$problem_id}/desc.md");
					+            // Save the html code
					+            file_put_contents("$assignments_root/assignment_{$assignment_id}/p{$problem_id}/desc.html", $text);
					+        } elseif ($type === 'md') {
					+            // We parse markdown using Parsedown library
					+            $this->load->library('parsedown');
					+            // Save the markdown code
					+            file_put_contents("$assignments_root/assignment_{$assignment_id}/p{$problem_id}/desc.md", $text);
					+            // Convert markdown to html and save the html
					+            file_put_contents("$assignments_root/assignment_{$assignment_id}/p{$problem_id}/desc.html", $this->parsedown->parse($text));
					+        }
				
				-		if ($type === 'html')
				-		{
					-			// Remove the markdown code
					-			unlink("$assignments_root/assignment_{$assignment_id}/p{$problem_id}/desc.md");
					-			// Save the html code
					-			file_put_contents("$assignments_root/assignment_{$assignment_id}/p{$problem_id}/desc.html", $text);
					-		}
				-		elseif ($type === 'md')
				-		{
					-			// We parse markdown using Parsedown library
					-			$this->load->library('parsedown');
					-			// Save the markdown code
					-			file_put_contents("$assignments_root/assignment_{$assignment_id}/p{$problem_id}/desc.md", $text);
					-			// Convert markdown to html and save the html
					-			file_put_contents("$assignments_root/assignment_{$assignment_id}/p{$problem_id}/desc.html", $this->parsedown->parse($text));
					-		}
				+    }
			
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		
		+    /**
		+     * Update Coefficients
		+     *
		+     * Each time we edit an assignment (Update start time, finish time, extra time, or
		+     * coefficients rule), we should update coefficients of all submissions of that assignment
		+     *
		+     * This function is called from add_assignment($id, TRUE)
		+     *
		+     * @param $assignment_id
		+     * @param $extra_time
		+     * @param $finish_time
		+     * @param $new_late_rule
		+     */
		+    private function _update_coefficients($assignment_id, $extra_time, $finish_time, $new_late_rule)
		+    {
			+        $submissions = $this->db->get_where('submissions', array('assignment' => $assignment_id))->result_array();
			
			-	/**
			-	 * Update Coefficients
			-	 *
			-	 * Each time we edit an assignment (Update start time, finish time, extra time, or
			-	 * coefficients rule), we should update coefficients of all submissions of that assignment
			-	 *
			-	 * This function is called from add_assignment($id, TRUE)
			-	 *
			-	 * @param $assignment_id
			-	 * @param $extra_time
			-	 * @param $finish_time
			-	 * @param $new_late_rule
			-	 */
			-	private function _update_coefficients($assignment_id, $extra_time, $finish_time, $new_late_rule)
			-	{
				-		$submissions = $this->db->get_where('submissions', array('assignment'=>$assignment_id))->result_array();
				+        $finish_time = strtotime($finish_time);
				
				-		$finish_time = strtotime($finish_time);
				+        foreach ($submissions as $i => $item) {
					+            $delay = strtotime($item['time']) - $finish_time;
					+            ob_start();
					+            if (eval($new_late_rule) === false) {
						+                $coefficient = "error";
						+            }
					+            if (!isset($coefficient)) {
						+                $coefficient = "error";
						+            }
					+            ob_end_clean();
					+            $submissions[$i]['coefficient'] = $coefficient;
					+        }
				+        // For better performance, we update each 1000 rows in one SQL query
				+        $size = count($submissions);
				+        for ($i = 0; $i <= ($size - 1) / 1000; $i++) {
					+            if ($this->db->dbdriver === 'postgre') {
						+                $query = 'UPDATE '.$this->db->dbprefix('submissions')." AS t SET coefficient = c.coeff FROM (values \n";
						+            } else {
						+                $query = 'UPDATE '.$this->db->dbprefix('submissions')." SET coefficient = CASE\n";
						+            }
					
					-		foreach ($submissions as $i => $item) {
						-			$delay = strtotime($item['time'])-$finish_time;
						-			ob_start();
						-			if ( eval($new_late_rule) === FALSE )
						-				$coefficient = "error";
						-			if (!isset($coefficient))
						-				$coefficient = "error";
						-			ob_end_clean();
						-			$submissions[$i]['coefficient'] = $coefficient;
						-		}
					-		// For better performance, we update each 1000 rows in one SQL query
					-		$size = count($submissions);
					-		for ($i=0; $i<=($size-1)/1000; $i++) {
						-			if ($this->db->dbdriver === 'postgre')
						-				$query = 'UPDATE '.$this->db->dbprefix('submissions')." AS t SET coefficient = c.coeff FROM (values \n";
						-			else
						-				$query = 'UPDATE '.$this->db->dbprefix('submissions')." SET coefficient = CASE\n";
						+            for ($j = 1000 * $i; $j < 1000 * ($i + 1) && $j < $size; $j++) {
							+                $item = $submissions[$j];
							+                if ($this->db->dbdriver === 'postgre') {
								+                    $query .= "($assignment_id, {$item['problem']}, '{$item['username']}', {$item['submit_id']}, '{$item['coefficient']}')";
								+                    if ($j + 1 < 1000 * ($i + 1) && $j + 1 < $size) {
									+                        $query .= ",\n";
									+                    }
								+                } else {
								+                    $query .= "WHEN assignment='$assignment_id' AND problem='{$item['problem']}' AND username='{$item['username']}' AND submit_id='{$item['submit_id']}' THEN {$item['coefficient']}\n";
								+                }
							+            }
						
						-			for ($j=1000*$i; $j<1000*($i+1) && $j<$size; $j++){
							-				$item = $submissions[$j];
							-				if ($this->db->dbdriver === 'postgre'){
								-					$query.="($assignment_id, {$item['problem']}, '{$item['username']}', {$item['submit_id']}, '{$item['coefficient']}')";
								-					if ($j+1<1000*($i+1) && $j+1<$size )
								-						$query.=",\n";
								-				}
							-				else
							-					$query.="WHEN assignment='$assignment_id' AND problem='{$item['problem']}' AND username='{$item['username']}' AND submit_id='{$item['submit_id']}' THEN {$item['coefficient']}\n";
							-			}
						-
						-			if ($this->db->dbdriver === 'postgre')
						-				$query.=") AS c(assignment, problem, username, submit_id, coeff)\n"
						-				."WHERE t.assignment=c.assignment AND t.problem=c.problem AND t.username=c.username AND t.submit_id=c.submit_id;";
						-			else
						-				$query.="ELSE coefficient \n END \n WHERE assignment='$assignment_id';";
						-			$this->db->query($query);
						-		}
					-	}
				+            if ($this->db->dbdriver === 'postgre') {
					+                $query .= ") AS c(assignment, problem, username, submit_id, coeff)\n"
					+                ."WHERE t.assignment=c.assignment AND t.problem=c.problem AND t.username=c.username AND t.submit_id=c.submit_id;";
					+            } else {
					+                $query .= "ELSE coefficient \n END \n WHERE assignment='$assignment_id';";
					+            }
				+            $this->db->query($query);
				+        }
			+    }
		
		
	}
	
	----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Hof\_model.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/models/Hof_model.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/models/Hof_model.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/models/Hof_model.php
	@@ -4,58 +4,57 @@
	* @file Hof_model.php
	* @author Stillmen Vallian <stillmen.v@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Hof_model extends CI_Model
	{
		+    public function __construct()
		+    {
			+        parent::__construct();
			+    }
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		-
		-	/**
		-	 * Get data for Hall of Fame
		-	 *
		-	 *
		-	 * @return mixed
		-	 */
		-	public function get_all_final_submission()
		-	{
			-		$this->load->model('user_model');
			-		//include upload only file: remove " AND file_type!='txt' AND file_type!='pdf' AND file_type!='zip' ";
			-    $datas = $this->db->query("SELECT username, CEILING(SUM(pre_score * coefficient / 10000))  AS totalscore FROM shj_submissions WHERE is_final=1 AND file_type!='txt' AND file_type!='pdf' AND file_type!='zip' GROUP BY username ORDER BY totalscore DESC")->result_array();
			-		foreach ($datas as $key => $data) {
				-			$user_id = $this->user_model->username_to_user_id($data['username']);
				-			$datas[$key]['display_name'] = $this->user_model->get_user($user_id)->display_name;
				+    /**
				+     * Get data for Hall of Fame
				+     *
				+     *
				+     * @return mixed
				+     */
				+    public function get_all_final_submission()
				+    {
					+        $this->load->model('user_model');
					+        //include upload only file: remove " AND file_type!='txt' AND file_type!='pdf' AND file_type!='zip' ";
					+        $datas = $this->db->query("SELECT username, CEILING(SUM(pre_score * coefficient / 10000))  AS totalscore FROM shj_submissions WHERE is_final=1 AND file_type!='txt' AND file_type!='pdf' AND file_type!='zip' GROUP BY username ORDER BY totalscore DESC")->result_array();
					+        foreach ($datas as $key => $data) {
						+            $user_id = $this->user_model->username_to_user_id($data['username']);
						+            $datas[$key]['display_name'] = $this->user_model->get_user($user_id)->display_name;
						+        }
					+        return $datas;
				}
				-		return $datas;
				-	}
			
			
			-	// ------------------------------------------------------------------------
			+    // ------------------------------------------------------------------------
			
			-	/**
			-	 * Get details assignments & problems for selected user
			-	 *
			-	 *
			-	 * @return mixed
			-	 */
			-	public function get_all_user_assignments($username)
			-	{
				-		$this->load->model('assignment_model');
				-		$details = $this->db->query("SELECT assignment, problem, CEILING((pre_score * coefficient / 10000)) AS score FROM shj_submissions WHERE is_final=1 AND username='$username' AND file_type!='txt' AND file_type!='pdf' AND file_type!='zip' ORDER BY assignment ASC")->result_array();
				-		foreach ($details as $key => $detail) {
					-			$assignment_id = $detail['assignment'];
					-			$problem_id = $detail['problem'];
					-			$details[$key]['assignment'] = $this->assignment_model->assignment_info($assignment_id)['name'];
					-			$details[$key]['scoreboard'] = $this->assignment_model->assignment_info($assignment_id)['scoreboard'];
					-			$details[$key]['problem'] = $this->assignment_model->problem_info($assignment_id, $problem_id)['name'];
					+    /**
					+     * Get details assignments & problems for selected user
					+     *
					+     *
					+     * @return mixed
					+     */
					+    public function get_all_user_assignments($username)
					+    {
						+        $this->load->model('assignment_model');
						+        $details = $this->db->query("SELECT assignment, problem, CEILING((pre_score * coefficient / 10000)) AS score FROM shj_submissions WHERE is_final=1 AND username='$username' AND file_type!='txt' AND file_type!='pdf' AND file_type!='zip' ORDER BY assignment ASC")->result_array();
						+        foreach ($details as $key => $detail) {
							+            $assignment_id = $detail['assignment'];
							+            $problem_id = $detail['problem'];
							+            $details[$key]['assignment'] = $this->assignment_model->assignment_info($assignment_id)['name'];
							+            $details[$key]['scoreboard'] = $this->assignment_model->assignment_info($assignment_id)['scoreboard'];
							+            $details[$key]['problem'] = $this->assignment_model->problem_info($assignment_id, $problem_id)['name'];
							+        }
						+        return $details;
					}
					-		return $details;
					-	}
			}
			
			----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Logs\_model.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/models/Logs_model.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/models/Logs_model.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/models/Logs_model.php
	@@ -4,76 +4,73 @@
	* @file Logs_model.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Logs_model extends CI_Model
	{
		+    public function __construct()
		+    {
			+        parent::__construct();
			+    }
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Mencatat Logs (Tabel shj_logins)
		+     *
		+     *
		+     *
		+     */
		+    public function insert_to_logs($username, $ip_adrress)
		+    {
			+        $query = $this->db->get('logins')->result_array();
			
			-	/**
			-	 * Mencatat Logs (Tabel shj_logins)
			-	 *
			-	 *
			-	 *
			-	 */
			-	public function insert_to_logs($username, $ip_adrress)
			-	{
				-		$query = $this->db->get('logins')->result_array();
				+        //menghapus timestamp user yang lebih dari 24 jam
				+        foreach ($query as $row) {
					+            $temptime = strtotime('+24 hour', strtotime($row['timestamp']));
					+            if ($temptime < shj_now()) {
						+                # delete
						+                $this->db->where('timestamp', $row['timestamp']);
						+                $this->db->delete('logins');
						+            }
					+        }
				
				-		//menghapus timestamp user yang lebih dari 24 jam
				-		foreach ($query as $row)
				-		{
					-			$temptime=strtotime('+24 hour', strtotime($row['timestamp']));
					-			if ($temptime < shj_now()) {
						-				# delete
						-				$this->db->where('timestamp', $row['timestamp']);
						-				$this->db->delete('logins');
						-			}
					-		}
				+        $result = $this->db->query("SELECT * FROM shj_logins WHERE username='".$username."' AND ip_address!='".$ip_adrress."' ORDER BY timestamp DESC")->row();
				+        if ($result === null) {
					+            $logins = array(
					+                'username' => $username,
					+                'ip_address' => $ip_adrress
					+            );
					+            $this->db->insert('logins', $logins);
					+        } else {
					+            $get_last_login_id = $result -> login_id;
					+            $logins = array(
					+                'username' => $username,
					+                'ip_address' => $ip_adrress,
					+                'last_24h_login_id' => $get_last_login_id
					+            );
					+            $this->db->insert('logins', $logins);
					+        }
				+    }
			
			-		$result = $this->db->query("SELECT * FROM shj_logins WHERE username='".$username."' AND ip_address!='".$ip_adrress."' ORDER BY timestamp DESC")->row();
			-		if ($result === NULL) {
				-			$logins = array(
				-				'username' => $username,
				-				'ip_address' => $ip_adrress
				-			);
				-			$this->db->insert('logins', $logins);
				-		}
			-		else {
				-			$get_last_login_id = $result -> login_id;
				-			$logins = array(
				-				'username' => $username,
				-				'ip_address' => $ip_adrress,
				-				'last_24h_login_id' => $get_last_login_id
				-			);
				-			$this->db->insert('logins', $logins);
				-		}
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-  // ------------------------------------------------------------------------
		
		+    /**
		+     * Get All Logs
		+     *
		+     * Returns an array of all logs
		+     *
		+     * @return mixed
		+     */
		+    public function get_all_logs()
		+    {
			+        return $this->db->order_by('login_id', 'desc')->get('logins')->result_array();
			+    }
		
		-	/**
		-	 * Get All Logs
		-	 *
		-	 * Returns an array of all logs
		-	 *
		-	 * @return mixed
		-	 */
		-	public function get_all_logs()
		-	{
			-		return $this->db->order_by('login_id', 'desc')->get('logins')->result_array();
			-	}
		
		-
		-	// ------------------------------------------------------------------------
		+    // ------------------------------------------------------------------------
	}
	
	----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Notifications\_model.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/models/Notifications_model.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/models/Notifications_model.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/models/Notifications_model.php
	@@ -4,136 +4,138 @@
	* @file Notifications_model.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Notifications_model extends CI_Model
	{
		+    public function __construct()
		+    {
			+        parent::__construct();
			+    }
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Returns all notifications
		+     */
		+    public function get_all_notifications()
		+    {
			+        return $this->db
			+            ->order_by('id', 'desc')
			+            ->get('notifications')
			+            ->result_array();
			+    }
		
		-	/**
		-	 * Returns all notifications
		-	 */
		-	public function get_all_notifications()
		-	{
			-		return $this->db
			-			->order_by('id', 'desc')
			-			->get('notifications')
			-			->result_array();
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Returns 10 latest notifications
		+     */
		+    public function get_latest_notifications()
		+    {
			+        $result = $this->db
			+            ->limit(10)
			+            ->order_by('id', 'desc')
			+            ->get('notifications')
			+            ->result_array();
			+        foreach($result as &$item) {
				+            $item['text'] = substr(trim(strip_tags($item['text'])), 0, 300);
				+            $item['text'] = str_replace('&zwnj;', "\xE2\x80\x8c", $item['text']);
				+            $item['text'] = html_entity_decode($item['text']);
				+            $item['text'] = preg_replace('/\r?\n|\n?\r/', ' ', $item['text']);
				+        }
			+        return $result;
			+    }
		
		-	/**
		-	 * Returns 10 latest notifications
		-	 */
		-	public function get_latest_notifications()
		-	{
			-		$result = $this->db
			-			->limit(10)
			-			->order_by('id', 'desc')
			-			->get('notifications')
			-			->result_array();
			-		foreach($result as &$item)
			-		{
				-			$item['text'] = substr(trim(strip_tags($item['text'])), 0, 300);
				-			$item['text'] = str_replace('&zwnj;', "\xE2\x80\x8c", $item['text']);
				-			$item['text'] = html_entity_decode($item['text']);
				-			$item['text'] = preg_replace('/\r?\n|\n?\r/', ' ', $item['text']);
				-		}
			-		return $result;
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Add a new notification
		+     */
		+    public function add_notification($title, $text)
		+    {
			+        $now = shj_now_str();
			+        $this->db->insert(
			+            'notifications',
			+            array(
			+                'title' => $title,
			+                'text' => $text,
			+                'time' => $now
			+            )
			+        );
			+    }
		
		-	/**
		-	 * Add a new notification
		-	 */
		-	public function add_notification($title, $text)
		-	{
			-		$now = shj_now_str();
			-		$this->db->insert('notifications',
			-			array(
			-				'title' => $title,
			-				'text' => $text,
			-				'time' => $now
			-			)
			-		);
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Update (edit) a notification
		+     */
		+    public function update_notification($id, $title, $text)
		+    {
			+        $this->db
			+            ->where('id', $id)
			+            ->update(
			+                'notifications',
			+                array(
			+                    'title' => $title,
			+                    'text' => $text
			+                )
			+            );
			+    }
		
		-	/**
		-	 * Update (edit) a notification
		-	 */
		-	public function update_notification($id, $title, $text)
		-	{
			-		$this->db
			-			->where('id', $id)
			-			->update('notifications',
			-				array(
			-					'title' => $title,
			-					'text' => $text
			-				)
			-			);
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		-
		-	/**
		+    /**
		* Delete a notification
		-	 */
		-	public function delete_notification($id)
		-	{
			-		$this->db->delete('notifications', array('id' => $id));
			-	}
		+     */
		+    public function delete_notification($id)
		+    {
			+        $this->db->delete('notifications', array('id' => $id));
			+    }
		
		
		-	// ------------------------------------------------------------------------
		+    // ------------------------------------------------------------------------
		
		
		-	/**
		-	 * Returns a notification
		-	 */
		-	public function get_notification($notif_id)
		-	{
			-		$query = $this->db->get_where('notifications', array('id' => $notif_id));
			-		if ($query->num_rows() != 1)
			-			return FALSE;
			-		return $query->row_array();
			-	}
		+    /**
		+     * Returns a notification
		+     */
		+    public function get_notification($notif_id)
		+    {
			+        $query = $this->db->get_where('notifications', array('id' => $notif_id));
			+        if ($query->num_rows() != 1) {
				+            return false;
				+        }
			+        return $query->row_array();
			+    }
		
		
		-	// ------------------------------------------------------------------------
		+    // ------------------------------------------------------------------------
		
		
		-	/**
		-	 * Returns true if there is a notification after $time
		-	 * @todo optimize: check the ">" condition in sql query
		-	 */
		-	public function have_new_notification($time)
		-	{
			-		$notifs = $this->db->select('time')->get('notifications')->result_array();
			-		foreach ($notifs as $notif) {
				-			if (strtotime($notif['time']) > $time)
				-				return TRUE;
				-		}
			-		return FALSE;
			-	}
		+    /**
		+     * Returns true if there is a notification after $time
		+     * @todo optimize: check the ">" condition in sql query
		+     */
		+    public function have_new_notification($time)
		+    {
			+        $notifs = $this->db->select('time')->get('notifications')->result_array();
			+        foreach ($notifs as $notif) {
				+            if (strtotime($notif['time']) > $time) {
					+                return true;
					+            }
				+        }
			+        return false;
			+    }
		
		-}
	\ No newline at end of file
	+}

----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Queue\_model.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/models/Queue_model.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/models/Queue_model.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/models/Queue_model.php
	@@ -4,268 +4,268 @@
	* @file Queue_model.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Queue_model extends CI_Model
	{
		+    public function __construct()
		+    {
			+        parent::__construct();
			+    }
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Returns TRUE if one submission with $username, $assignment and $problem
		+     * is already in queue (for preventing multiple submission)
		+     */
		+    public function in_queue($username, $assignment, $problem)
		+    {
			+        $query = $this->db->get_where('queue', array('username' => $username, 'assignment' => $assignment, 'problem' => $problem));
			+        return ($query->num_rows() > 0);
			+    }
		
		-	/**
		-	 * Returns TRUE if one submission with $username, $assignment and $problem
		-	 * is already in queue (for preventing multiple submission)
		-	 */
		-	public function in_queue ($username, $assignment, $problem)
		-	{
			-		$query = $this->db->get_where('queue', array('username'=>$username, 'assignment'=>$assignment, 'problem'=>$problem));
			-		return ($query->num_rows() > 0);
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Returns all the submission queue
		+     */
		+    public function get_queue()
		+    {
			+        return $this->db->get('queue')->result_array();
			+    }
		
		-	/**
		-	 * Returns all the submission queue
		-	 */
		-	public function get_queue ()
		-	{
			-		return $this->db->get('queue')->result_array();
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Empties the queue
		+     */
		+    public function empty_queue()
		+    {
			+        return $this->db->empty_table('queue');
			
			-	/**
			-	 * Empties the queue
			-	 */
			-	public function empty_queue ()
			-	{
				-		return $this->db->empty_table('queue');
				+        //Delete all dummy submission
				+        $this->db->delete('submissions', array(
				+            'submit_id' => 0,
				+        ));
				+    }
			
			-		//Delete all dummy submission
			-		$this->db->delete('submissions', array(
			-			'submit_id' => 0,
			-		));
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    public function add_to_queue($submit_info)
		+    {
			
			-	public function add_to_queue($submit_info)
			-	{
				+        $submit_info['is_final'] = 0;
				+        $submit_info['status'] = 'PENDING';
				
				-		$submit_info['is_final'] = 0;
				-		$submit_info['status'] = 'PENDING';
				+        $this->db->insert('submissions', $submit_info);
				
				-		$this->db->insert('submissions', $submit_info);
				+        $this->db->insert('queue', array(
				+            'submit_id' => $submit_info['submit_id'],
				+            'username' => $submit_info['username'],
				+            'assignment' => $submit_info['assignment'],
				+            'problem' => $submit_info['problem'],
				+            'type' => 'judge'
				+        ));
				+    }
			
			-		$this->db->insert('queue', array(
			-			'submit_id' => $submit_info['submit_id'],
			-			'username' => $submit_info['username'],
			-			'assignment' => $submit_info['assignment'],
			-			'problem' => $submit_info['problem'],
			-			'type' => 'judge'
			-		));
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Adds submissions of a problem to queue for rejudge
		+     */
		+    public function rejudge($assignment_id, $problem_id)
		+    {
			+        $problem = $this->assignment_model->problem_info($assignment_id, $problem_id);
			+        if ($problem['is_upload_only']) {
				+            return;
				+        }
			
			-	/**
			-	 * Adds submissions of a problem to queue for rejudge
			-	 */
			-	public function rejudge($assignment_id, $problem_id)
			-	{
				-		$problem = $this->assignment_model->problem_info($assignment_id, $problem_id);
				-		if ($problem['is_upload_only'])
				-			return;
				+        // Changing the status of all submissions of selected problem to PENDING
				
				-		// Changing the status of all submissions of selected problem to PENDING
				+        $this->db->where(
				+            array(
				+                'assignment' => $assignment_id,
				+                'problem' => $problem_id
				+            )
				+        )->update('submissions', array('pre_score' => 0, 'status' => 'PENDING'));
				
				-		$this->db->where(
				-			array(
				-				'assignment' => $assignment_id,
				-				'problem' => $problem_id
				-			)
				-		)->update('submissions', array('pre_score' => 0, 'status' => 'PENDING'));
				+        // Adding submissions to queue:
				
				-		// Adding submissions to queue:
				+        $submissions = $this->db
				+            ->select('submit_id, username, assignment, problem')
				+            ->order_by('submit_id')
				+            ->get_where('submissions', array('assignment' => $assignment_id, 'problem' => $problem_id))
				+            ->result_array();
				
				-		$submissions = $this->db
				-			->select('submit_id, username, assignment, problem')
				-			->order_by('submit_id')
				-			->get_where('submissions', array('assignment'=>$assignment_id, 'problem'=>$problem_id))
				-			->result_array();
				+        foreach($submissions as $submission) {
					+            $this->db->insert(
					+                'queue',
					+                array(
					+                    'submit_id' => $submission['submit_id'],
					+                    'username' => $submission['username'],
					+                    'assignment' => $submission['assignment'],
					+                    'problem' => $submission['problem'],
					+                    'type' => 'rejudge'
					+                )
					+            );
					+        }
				+        // Now ready for rejudge
				+    }
			
			-		foreach($submissions as $submission)
			-		{
				-			$this->db->insert('queue',
				-				array(
				-					'submit_id' => $submission['submit_id'],
				-					'username' => $submission['username'],
				-					'assignment' => $submission['assignment'],
				-					'problem' => $submission['problem'],
				-					'type' => 'rejudge'
				-				)
				-			);
				-		}
			-		// Now ready for rejudge
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Adds a single submission to queue for rejudge
		+     */
		+    public function rejudge_single($submission)
		+    {
			+        $problem = $this->assignment_model->problem_info($submission['assignment'], $submission['problem']);
			+        if ($problem['is_upload_only']) {
				+            return;
				+        }
			
			-	/**
			-	 * Adds a single submission to queue for rejudge
			-	 */
			-	public function rejudge_single($submission)
			-	{
				-		$problem = $this->assignment_model->problem_info($submission['assignment'], $submission['problem']);
				-			if ($problem['is_upload_only'])
				-			return;
				+        // Changing the status of submission to PENDING
				+        $this->db->where(array(
				+            'submit_id' => $submission['submit_id'],
				+            'username' => $submission['username'],
				+            'assignment' => $submission['assignment'],
				+            'problem' => $submission['problem']
				+        ))->update('submissions', array('pre_score' => 0, 'status' => 'PENDING'));
				
				-		// Changing the status of submission to PENDING
				-		$this->db->where(array(
				-			'submit_id' => $submission['submit_id'],
				-			'username' => $submission['username'],
				-			'assignment' => $submission['assignment'],
				-			'problem' => $submission['problem']
				-		))->update('submissions', array('pre_score'=>0, 'status'=>'PENDING'));
				+        // Adding Submission to Queue
				+        $this->db->insert('queue', array(
				+            'submit_id' => $submission['submit_id'],
				+            'username' => $submission['username'],
				+            'assignment' => $submission['assignment'],
				+            'problem' => $submission['problem'],
				+            'type' => 'rejudge'
				+        ));
				+        // Now ready for rejudge
				+    }
			
			-		// Adding Submission to Queue
			-		$this->db->insert('queue', array(
			-			'submit_id' => $submission['submit_id'],
			-			'username' => $submission['username'],
			-			'assignment' => $submission['assignment'],
			-			'problem' => $submission['problem'],
			-			'type' => 'rejudge'
			-		));
			-		// Now ready for rejudge
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Returns the first item of the queue
		+     */
		+    public function get_first_item()
		+    {
			+        $query = $this->db->order_by('id')->limit(1)->get('queue');
			+        if ($query->num_rows() != 1) {
				+            return null;
				+        }
			+        return $query->row_array();
			+    }
		
		-	/**
		-	 * Returns the first item of the queue
		-	 */
		-	public function get_first_item()
		-	{
			-		$query = $this->db->order_by('id')->limit(1)->get('queue');
			-		if ($query->num_rows() != 1)
			-			return NULL;
			-		return $query->row_array();
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Removes an item from the queue
		+     */
		+    public function remove_item($username, $assignment, $problem, $submit_id)
		+    {
			+        $this->db->delete('queue', array(
			+            'submit_id' => $submit_id,
			+            'username' => $username,
			+            'assignment' => $assignment,
			+            'problem' => $problem
			+        ));
			
			-	/**
			-	 * Removes an item from the queue
			-	 */
			-	public function remove_item($username, $assignment, $problem, $submit_id)
			-	{
				-		$this->db->delete('queue', array(
				-			'submit_id' => $submit_id,
				-			'username' => $username,
				-			'assignment' => $assignment,
				-			'problem' => $problem
				-		));
				+        //Delete dummy submission if exec only
				+        if($submit_id == 0) {
					+            $this->db->delete('submissions', array(
					+                'submit_id' => $submit_id,
					+                'username' => $username,
					+                'assignment' => $assignment,
					+                'problem' => $problem
					+            ));
					+        }
				+    }
			
			-		//Delete dummy submission if exec only
			-		if($submit_id == 0){
				-			$this->db->delete('submissions', array(
				-				'submit_id' => $submit_id,
				-				'username' => $username,
				-				'assignment' => $assignment,
				-				'problem' => $problem
				-			));
				-		}
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Saves the result of judge in database
		+     * This function is called from Queueprocess controller
		+     */
		+    public function save_judge_result_in_db($submission, $type)
		+    {
			
			-	/**
			-	 * Saves the result of judge in database
			-	 * This function is called from Queueprocess controller
			-	 */
			-	public function save_judge_result_in_db ($submission, $type)
			-	{
				+        $arr = array(
				+            'status' => $submission['status'],
				+            'pre_score' => $submission['pre_score'],
				+        );
				
				-		$arr = array(
				-			'status' => $submission['status'],
				-			'pre_score' => $submission['pre_score'],
				-		);
				+        if ($type === 'judge') {
					+            $this->db->where(array(
					+                'is_final' => 1,
					+                'username' => $submission['username'],
					+                'assignment' => $submission['assignment'],
					+                'problem' => $submission['problem'],
					+            ))->update('submissions', array('is_final' => 0));
					+            $arr['is_final'] = 1;
					+        }
				
				-		if ($type === 'judge')
				-		{
					-			$this->db->where(array(
					-				'is_final' => 1,
					-				'username' => $submission['username'],
					-				'assignment' => $submission['assignment'],
					-				'problem' => $submission['problem'],
					-			))->update('submissions', array('is_final'=>0));
					-			$arr['is_final'] = 1;
					-		}
				+        $this->db->where(array(
				+            'submit_id' => $submission['submit_id'],
				+            'username' => $submission['username'],
				+            'assignment' => $submission['assignment'],
				+            'problem' => $submission['problem']
				+        ))->update('submissions', $arr);
				
				-		$this->db->where(array(
				-			'submit_id' => $submission['submit_id'],
				-			'username' => $submission['username'],
				-			'assignment' => $submission['assignment'],
				-			'problem' => $submission['problem']
				-		))->update('submissions', $arr);
				+        // update scoreboard:
				+        $this->load->model('scoreboard_model');
				+        $this->scoreboard_model->update_scoreboard($submission['assignment']);
				+    }
			
			-		// update scoreboard:
			-		$this->load->model('scoreboard_model');
			-		$this->scoreboard_model->update_scoreboard($submission['assignment']);
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		+    /**
		+     * Adds a dummy submission to queue for execution only
		+     */
		+    public function add_to_queue_exec($submit_info)
		+    {
			+        $query = $this->db->get_where('submissions', array(
			+            'submit_id' => $submit_info['submit_id'],
			+            'username' => $submit_info['username'],
			+            'assignment' => $submit_info['assignment'],
			+            'problem' => $submit_info['problem']
			+        ));
			+        if ($query->num_rows() == 0) {
				+            $submit_info['is_final'] = 0;
				+            $submit_info['status'] = 'PENDING';
				+            $this->db->insert('submissions', $submit_info);
				
				-	/**
				-	 * Adds a dummy submission to queue for execution only
				-	 */
				-	public function add_to_queue_exec($submit_info)
				-	{
					-		$query = $this->db->get_where('submissions', array(
					-			'submit_id' => $submit_info['submit_id'], 
					-			'username' => $submit_info['username'],
					-			'assignment' => $submit_info['assignment'],
					-			'problem' => $submit_info['problem']
					-		));
					-		if ($query->num_rows() == 0){
						-			$submit_info['is_final'] = 0;
						-			$submit_info['status'] = 'PENDING';
						-			$this->db->insert('submissions', $submit_info);
						-
						-			$this->db->insert('queue', array(
						-				'submit_id' => $submit_info['submit_id'],
						-				'username' => $submit_info['username'],
						-				'assignment' => $submit_info['assignment'],
						-				'problem' => $submit_info['problem'],
						-				'type' => 'exec'
						-			));
						-			return TRUE;
						-		}
					-		else{
						-			return FALSE;
						-		}
					-	}
				-}
			\ No newline at end of file
			+            $this->db->insert('queue', array(
			+                'submit_id' => $submit_info['submit_id'],
			+                'username' => $submit_info['username'],
			+                'assignment' => $submit_info['assignment'],
			+                'problem' => $submit_info['problem'],
			+                'type' => 'exec'
			+            ));
			+            return true;
			+        } else {
			+            return false;
			+        }
		+    }
	+}

----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Scoreboard\_model.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/models/Scoreboard_model.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/models/Scoreboard_model.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/models/Scoreboard_model.php
	@@ -4,185 +4,195 @@
	* @file Scoreboard_model.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class Scoreboard_model extends CI_Model
	{
		+    public function __construct()
		+    {
			+        parent::__construct();
			+    }
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-	}
		
		+    /**
		+     * Generate Scoreboard
		+     *
		+     * Generates scoreboard for given assignment, from Final Submissions.
		+     * This function is called by update_scoreboard
		+     *
		+     * @param int $assignment_id
		+     * @return array
		+     */
		+    private function _generate_scoreboard($assignment_id)
		+    {
			+        $assignment = $this->assignment_model->assignment_info($assignment_id);
			+        $submissions = $this->db->get_where('submissions', array('is_final' => 1 , 'assignment' => $assignment_id))->result_array();
			+        $total_score = array();
			+        $penalty = array();
			+        $users = array();
			+        $start = strtotime($assignment['start_time']);
			+        $submit_penalty = $this->settings_model->get_setting('submit_penalty');
			+        $scores = array();
			+        foreach ($submissions as $submission) {
				
				-	/**
				-	 * Generate Scoreboard
				-	 *
				-	 * Generates scoreboard for given assignment, from Final Submissions.
				-	 * This function is called by update_scoreboard
				-	 *
				-	 * @param int $assignment_id
				-	 * @return array
				-	 */
				-	private function _generate_scoreboard($assignment_id)
				-	{
					-		$assignment = $this->assignment_model->assignment_info($assignment_id);
					-		$submissions = $this->db->get_where('submissions', array('is_final' => 1 , 'assignment' => $assignment_id))->result_array();
					-		$total_score = array();
					-		$penalty = array();
					-		$users = array();
					-		$start = strtotime($assignment['start_time']);
					-		$submit_penalty = $this->settings_model->get_setting('submit_penalty');
					-		$scores = array();
					-		foreach ($submissions as $submission){
						+            $pi = $this->assignment_model->problem_info($assignment_id, $submission['problem']);
						
						-			$pi = $this->assignment_model->problem_info($assignment_id, $submission['problem']);
						+            $pre_score = ceil($submission['pre_score'] * $pi['score'] / 10000);
						+            if ($submission['coefficient'] === 'error') {
							+                $final_score = 0;
							+            } else {
							+                $final_score = ceil($pre_score * $submission['coefficient'] / 100);
							+            }
						+            $delay = strtotime($submission['time']) - $start;
						+            $scores[$submission['username']][$submission['problem']]['score'] = $final_score;
						+            $scores[$submission['username']][$submission['problem']]['time'] = $delay;
						
						-			$pre_score = ceil($submission['pre_score']*$pi['score']/10000);
						-			if ($submission['coefficient'] === 'error')
						-				$final_score = 0;
						-			else
						-				$final_score = ceil($pre_score*$submission['coefficient']/100);
						-			$delay = strtotime($submission['time'])-$start;
						-			$scores[$submission['username']][$submission['problem']]['score'] = $final_score;
						-			$scores[$submission['username']][$submission['problem']]['time'] = $delay;
						+            if (! isset($total_score[$submission['username']])) {
							+                $total_score[$submission['username']] = 0;
							+            }
						+            if (! isset($penalty[$submission['username']])) {
							+                $penalty[$submission['username']] = 0;
							+            }
						
						-			if ( ! isset($total_score[$submission['username']]))
						-				$total_score[$submission['username']] = 0;
						-			if ( ! isset($penalty[$submission['username']]))
						-				$penalty[$submission['username']] = 0;
						+            $total_score[$submission['username']] += $final_score;
						
						-			$total_score[$submission['username']] += $final_score;
						+            $number_of_submissions = $this->db->where(array(
						+                'assignment' => $submission['assignment'],
						+                'problem' => $submission['problem'],
						+                'username' => $submission['username'],
						+            ))->count_all_results('submissions');
						
						-			$number_of_submissions = $this->db->where(array(
						-				'assignment' => $submission['assignment'],
						-				'problem' => $submission['problem'],
						-				'username' => $submission['username'],
						-			))->count_all_results('submissions');
						+            $penalty[$submission['username']] += $delay + $number_of_submissions * $submit_penalty;
						+            $users[] = $submission['username'];
						+        }
					+        $scoreboard = array(
					+            'username' => array(),
					+            'score' => array(),
					+            'submit_penalty' => array()
					+        );
					+        $users = array_unique($users);
					+        foreach($users as $username) {
						+            array_push($scoreboard['username'], $username);
						+            array_push($scoreboard['score'], $total_score[$username]);
						+            array_push($scoreboard['submit_penalty'], $penalty[$username]);
						+        }
					+        array_multisort(
					+            $scoreboard['score'],
					+            SORT_NUMERIC,
					+            SORT_DESC,
					+            $scoreboard['submit_penalty'],
					+            SORT_NUMERIC,
					+            SORT_ASC,
					+            $scoreboard['username']
					+        );
					+        return array($scores, $scoreboard);
					+    }
				
				-			$penalty[$submission['username']] += $delay + $number_of_submissions*$submit_penalty;
				-			$users[] = $submission['username'];
				-		}
			-		$scoreboard = array(
			-			'username' => array(),
			-			'score' => array(),
			-			'submit_penalty' => array()
			-		);
			-		$users = array_unique($users);
			-		foreach($users as $username){
				-			array_push($scoreboard['username'], $username);
				-			array_push($scoreboard['score'], $total_score[$username]);
				-			array_push($scoreboard['submit_penalty'], $penalty[$username]);
				-		}
			-		array_multisort(
			-			$scoreboard['score'], SORT_NUMERIC, SORT_DESC,
			-			$scoreboard['submit_penalty'], SORT_NUMERIC, SORT_ASC,
			-			$scoreboard['username']
			-		);
			-		return array($scores, $scoreboard);
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Update All Scoreboards
		+     *
		+     * Updates the cached scoreboard of all assignments.
		+     * This function is called each time a user is deleted, or all submissions
		+     * of a user is deleted.
		+     */
		+    public function update_scoreboards()
		+    {
			+        $assignments = $this->db->select('id')->get('assignments')->result_array();
			+        foreach ($assignments as $assignment) {
				+            $this->update_scoreboard($assignment['id']);
				+        }
			+    }
		
		-	/**
		-	 * Update All Scoreboards
		-	 *
		-	 * Updates the cached scoreboard of all assignments.
		-	 * This function is called each time a user is deleted, or all submissions
		-	 * of a user is deleted.
		-	 */
		-	public function update_scoreboards()
		-	{
			-		$assignments = $this->db->select('id')->get('assignments')->result_array();
			-		foreach ($assignments as $assignment){
				-			$this->update_scoreboard($assignment['id']);
				-		}
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Update Scoreboard
		+     *
		+     * Updates the cached scoreboard of given assignment. Saves the html code of
		+     * scoreboard table in database.
		+     *
		+     * This function is called after judging/rejudging a submission, and when one
		+     * of these settings is changed for an assignment:
		+     *
		+     * TODO: Better Implementation (faster and with less db queries)
		+     *
		+     *   - Extra Time
		+     *   - Start Time
		+     *   - Finish Time
		+     *   - Coefficient's Rule
		+     *   - Enable/Disable Scoreboard
		+     *
		+     * @param int $assignment_id
		+     */
		+    public function update_scoreboard($assignment_id)
		+    {
			
			-	/**
			-	 * Update Scoreboard
			-	 *
			-	 * Updates the cached scoreboard of given assignment. Saves the html code of
			-	 * scoreboard table in database.
			-	 *
			-	 * This function is called after judging/rejudging a submission, and when one
			-	 * of these settings is changed for an assignment:
			-	 *
			-	 * TODO: Better Implementation (faster and with less db queries)
			-	 *
			-	 *   - Extra Time
			-	 *   - Start Time
			-	 *   - Finish Time
			-	 *   - Coefficient's Rule
			-	 *   - Enable/Disable Scoreboard
			-	 *
			-	 * @param int $assignment_id
			-	 */
			-	public function update_scoreboard($assignment_id)
			-	{
				+        // If scoreboard in not enabled, do nothing
				+        $scoreboard_enabled = $this->db->select('scoreboard')->get_where('assignments', array('id' => $assignment_id))->row()->scoreboard;
				+        if ($assignment_id == 0 or  ! $scoreboard_enabled) {
					+            return;
					+        }
				
				-		// If scoreboard in not enabled, do nothing
				-		$scoreboard_enabled = $this->db->select('scoreboard')->get_where('assignments', array('id'=>$assignment_id))->row()->scoreboard;
				-		if ($assignment_id == 0 OR  ! $scoreboard_enabled )
				-			return;
				+        // Generate the scoreboard
				+        list($scores, $scoreboard) = $this->_generate_scoreboard($assignment_id);
				
				-		// Generate the scoreboard
				-		list ($scores, $scoreboard) = $this->_generate_scoreboard($assignment_id);
				+        // Generate the scoreboard's html code
				+        // todo: Save Scoreboard as json (generate html at client side)
				+        $all_problems = $this->assignment_model->all_problems($assignment_id);
				+        $total_score = 0;
				+        foreach($all_problems as $i) {
					+            $total_score += $i['score'];
					+        }
				+        $data = array(
				+            'assignment_id' => $assignment_id,
				+            'problems' => $all_problems,
				+            'total_score' => $total_score,
				+            'scores' => $scores,
				+            'scoreboard' => $scoreboard,
				+            'names' => $this->user_model->get_names(),
				+        );
				
				-		// Generate the scoreboard's html code
				-		// todo: Save Scoreboard as json (generate html at client side)
				-		$all_problems = $this->assignment_model->all_problems($assignment_id);
				-		$total_score = 0;
				-		foreach($all_problems as $i)
				-			$total_score += $i['score'];
				-		$data = array(
				-			'assignment_id' => $assignment_id,
				-			'problems' => $all_problems,
				-			'total_score' => $total_score,
				-			'scores' => $scores,
				-			'scoreboard' => $scoreboard,
				-			'names' => $this->user_model->get_names(),
				-		);
				+        $scoreboard_table = $this->twig->render('pages/scoreboard_table.twig', $data);
				
				-		$scoreboard_table = $this->twig->render('pages/scoreboard_table.twig', $data);
				
				+        // Minify the scoreboard's html code
				+        // $scoreboard_table = $this->output->minify($scoreboard_table, 'text/html');
				
				-		// Minify the scoreboard's html code
				-		// $scoreboard_table = $this->output->minify($scoreboard_table, 'text/html');
				+        // Save the scoreboard's html code in Database
				+        $query = $this->db->select('assignment')->get_where('scoreboard', array('assignment' => $assignment_id));
				+        if ($query->num_rows() == 0) {
					+            $this->db->insert('scoreboard', array('assignment' => $assignment_id, 'scoreboard' => $scoreboard_table));
					+        } else {
					+            $this->db->where('assignment', $assignment_id)->update('scoreboard', array('scoreboard' => $scoreboard_table));
					+        }
				+    }
			
			-		// Save the scoreboard's html code in Database
			-		$query = $this->db->select('assignment')->get_where('scoreboard', array('assignment'=>$assignment_id));
			-		if ($query->num_rows()==0)
			-			$this->db->insert('scoreboard', array('assignment'=>$assignment_id, 'scoreboard'=>$scoreboard_table));
			-		else
			-			$this->db->where('assignment', $assignment_id)->update('scoreboard', array('scoreboard'=>$scoreboard_table));
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Get Cached Scoreboard
		+     *
		+     * Returns the cached scoreboard of given assignment as a html text
		+     *
		+     * @param int $assignment_id
		+     * @return string
		+     */
		+    public function get_scoreboard($assignment_id)
		+    {
			+        $query =  $this->db->select('scoreboard')->get_where('scoreboard', array('assignment' => $assignment_id));
			+        if ($query->num_rows() != 1) {
				+            return 'Scoreboard not found';
				+        } else {
				+            return $query->row()->scoreboard;
				+        }
			+    }
		
		-	/**
		-	 * Get Cached Scoreboard
		-	 *
		-	 * Returns the cached scoreboard of given assignment as a html text
		-	 *
		-	 * @param int $assignment_id
		-	 * @return string
		-	 */
		-	public function get_scoreboard($assignment_id)
		-	{
			-		$query =  $this->db->select('scoreboard')->get_where('scoreboard', array('assignment'=>$assignment_id));
			-		if ($query->num_rows() != 1)
			-			return 'Scoreboard not found';
			-		else
			-			return $query->row()->scoreboard;
			-	}
		-
		-}
	\ No newline at end of file
	+}

----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Settings\_model.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/models/Settings_model.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/models/Settings_model.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/models/Settings_model.php
	@@ -4,7 +4,7 @@
	* @file Settings_model.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	/**
	* This model deals with global settings
	@@ -12,58 +12,54 @@
	
	class Settings_model extends CI_Model
	{
		+    public function __construct()
		+    {
			+        parent::__construct();
			+    }
		
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-	}
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		+    public function get_setting($key)
		+    {
			+        return $this->db->select('shj_value')->get_where('settings', array('shj_key' => $key))->row()->shj_value;
			+    }
		
		
		-	public function get_setting($key)
		-	{
			-		return $this->db->select('shj_value')->get_where('settings', array('shj_key'=>$key))->row()->shj_value;
			-	}
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		+    public function set_setting($key, $value)
		+    {
			+        $this->db->where('shj_key', $key)->update('settings', array('shj_value' => $value));
			+    }
		
		
		-	public function set_setting($key, $value)
		-	{
			-		$this->db->where('shj_key', $key)->update('settings', array('shj_value'=>$value));
			-	}
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		+    public function get_all_settings()
		+    {
			+        $result = $this->db->get('settings')->result_array();
			+        $settings = array();
			+        foreach($result as $item) {
				+            $settings[$item['shj_key']] = $item['shj_value'];
				+        }
			+        return $settings;
			+    }
		
		
		-	public function get_all_settings()
		-	{
			-		$result = $this->db->get('settings')->result_array();
			-		$settings = array();
			-		foreach($result as $item)
			-		{
				-			$settings[$item['shj_key']] = $item['shj_value'];
				-		}
			-		return $settings;
			-	}
		+    // ------------------------------------------------------------------------
		
		
		-	// ------------------------------------------------------------------------
		+    public function set_settings($settings)
		+    {
			+        foreach ($settings as $key => $value) {
				+            $this->set_setting($key, $value);
				+        }
			+    }
		
		
		-	public function set_settings($settings)
		-	{
			-		foreach ($settings as $key => $value)
			-		{
				-			$this->set_setting($key, $value);
				-		}
			-	}
		
		-
		-
		-}
	\ No newline at end of file
	+}

----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode Submit\_model.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/models/Submit_model.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/models/Submit_model.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/models/Submit_model.php
	@@ -4,173 +4,183 @@
	* @file Submit_model.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	-class Submit_model extends CI_Model {
		+class Submit_model extends CI_Model
		+{
			+    public function __construct()
			+    {
				+        parent::__construct();
				+    }
			
			-	public function __construct()
			-	{
				-		parent::__construct();
				-	}
			
			+    // ------------------------------------------------------------------------
			
			-	// ------------------------------------------------------------------------
			
			+    /**
			+     * Returns table row for a specific submission
			+     */
			+    public function get_submission($username, $assignment, $problem, $submit_id)
			+    {
				+        $query = $this->db->get_where(
				+            'submissions',
				+            array(
				+                'username' => $username,
				+                'assignment' => $assignment,
				+                'problem' => $problem,
				+                'submit_id' => $submit_id
				+            )
				+        );
				+        if($query->num_rows() != 1) {
					+            return false;
					+        }
				+        return $query->row_array();
				+    }
			
			-	/**
			-	 * Returns table row for a specific submission
			-	 */
			-	public function get_submission($username, $assignment, $problem, $submit_id)
			-	{
				-		$query = $this->db->get_where('submissions',
				-			array(
				-				'username'=>$username,
				-				'assignment'=>$assignment,
				-				'problem'=>$problem,
				-				'submit_id'=>$submit_id
				-			)
				-		);
				-		if($query->num_rows()!=1)
				-			return FALSE;
				-		return $query->row_array();
				-	}
			
			+    // ------------------------------------------------------------------------
			
			-	// ------------------------------------------------------------------------
			
			+    public function get_final_submissions($assignment_id, $user_level, $username, $page_number = null, $filter_user = null, $filter_problem = null)
			+    {
				+        $arr['assignment'] = $assignment_id;
				+        $arr['submit_id !='] = EDITOR_SUBMIT_ID;
				+        $arr['is_final'] = 1;
				+        if ($user_level === 0) {// students can only get final submissions of themselves
					+            $arr['username'] = $username;
					+        } elseif ($filter_user !== null) {
					+            $arr['username'] = $filter_user;
					+        }
				+        if ($filter_problem !== null) {
					+            $arr['problem'] = $filter_problem;
					+        }
				+        if ($page_number === null) {
					+            return $this->db->order_by('username asc, problem asc')->get_where('submissions', $arr)->result_array();
					+        } else {
					+            $per_page = $this->settings_model->get_setting('results_per_page_final');
					+            if ($per_page == 0) {
						+                return $this->db->order_by('username asc, problem asc')->get_where('submissions', $arr)->result_array();
						+            } else {
						+                return $this->db->order_by('username asc, problem asc')->limit($per_page, ($page_number - 1) * $per_page)->get_where('submissions', $arr)->result_array();
						+            }
					+        }
				
				-	public function get_final_submissions($assignment_id, $user_level, $username, $page_number = NULL, $filter_user = NULL, $filter_problem = NULL)
				-	{
					-		$arr['assignment'] = $assignment_id;
					-		$arr['submit_id !='] = EDITOR_SUBMIT_ID;
					-		$arr['is_final'] = 1;
					-		if ($user_level === 0)// students can only get final submissions of themselves
					-			$arr['username']=$username;
					-		elseif ($filter_user !== NULL)
					-			$arr['username'] = $filter_user;
					-		if ($filter_problem !== NULL)
					-			$arr['problem'] = $filter_problem;
					-		if ($page_number === NULL)
					-			return $this->db->order_by('username asc, problem asc')->get_where('submissions', $arr)->result_array();
					-		else
					-		{
						-			$per_page = $this->settings_model->get_setting('results_per_page_final');
						-			if ($per_page == 0)
						-				return $this->db->order_by('username asc, problem asc')->get_where('submissions', $arr)->result_array();
						-			else
						-				return $this->db->order_by('username asc, problem asc')->limit($per_page,($page_number-1)*$per_page)->get_where('submissions', $arr)->result_array();
						-		}
					+    }
				
				-	}
			
			+    // ------------------------------------------------------------------------
			
			-	// ------------------------------------------------------------------------
			
			+    public function get_all_submissions($assignment_id, $user_level, $username, $page_number = null, $filter_user = null, $filter_problem = null)
			+    {
				+        $arr['assignment'] = $assignment_id;
				+        $arr['submit_id !='] = EDITOR_SUBMIT_ID;
				+        if ($user_level === 0) {
					+            $arr['username'] = $username;
					+        } elseif ($filter_user !== null) {
					+            $arr['username'] = $filter_user;
					+        }
				+        if ($filter_problem !== null) {
					+            $arr['problem'] = $filter_problem;
					+        }
				+        if ($page_number === null) {
					+            return $this->db->order_by('submit_id', 'desc')->get_where('submissions', $arr)->result_array();
					+        } else {
					+            $per_page = $this->settings_model->get_setting('results_per_page_all');
					+            if ($per_page == 0) {
						+                return $this->db->order_by('submit_id', 'desc')->get_where('submissions', $arr)->result_array();
						+            } else {
						+                return $this->db->order_by('submit_id', 'desc')->limit($per_page, ($page_number - 1) * $per_page)->get_where('submissions', $arr)->result_array();
						+            }
					+        }
				+    }
			
			-	public function get_all_submissions($assignment_id, $user_level, $username, $page_number = NULL, $filter_user = NULL, $filter_problem = NULL)
			-	{
				-		$arr['assignment']=$assignment_id;
				-		$arr['submit_id !='] = EDITOR_SUBMIT_ID;
				-		if ($user_level === 0)
				-			$arr['username']=$username;
				-		elseif ($filter_user !== NULL)
				-			$arr['username'] = $filter_user;
				-		if ($filter_problem !== NULL)
				-			$arr['problem'] = $filter_problem;
				-		if ($page_number === NULL)
				-			return $this->db->order_by('submit_id','desc')->get_where('submissions', $arr)->result_array();
				-		else
				-		{
					-			$per_page = $this->settings_model->get_setting('results_per_page_all');
					-			if ($per_page == 0)
					-				return $this->db->order_by('submit_id','desc')->get_where('submissions', $arr)->result_array();
					-			else
					-				return $this->db->order_by('submit_id','desc')->limit($per_page,($page_number-1)*$per_page)->get_where('submissions', $arr)->result_array();
					-		}
				-	}
			
			+    // ------------------------------------------------------------------------
			
			-	// ------------------------------------------------------------------------
			
			+    public function count_final_submissions($assignment_id, $user_level, $username, $filter_user = null, $filter_problem = null)
			+    {
				+        $arr['assignment'] = $assignment_id;
				+        $arr['submit_id !='] = EDITOR_SUBMIT_ID;
				+        $arr['is_final'] = 1;
				+        if ($user_level === 0) {
					+            $arr['username'] = $username;
					+        } elseif ($filter_user !== null) {
					+            $arr['username'] = $filter_user;
					+        }
				+        if ($filter_problem !== null) {
					+            $arr['problem'] = $filter_problem;
					+        }
				+        return $this->db->where($arr)->count_all_results('submissions');
				+    }
			
			-	public function count_final_submissions($assignment_id, $user_level, $username, $filter_user = NULL, $filter_problem = NULL)
			-	{
				-		$arr['assignment'] = $assignment_id;
				-		$arr['submit_id !='] = EDITOR_SUBMIT_ID;
				-		$arr['is_final'] = 1;
				-		if ($user_level === 0)
				-			$arr['username']=$username;
				-		elseif ($filter_user !== NULL)
				-			$arr['username'] = $filter_user;
				-		if ($filter_problem !== NULL)
				-			$arr['problem'] = $filter_problem;
				-		return $this->db->where($arr)->count_all_results('submissions');
				-	}
			
			+    // ------------------------------------------------------------------------
			
			-	// ------------------------------------------------------------------------
			
			+    public function count_all_submissions($assignment_id, $user_level, $username, $filter_user = null, $filter_problem = null)
			+    {
				+        $arr['assignment'] = $assignment_id;
				+        $arr['submit_id !='] = EDITOR_SUBMIT_ID;
				+        if ($user_level === 0) {
					+            $arr['username'] = $username;
					+        } elseif ($filter_user !== null) {
					+            $arr['username'] = $filter_user;
					+        }
				+        if ($filter_problem !== null) {
					+            $arr['problem'] = $filter_problem;
					+        }
				+        return $this->db->where($arr)->count_all_results('submissions');
				+    }
			
			-	public function count_all_submissions($assignment_id, $user_level, $username, $filter_user = NULL, $filter_problem = NULL)
			-	{
				-		$arr['assignment']=$assignment_id;
				-		$arr['submit_id !='] = EDITOR_SUBMIT_ID;
				-		if ($user_level === 0)
				-			$arr['username']=$username;
				-		elseif ($filter_user !== NULL)
				-			$arr['username'] = $filter_user;
				-		if ($filter_problem !== NULL)
				-			$arr['problem'] = $filter_problem;
				-		return $this->db->where($arr)->count_all_results('submissions');
				-	}
			
			+    // ------------------------------------------------------------------------
			
			-	// ------------------------------------------------------------------------
			
			+    public function set_final_submission($username, $assignment, $problem, $submit_id)
			+    {
				
				-	public function set_final_submission($username, $assignment, $problem, $submit_id)
				-	{
					+        $this->db->where(array(
					+            'is_final' => 1,
					+            'username' => $username,
					+            'assignment' => $assignment,
					+            'problem' => $problem,
					+        ))->update('submissions', array('is_final' => 0));
					
					-		$this->db->where(array(
					-			'is_final' => 1,
					-			'username' => $username,
					-			'assignment' => $assignment,
					-			'problem' => $problem,
					-		))->update('submissions', array('is_final'=>0));
					+        $this->db->where(array(
					+            'username' => $username,
					+            'assignment' => $assignment,
					+            'problem' => $problem,
					+            'submit_id' => $submit_id,
					+        ))->update('submissions', array('is_final' => 1));
					
					-		$this->db->where(array(
					-			'username' => $username,
					-			'assignment' => $assignment,
					-			'problem' => $problem,
					-			'submit_id' => $submit_id,
					-		))->update('submissions', array('is_final'=>1));
					+        return true;
					+    }
				
				-		return TRUE;
				-	}
			
			+    // ------------------------------------------------------------------------
			
			-	// ------------------------------------------------------------------------
			
			+    /**
			+     * add the result of an "upload only" submit to the database
			+     */
			+    public function add_upload_only($submit_info)
			+    {
				
				-	/**
				-	 * add the result of an "upload only" submit to the database
				-	 */
				-	public function add_upload_only($submit_info)
				-	{
					+        $this->db->where(array(
					+            'is_final' => 1,
					+            'username' => $submit_info['username'],
					+            'assignment' => $submit_info['assignment'],
					+            'problem' => $submit_info['problem'],
					+        ))->update('submissions', array('is_final' => 0));
					
					-		$this->db->where(array(
					-			'is_final' => 1,
					-			'username' => $submit_info['username'],
					-			'assignment' => $submit_info['assignment'],
					-			'problem' => $submit_info['problem'],
					-		))->update('submissions', array('is_final'=>0));
					+        $submit_info['is_final'] = 1;
					+        $submit_info['status'] = 'Uploaded';
					
					-		$submit_info['is_final'] = 1;
					-		$submit_info['status'] = 'Uploaded';
					+        $this->db->insert('submissions', $submit_info);
					
					-		$this->db->insert('submissions', $submit_info);
					-
					-	}
				+    }
			
			
		}
		
		----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode User\_model.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/models/User_model.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/models/User_model.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/models/User_model.php
	@@ -4,597 +4,621 @@
	* @file User_model.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	use Dapphp\Radius\Radius;
	
	class User_model extends CI_Model
	{
		+    public function __construct()
		+    {
			+        parent::__construct();
			+    }
		
		-	public function __construct()
		-	{
			-		parent::__construct();
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Have User
		+     *
		+     * Returns TRUE if there is a user with username $username in database
		+     *
		+     * @param $username
		+     * @return bool
		+     */
		+    public function have_user($username)
		+    {
			+        $query = $this->db->get_where('users', array('username' => $username));
			+        if ($query->num_rows() == 0) {
				+            return false;
				+        }
			+        if ($username === $query->row()->username) { // needed (because of utf8_general_ci [ci=case insensitive])
				+            return true;
				+        }
			+        return false;
			+    }
		
		-	/**
		-	 * Have User
		-	 *
		-	 * Returns TRUE if there is a user with username $username in database
		-	 *
		-	 * @param $username
		-	 * @return bool
		-	 */
		-	public function have_user($username)
		-	{
			-		$query = $this->db->get_where('users', array('username'=>$username));
			-		if ($query->num_rows() == 0)
			-			return FALSE;
			-		if ($username === $query->row()->username) // needed (because of utf8_general_ci [ci=case insensitive])
			-			return TRUE;
			-		return FALSE;
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * User ID to Username
		+     *
		+     * Converts user id to username (returns FALSE if user does not exist)
		+     *
		+     * @param $user_id
		+     * @return bool
		+     */
		+    public function user_id_to_username($user_id)
		+    {
			+        if(! is_numeric($user_id)) {
				+            return false;
				+        }
			+        $query = $this->db->select('username')->get_where('users', array('id' => $user_id));
			+        if ($query->num_rows() == 0) {
				+            return false;
				+        }
			+        return $query->row()->username;
			+    }
		
		-	/**
		-	 * User ID to Username
		-	 *
		-	 * Converts user id to username (returns FALSE if user does not exist)
		-	 *
		-	 * @param $user_id
		-	 * @return bool
		-	 */
		-	public function user_id_to_username($user_id)
		-	{
			-		if( ! is_numeric($user_id))
			-			return FALSE;
			-		$query = $this->db->select('username')->get_where('users', array('id'=>$user_id));
			-		if ($query->num_rows() == 0)
			-			return FALSE;
			-		return $query->row()->username;
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Username to User ID
		+     *
		+     * Converts username to user id (returns FALSE if user does not exist)
		+     *
		+     * @param $username
		+     * @return bool
		+     */
		+    public function username_to_user_id($username)
		+    {
			+        $query = $this->db->select('id')->get_where('users', array('username' => $username));
			+        if ($query->num_rows() == 0) {
				+            return false;
				+        }
			+        return $query->row()->id;
			+    }
		
		-	/**
		-	 * Username to User ID
		-	 *
		-	 * Converts username to user id (returns FALSE if user does not exist)
		-	 *
		-	 * @param $username
		-	 * @return bool
		-	 */
		-	public function username_to_user_id($username)
		-	{
			-		$query = $this->db->select('id')->get_where('users', array('username'=>$username));
			-		if ($query->num_rows() == 0)
			-			return FALSE;
			-		return $query->row()->id;
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Have Email
		+     *
		+     * Returns TRUE if a user (except $username) with given email exists
		+     *
		+     * @param $email
		+     * @param bool $username
		+     * @return bool
		+     */
		+    public function have_email($email, $username = false)
		+    {
			+        $query = $this->db->get_where('users', array('email' => $email));
			+        if ($query->num_rows() >= 1) {
				+            if($username !== false && $query->row()->username == $username) {
					+                return false;
					+            } else {
					+                return true;
					+            }
				+        }
			+        return false;
			+    }
		
		-	/**
		-	 * Have Email
		-	 *
		-	 * Returns TRUE if a user (except $username) with given email exists
		-	 *
		-	 * @param $email
		-	 * @param bool $username
		-	 * @return bool
		-	 */
		-	public function have_email($email, $username = FALSE)
		-	{
			-		$query = $this->db->get_where('users', array('email'=>$email));
			-		if ($query->num_rows() >= 1){
				-			if($username !== FALSE && $query->row()->username == $username)
				-				return FALSE;
				-			else
				-				return TRUE;
				-		}
			-		return FALSE;
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Add User
		+     *
		+     * Adds a single user
		+     *
		+     * @param $username
		+     * @param $email
		+     * @param $password
		+     * @param $role
		+     * @return bool|string
		+     */
		+    public function add_user($username, $email, $display_name, $password, $role)
		+    {
			+        if (! $this->form_validation->alpha_numeric($username)) {
				+            return 'Username may only contain alpha-numeric characters.';
				+        }
			+        if (strlen($username) < 3 or strlen($username) > 20 or strlen($password) < 6 or strlen($password) > 200) {
				+            return 'Username or password length error.';
				+        }
			+        if ($this->have_user($username)) {
				+            return 'User with this username exists.';
				+        }
			+        if ($this->have_email($email)) {
				+            return 'User with this email exists.';
				+        }
			+        if (strtolower($username) !== $username) {
				+            return 'Username must be lowercase.';
				+        }
			+        $roles = array('admin', 'head_instructor', 'instructor', 'student');
			+        if (! in_array($role, $roles)) {
				+            return 'Users role is not valid.';
				+        }
			+        $this->load->library('password_hash', array(8, false));
			+        $user = array(
			+            'username' => $username,
			+            'email' => $email,
			+            'display_name' => $display_name,
			+            'password' => $this->password_hash->HashPassword($password),
			+            'role' => $role
			+        );
			+        $this->db->insert('users', $user);
			+        return true; //success
			+    }
		
		-	/**
		-	 * Add User
		-	 *
		-	 * Adds a single user
		-	 *
		-	 * @param $username
		-	 * @param $email
		-	 * @param $password
		-	 * @param $role
		-	 * @return bool|string
		-	 */
		-	public function add_user($username, $email, $display_name, $password, $role)
		-	{
			-		if ( ! $this->form_validation->alpha_numeric($username) )
			-			return 'Username may only contain alpha-numeric characters.';
			-		if (strlen($username) < 3 OR strlen($username) > 20 OR strlen($password) < 6 OR strlen($password) > 200)
			-			return 'Username or password length error.';
			-		if ($this->have_user($username))
			-			return 'User with this username exists.';
			-		if ($this->have_email($email))
			-			return 'User with this email exists.';
			-		if (strtolower($username) !== $username)
			-			return 'Username must be lowercase.';
			-		$roles = array('admin', 'head_instructor', 'instructor', 'student');
			-		if ( ! in_array($role, $roles))
			-			return 'Users role is not valid.';
			-		$this->load->library('password_hash', array(8, FALSE));
			-		$user=array(
			-			'username' => $username,
			-			'email' => $email,
			-			'display_name' => $display_name,
			-			'password' => $this->password_hash->HashPassword($password),
			-			'role' => $role
			-		);
			-		$this->db->insert('users', $user);
			-		return TRUE; //success
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Add Users
		+     *
		+     * Adds multiple users
		+     *
		+     * @param $text
		+     * @param $send_mail
		+     * @param $delay
		+     * @return array
		+     */
		+    public function add_users($text, $send_mail, $delay)
		+    {
			
			-	/**
			-	 * Add Users
			-	 *
			-	 * Adds multiple users
			-	 *
			-	 * @param $text
			-	 * @param $send_mail
			-	 * @param $delay
			-	 * @return array
			-	 */
			-	public function add_users($text, $send_mail, $delay)
			-	{
				+        $lines = preg_split('/\r?\n|\n?\r/', $text);
				+        $users_ok = array();
				+        $users_error = array();
				
				-		$lines = preg_split('/\r?\n|\n?\r/', $text);
				-		$users_ok = array();
				-		$users_error = array();
				+        // loop over lines of $text :
				+        foreach ($lines as $line) {
					+            $line = trim($line);
					
					-		// loop over lines of $text :
					-		foreach ($lines as $line)
					-		{
						-			$line = trim($line);
						+            if (strlen($line) == 0 or $line[0] == '#') {
							+                continue;
							+            } //ignore comments and empty lines
						
						-			if (strlen($line) == 0 OR $line[0] == '#')
						-				continue; //ignore comments and empty lines
						+            $parts = preg_split('/,+/', $line);
						+            if (count($parts) == 5) {
							+                if (strtolower(substr($parts[3], 0, 6)) == 'random') {
								+                    // generate random password
								+                    $len = trim(substr($parts[3], 6), '[]');
								+                    if (is_numeric($len)) {
									+                        $this->load->helper('string');
									+                        $parts[3] = shj_random_password($len);
									+                    }
								+                }
							
							-			$parts = preg_split('/,+/', $line);
							-			if (count($parts) == 5){
								-				if (strtolower(substr($parts[3], 0, 6)) == 'random')
								-				{
									-					// generate random password
									-					$len = trim(substr($parts[3], 6), '[]');
									-					if (is_numeric($len)){
										-						$this->load->helper('string');
										-						$parts[3] = shj_random_password($len);
										-					}
									-				}
								+                $result = $this->add_user($parts[0], $parts[1], $parts[2], $parts[3], $parts[4]);
								
								-				$result = $this->add_user($parts[0], $parts[1], $parts[2], $parts[3], $parts[4]);
								+                if ($result === true) {
									+                    array_push($users_ok, array($parts[0], $parts[1], $parts[2], $parts[3], $parts[4]));
									+                } else {
									+                    array_push($users_error, array($parts[0], $parts[1], $parts[2], $parts[3], $parts[4], $result));
									+                }
								+            } else {
								+                array_push($users_error, array($parts[0], $parts[1], $parts[2], $parts[3], $parts[4], 'Wrong Format'));
								+                continue; //ignore lines that not contain 5 parts
								+            }
							+        } // end of loop
						
						-				if ($result === TRUE)
						-					array_push($users_ok, array($parts[0], $parts[1], $parts[2], $parts[3], $parts[4]));
						-				else
						-					array_push($users_error, array($parts[0], $parts[1], $parts[2], $parts[3], $parts[4], $result));
						-			}
					-			else{
						-				array_push($users_error, array($parts[0], $parts[1], $parts[2], $parts[3], $parts[4], 'Wrong Format'));
						-				continue; //ignore lines that not contain 5 parts
						-			}
					-		} // end of loop
				+        if ($send_mail) {
					+            // sending usernames and passwords by email
					+            $this->load->library('email');
					+            $this->load->config('secrets');
					+            $config = array(
					+                'mailtype'  => 'html',
					+                'charset'   => 'iso-8859-1'
					+            );
					+            $config = $this->config->item('shj_mail');
					+            $this->email->initialize($config);
					+            $this->email->set_newline("\r\n");
					+            $count_users = count($users_ok);
					+            $counter = 0;
					+            foreach ($users_ok as $user) {
						+                $counter++;
						+                $this->email->from($this->settings_model->get_setting('mail_from'), $this->settings_model->get_setting('mail_from_name'));
						+                $this->email->to($user[1]);
						+                $this->email->subject('SharIF Judge Username and Password');
						+                $text = $this->settings_model->get_setting('add_user_mail');
						+                $text = str_replace('{SITE_URL}', base_url(), $text);
						+                $text = str_replace('{ROLE}', $user[4], $text);
						+                $text = str_replace('{USERNAME}', $user[0], $text);
						+                $text = str_replace('{PASSWORD}', htmlspecialchars($user[3]), $text);
						+                $text = str_replace('{LOGIN_URL}', base_url(), $text);
						+                $this->email->message($text);
						+                $this->email->send();
						+                if ($counter < $count_users) {
							+                    sleep($delay);
							+                }
						+            }
					+        }
				
				-		if ($send_mail)
				-		{
					-			// sending usernames and passwords by email
					-			$this->load->library('email');
					-			$this->load->config('secrets');
					-			$config = array(
					-				'mailtype'  => 'html',
					-				'charset'   => 'iso-8859-1'
					-			);
					-			$config = $this->config->item('shj_mail');
					-			$this->email->initialize($config);
					-			$this->email->set_newline("\r\n");
					-			$count_users = count($users_ok);
					-			$counter = 0;
					-			foreach ($users_ok as $user)
					-			{
						-				$counter++;
						-				$this->email->from($this->settings_model->get_setting('mail_from'), $this->settings_model->get_setting('mail_from_name'));
						-				$this->email->to($user[1]);
						-				$this->email->subject('SharIF Judge Username and Password');
						-				$text = $this->settings_model->get_setting('add_user_mail');
						-				$text = str_replace('{SITE_URL}', base_url(), $text);
						-				$text = str_replace('{ROLE}', $user[4], $text);
						-				$text = str_replace('{USERNAME}', $user[0], $text);
						-				$text = str_replace('{PASSWORD}', htmlspecialchars($user[3]), $text);
						-				$text = str_replace('{LOGIN_URL}', base_url(), $text);
						-				$this->email->message($text);
						-				$this->email->send();
						-				if ($counter < $count_users)
						-					sleep($delay);
						-			}
					-		}
				+        return array($users_ok, $users_error);
				
				-		return array($users_ok, $users_error);
				+    }
			
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Delete User
		+     *
		+     * Deletes a user with given user id
		+     * Returns TRUE (success) or FALSE (failure)
		+     *
		+     * @param $user_id
		+     * @return bool
		+     */
		+    public function delete_user($user_id)
		+    {
			+        $this->db->trans_start();
			
			-	/**
			-	 * Delete User
			-	 *
			-	 * Deletes a user with given user id
			-	 * Returns TRUE (success) or FALSE (failure)
			-	 *
			-	 * @param $user_id
			-	 * @return bool
			-	 */
			-	public function delete_user($user_id)
			-	{
				-		$this->db->trans_start();
				+        $username = $this->user_id_to_username($user_id);
				+        if ($username === false) {
					+            return false;
					+        }
				+        $this->db->delete('users', array('id' => $user_id));
				+        $this->db->delete('submissions', array('username' => $username));
				+        // each time we delete a user, we should update all scoreboards
				+        $this->load->model('scoreboard_model');
				+        $this->scoreboard_model->update_scoreboards();
				
				-		$username = $this->user_id_to_username($user_id);
				-		if ($username === FALSE)
				-			return FALSE;
				-		$this->db->delete('users', array('id'=>$user_id));
				-		$this->db->delete('submissions', array('username' => $username));
				-		// each time we delete a user, we should update all scoreboards
				-		$this->load->model('scoreboard_model');
				-		$this->scoreboard_model->update_scoreboards();
				+        $this->db->trans_complete();
				
				-		$this->db->trans_complete();
				+        if ($this->db->trans_status()) {
					+            // Delete submitted files
					+            shell_exec("cd {$this->settings_model->get_setting('assignments_root')}; rm -r */*/{$username};");
					+            return true; //success
					+        }
				+        return false; // failure
				+    }
			
			-		if ($this->db->trans_status()) {
				-			// Delete submitted files
				-			shell_exec("cd {$this->settings_model->get_setting('assignments_root')}; rm -r */*/{$username};");
				-			return TRUE; //success
				-		}
			-		return FALSE; // failure
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Delete Submissions
		+     *
		+     * Deletes all submissions of user with given user id
		+     * Returns TRUE (success) or FALSE (failure)
		+     *
		+     * @param $user_id
		+     * @return bool
		+     */
		+    public function delete_submissions($user_id)
		+    {
			+        $this->db->trans_start();
			
			-	/**
			-	 * Delete Submissions
			-	 *
			-	 * Deletes all submissions of user with given user id
			-	 * Returns TRUE (success) or FALSE (failure)
			-	 *
			-	 * @param $user_id
			-	 * @return bool
			-	 */
			-	public function delete_submissions($user_id)
			-	{
				-		$this->db->trans_start();
				+        $username = $this->user_id_to_username($user_id);
				+        if ($username === false) {
					+            return false;
					+        }
				+        // delete all submissions from database
				+        $this->db->delete('submissions', array('username' => $username));
				+        // each time we delete a user's submissions, we should update all scoreboards
				+        $this->load->model('scoreboard_model');
				+        $this->scoreboard_model->update_scoreboards();
				
				-		$username = $this->user_id_to_username($user_id);
				-		if ($username === FALSE)
				-			return FALSE;
				-		// delete all submissions from database
				-		$this->db->delete('submissions', array('username'=>$username));
				-		// each time we delete a user's submissions, we should update all scoreboards
				-		$this->load->model('scoreboard_model');
				-		$this->scoreboard_model->update_scoreboards();
				+        $this->db->trans_complete();
				
				-		$this->db->trans_complete();
				+        if ($this->db->trans_status()) {
					+            // delete all submitted files
					+            shell_exec("cd {$this->settings_model->get_setting('assignments_root')}; rm -r */*/{$username};");
					+            return true; // success
					+        }
				
				-		if ($this->db->trans_status()) {
					-			// delete all submitted files
					-			shell_exec("cd {$this->settings_model->get_setting('assignments_root')}; rm -r */*/{$username};");
					-			return TRUE; // success
					-		}
				+        return false; // failure
				+    }
			
			-		return FALSE; // failure
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Validate User
		+     *
		+     * Returns TRUE if given username and password is valid for login
		+     *
		+     * @param $username
		+     * @param $password
		+     * @return bool
		+     */
		+    public function validate_user($username, $password)
		+    {
			+        $this->load->library('password_hash', array(8, false));
			+        $query = $this->db->get_where('users', array('username' => $username));
			+        if ($query->num_rows() != 1) {
				+            return false;
				+        }
			+        if ($query->row()->username !== $username) { // needed (because of utf8_general_ci [ci=case insensitive])
				+            return false;
				+        }
			+        if ($this->password_hash->CheckPassword($password, $query->row()->password)) {
				+            return true;
				+        }
			
			-	/**
			-	 * Validate User
			-	 *
			-	 * Returns TRUE if given username and password is valid for login
			-	 *
			-	 * @param $username
			-	 * @param $password
			-	 * @return bool
			-	 */
			-	public function validate_user($username, $password)
			-	{
				-		$this->load->library('password_hash', array(8, FALSE));
				-		$query = $this->db->get_where('users', array('username' => $username));
				-		if ($query->num_rows() != 1)
				-			return FALSE;
				-		if ($query->row()->username !== $username) // needed (because of utf8_general_ci [ci=case insensitive])
				-			return FALSE;
				-		if ($this->password_hash->CheckPassword($password, $query->row()->password))
				-			return TRUE;
				+        $this->load->config('secrets');
				+        if($this->config->item('shj_authenticate') == 'radius') {
					+            $client = new Radius();
					+            $client->setServer($this->config->item('shj_radius')['server']) // RADIUS server address
					+                ->setSecret($this->config->item('shj_radius')['secret']);
					+            if($client->accessRequest($username, $password)) {
						+                return true;
						+            }
					+        } elseif($this->config->item('shj_authenticate') == 'ldap') {
					+            try {
						+                $ldap = new \Adldap\Adldap();
						+                $ldap->addProvider($this->config->item('shj_ldap'));
						
						-		$this->load->config('secrets');
						-		if($this->config->item('shj_authenticate') == 'radius') {
							-			$client = new Radius();
							-			$client->setServer($this->config->item('shj_radius')['server']) // RADIUS server address
							-				->setSecret($this->config->item('shj_radius')['secret']);
							-			if($client->accessRequest($username, $password))
							-				return TRUE;
							-		} else if($this->config->item('shj_authenticate') == 'ldap') {
							-			try {
								-				$ldap = new \Adldap\Adldap();
								-				$ldap->addProvider($this->config->item('shj_ldap'));
								-				
								-				$guard = $ldap->getDefaultProvider()->getGuard();
								-				return $guard->attempt($username, $password);
								-			} catch (\Exception $e) {
								-				return FALSE;
								-			}
							-		}
						-		return FALSE;
						-	}
					+                $guard = $ldap->getDefaultProvider()->getGuard();
					+                return $guard->attempt($username, $password);
					+            } catch (\Exception $e) {
					+                return false;
					+            }
				+        }
			+        return false;
			+    }
		
		
		-	// ------------------------------------------------------------------------
		+    // ------------------------------------------------------------------------
		
		
		-	/**
		-	 * Selected Assignment
		-	 *
		-	 * Returns selected assignment by given username
		-	 * @param $username
		-	 * @return mixed
		-	 */
		-	public function selected_assignment($username)
		-	{
			-		$query = $this->db->select('selected_assignment')->get_where('users', array('username'=>$username));
			-		if ($query->num_rows() != 1){//logout
				-			$this->session->sess_destroy();
				-			redirect('login');
				-		}
			-		return $query->row()->selected_assignment;
			-	}
		+    /**
		+     * Selected Assignment
		+     *
		+     * Returns selected assignment by given username
		+     * @param $username
		+     * @return mixed
		+     */
		+    public function selected_assignment($username)
		+    {
			+        $query = $this->db->select('selected_assignment')->get_where('users', array('username' => $username));
			+        if ($query->num_rows() != 1) {//logout
				+            $this->session->sess_destroy();
				+            redirect('login');
				+        }
			+        return $query->row()->selected_assignment;
			+    }
		
		
		-	// ------------------------------------------------------------------------
		+    // ------------------------------------------------------------------------
		
		
		-	/**
		-	 * Get Display Name
		-	 *
		-	 * Returns name of the user with given username
		-	 *
		-	 * @return array
		-	 */
		-	public function get_names()
		-	{
			-		$query = $this->db->select('username, display_name')->get('users');
			-		$tmp = $query->result_array();
			-		$result = array();
			-		foreach ($tmp as $row)
			-			$result[$row['username']] = $row['display_name'];
			-		return $result;
			-	}
		+    /**
		+     * Get Display Name
		+     *
		+     * Returns name of the user with given username
		+     *
		+     * @return array
		+     */
		+    public function get_names()
		+    {
			+        $query = $this->db->select('username, display_name')->get('users');
			+        $tmp = $query->result_array();
			+        $result = array();
			+        foreach ($tmp as $row) {
				+            $result[$row['username']] = $row['display_name'];
				+        }
			+        return $result;
			+    }
		
		
		-	// ------------------------------------------------------------------------
		+    // ------------------------------------------------------------------------
		
		
		-	/**
		-	 * Update Profile
		-	 *
		-	 * Updates User Profile (Name, Email, Password, Role)
		-	 *
		-	 * @param $user_id
		-	 * @return bool
		-	 */
		-	public function update_profile($user_id)
		-	{
			-		$query = $this->db->get_where('users', array('id'=>$user_id));
			-		if ($query->num_rows() != 1)
			-			return FALSE;
			-		$the_user = $query->row();
			-		$username = $the_user->username;
			+    /**
			+     * Update Profile
			+     *
			+     * Updates User Profile (Name, Email, Password, Role)
			+     *
			+     * @param $user_id
			+     * @return bool
			+     */
			+    public function update_profile($user_id)
			+    {
				+        $query = $this->db->get_where('users', array('id' => $user_id));
				+        if ($query->num_rows() != 1) {
					+            return false;
					+        }
				+        $the_user = $query->row();
				+        $username = $the_user->username;
				
				-		$display_name = $this->input->post('display_name');
				-		$locked = $this->settings_model->get_setting(lock_student_display_name);
				-		if ($locked == 1) {
					-			$display_name = $the_user->display_name;
					-		}
				+        $display_name = $this->input->post('display_name');
				+        $locked = $this->settings_model->get_setting(lock_student_display_name);
				+        if ($locked == 1) {
					+            $display_name = $the_user->display_name;
					+        }
				
				-		$user=array(
				-			'display_name' => $display_name,
				-			'email' => $this->input->post('email')
				-		);
				+        $user = array(
				+            'display_name' => $display_name,
				+            'email' => $this->input->post('email')
				+        );
				
				-		// if a role is provided, change the role
				-		// (only admins are able to provide a role)
				-		if ($this->input->post('role') !== NULL)
				-			$user['role'] = $this->input->post('role');
				+        // if a role is provided, change the role
				+        // (only admins are able to provide a role)
				+        if ($this->input->post('role') !== null) {
					+            $user['role'] = $this->input->post('role');
					+        }
				
				-		// if a password is provided, change the password:
				-		if ($this->input->post('password') != ''){
					-			$this->load->library('password_hash', array(8, FALSE));
					-			$user['password'] = $this->password_hash->HashPassword($this->input->post('password'));
					-		}
				+        // if a password is provided, change the password:
				+        if ($this->input->post('password') != '') {
					+            $this->load->library('password_hash', array(8, false));
					+            $user['password'] = $this->password_hash->HashPassword($this->input->post('password'));
					+        }
				
				-		$this->db->where('username', $username)->update('users', $user);
				-	}
			+        $this->db->where('username', $username)->update('users', $user);
			+    }
		
		
		-	// ------------------------------------------------------------------------
		+    // ------------------------------------------------------------------------
		
		
		-	/**
		-	 * Send Password Reset Mail
		-	 *
		-	 * Generates a password reset key and sends an email containing the link
		-	 * for resetting password (in case of password lost)
		-	 *
		-	 * @param $email
		-	 */
		-	public function send_password_reset_mail($email)
		-	{
			-		// exit if $email is invalid:
			-		if ( ! $this->have_email($email) )
			-			return;
			+    /**
			+     * Send Password Reset Mail
			+     *
			+     * Generates a password reset key and sends an email containing the link
			+     * for resetting password (in case of password lost)
			+     *
			+     * @param $email
			+     */
			+    public function send_password_reset_mail($email)
			+    {
				+        // exit if $email is invalid:
				+        if (! $this->have_email($email)) {
					+            return;
					+        }
				
				-		// generate a random password reset key:
				-		$this->load->helper('string');
				-		$passchange_key = random_string('alnum', 50);
				+        // generate a random password reset key:
				+        $this->load->helper('string');
				+        $passchange_key = random_string('alnum', 50);
				
				-		// save the key in users table:
				-		$now = shj_now();
				-		$this->db->where('email', $email)->update('users', array('passchange_key'=>$passchange_key, 'passchange_time'=>date('Y-m-d H:i:s', $now)));
				+        // save the key in users table:
				+        $now = shj_now();
				+        $this->db->where('email', $email)->update('users', array('passchange_key' => $passchange_key, 'passchange_time' => date('Y-m-d H:i:s', $now)));
				
				-		// send the email:
				-		$this->load->library('email');
				-		$this->load->config('secrets');
				+        // send the email:
				+        $this->load->library('email');
				+        $this->load->config('secrets');
				
				-		$config = array(
				-			'mailtype'  => 'html',
				-			'charset'   => 'iso-8859-1'
				-		);
				-		$config = $this->config->item('shj_mail');
				-		$this->email->initialize($config);
				-		$this->email->set_newline("\r\n");
				-		$this->email->from($this->settings_model->get_setting('mail_from'), $this->settings_model->get_setting('mail_from_name'));
				-		$this->email->to($email);
				-		$this->email->subject('Password Reset');
				-		$text = $this->settings_model->get_setting('reset_password_mail');
				-		$text = str_replace('{SITE_URL}', base_url(), $text);
				-		$text = str_replace('{RESET_LINK}', site_url('login/reset/'.$passchange_key), $text);
				-		$text = str_replace('{VALID_TIME}', '1 hour', $text); // links are valid for 1 hour
				-		$this->email->message($text);
				-		$this->email->send();
				-	}
			+        $config = array(
			+            'mailtype'  => 'html',
			+            'charset'   => 'iso-8859-1'
			+        );
			+        $config = $this->config->item('shj_mail');
			+        $this->email->initialize($config);
			+        $this->email->set_newline("\r\n");
			+        $this->email->from($this->settings_model->get_setting('mail_from'), $this->settings_model->get_setting('mail_from_name'));
			+        $this->email->to($email);
			+        $this->email->subject('Password Reset');
			+        $text = $this->settings_model->get_setting('reset_password_mail');
			+        $text = str_replace('{SITE_URL}', base_url(), $text);
			+        $text = str_replace('{RESET_LINK}', site_url('login/reset/'.$passchange_key), $text);
			+        $text = str_replace('{VALID_TIME}', '1 hour', $text); // links are valid for 1 hour
			+        $this->email->message($text);
			+        $this->email->send();
			+    }
		
		
		-	// ------------------------------------------------------------------------
		+    // ------------------------------------------------------------------------
		
		
		-	/**
		-	 * Password Reset Key Is Valid
		-	 *
		-	 * Returns TRUE if the given password reset key is valid
		-	 * And returns an error message if key is invalid
		-	 *
		-	 * @param $passchange_key
		-	 * @return bool|string
		-	 */
		-	public function passchange_is_valid($passchange_key)
		-	{
			-		$query = $this->db->select('passchange_time')->get_where('users', array('passchange_key'=>$passchange_key));
			-		if ($query->num_rows() != 1)
			-			return 'Invalid password reset link.';
			-		$time = strtotime($query->row()->passchange_time);
			-		$now = shj_now();
			-		if ($now-$time > 3600 OR $now-$time < 0) // reset link is valid for 1 hour
			-			return 'The link is expired.';
			-		return TRUE;
			-	}
		+    /**
		+     * Password Reset Key Is Valid
		+     *
		+     * Returns TRUE if the given password reset key is valid
		+     * And returns an error message if key is invalid
		+     *
		+     * @param $passchange_key
		+     * @return bool|string
		+     */
		+    public function passchange_is_valid($passchange_key)
		+    {
			+        $query = $this->db->select('passchange_time')->get_where('users', array('passchange_key' => $passchange_key));
			+        if ($query->num_rows() != 1) {
				+            return 'Invalid password reset link.';
				+        }
			+        $time = strtotime($query->row()->passchange_time);
			+        $now = shj_now();
			+        if ($now - $time > 3600 or $now - $time < 0) { // reset link is valid for 1 hour
				+            return 'The link is expired.';
				+        }
			+        return true;
			+    }
		
		
		-	// ------------------------------------------------------------------------
		+    // ------------------------------------------------------------------------
		
		
		-	/**
		-	 * Reset Password
		-	 *
		-	 * Resets password for given password reset key (in case of lost password)
		-	 *
		-	 * @param $passchange_key
		-	 * @param $newpassword
		-	 * @return bool
		-	 */
		-	public function reset_password($passchange_key, $newpassword)
		-	{
			-		$query = $this->db->get_where('users', array('passchange_key'=>$passchange_key));
			-		if ($query->num_rows() != 1)
			-			return FALSE; //failure
			-		$this->load->library('password_hash', array(8, FALSE));
			-		$this->db->where('username', $query->row()->username)->update('users', array('passchange_key'=>'', 'password' => $this->password_hash->HashPassword($newpassword)));
			-		return TRUE; //success
			-	}
		+    /**
		+     * Reset Password
		+     *
		+     * Resets password for given password reset key (in case of lost password)
		+     *
		+     * @param $passchange_key
		+     * @param $newpassword
		+     * @return bool
		+     */
		+    public function reset_password($passchange_key, $newpassword)
		+    {
			+        $query = $this->db->get_where('users', array('passchange_key' => $passchange_key));
			+        if ($query->num_rows() != 1) {
				+            return false;
				+        } //failure
			+        $this->load->library('password_hash', array(8, false));
			+        $this->db->where('username', $query->row()->username)->update('users', array('passchange_key' => '', 'password' => $this->password_hash->HashPassword($newpassword)));
			+        return true; //success
			+    }
		
		
		-	// ------------------------------------------------------------------------
		+    // ------------------------------------------------------------------------
		
		
		-	/**
		-	 * Get All Users
		-	 *
		-	 * Returns an array of all users (for Users page)
		-	 *
		-	 * @return mixed
		-	 */
		-	public function get_all_users()
		-	{
			-		return $this->db->order_by('role', 'asc')->order_by('id')->get('users')->result_array();
			-	}
		+    /**
		+     * Get All Users
		+     *
		+     * Returns an array of all users (for Users page)
		+     *
		+     * @return mixed
		+     */
		+    public function get_all_users()
		+    {
			+        return $this->db->order_by('role', 'asc')->order_by('id')->get('users')->result_array();
			+    }
		
		
		-	// ------------------------------------------------------------------------
		+    // ------------------------------------------------------------------------
		
		
		-	/**
		-	 * Get User
		-	 *
		-	 * Returns database row for given user id
		-	 *
		-	 * @param $user_id
		-	 * @return bool
		-	 */
		-	public function get_user($user_id)
		-	{
			-		$query = $this->db->get_where('users', array('id'=>$user_id));
			-		if ($query->num_rows() != 1)
			-			return FALSE;
			-		return $query->row();
			-	}
		+    /**
		+     * Get User
		+     *
		+     * Returns database row for given user id
		+     *
		+     * @param $user_id
		+     * @return bool
		+     */
		+    public function get_user($user_id)
		+    {
			+        $query = $this->db->get_where('users', array('id' => $user_id));
			+        if ($query->num_rows() != 1) {
				+            return false;
				+        }
			+        return $query->row();
			+    }
		
		
		-	// ------------------------------------------------------------------------
		+    // ------------------------------------------------------------------------
		
		
		-	/**
		-	 * Update Login Time
		-	 *
		-	 * Updates First Login Time and Last Login Time for given username
		-	 *
		-	 */
		-	public function update_login_time($username)
		-	{
			-		$now = shj_now_str();
			+    /**
			+     * Update Login Time
			+     *
			+     * Updates First Login Time and Last Login Time for given username
			+     *
			+     */
			+    public function update_login_time($username)
			+    {
				+        $now = shj_now_str();
				
				-		$first_login = $this->db->select('first_login_time')->get_where('users', array('username'=>$username))->row()->first_login_time;
				-		if ($first_login === NULL)
				-			$this->db->where('username', $username)->update('users', array('first_login_time'=>$now));
				+        $first_login = $this->db->select('first_login_time')->get_where('users', array('username' => $username))->row()->first_login_time;
				+        if ($first_login === null) {
					+            $this->db->where('username', $username)->update('users', array('first_login_time' => $now));
					+        }
				
				-		$this->db->where('username', $username)->update('users', array('last_login_time'=>$now));
				-	}
			+        $this->db->where('username', $username)->update('users', array('last_login_time' => $now));
			+    }
		
		
		-	// ------------------------------------------------------------------------
		+    // ------------------------------------------------------------------------
	}
	
	----------- end diff -----------
\end{lstlisting}

\begin{lstlisting}[language=diff, caption=Perubahan pada kode User.php]
	Loaded config default.
	Using cache file ".php-cs-fixer.cache".
	1) application/models/User.php
	---------- begin diff ----------
	--- /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/models/User.php
	+++ /Users/user/Documents/KULIAH/Skripsi/SharIF-Judge-Version-1/application/models/User.php
	@@ -4,107 +4,111 @@
	* @file User_model.php
	* @author Mohammad Javad Naderi <mjnaderi@gmail.com>
	*/
	-defined('BASEPATH') OR exit('No direct script access allowed');
	+defined('BASEPATH') or exit('No direct script access allowed');
	
	class User extends CI_Model
	{
		+    public $username;
		+    public $selected_assignment;
		+    public $level;
		+    public $email;
		
		-	public $username;
		-	public $selected_assignment;
		-	public $level;
		-	public $email;
		
		+    public function __construct()
		+    {
			+        parent::__construct();
			+        $this->username = $this->session->userdata('username');
			+        if ($this->username === null) {
				+            return;
				+        }
			
			-	public function __construct()
			-	{
				-		parent::__construct();
				-		$this->username = $this->session->userdata('username');
				-		if ($this->username === NULL)
				-			return;
				+        $user = $this->db
				+            ->select('selected_assignment, role, email')
				+            ->get_where('users', array('username' => $this->username))
				+            ->row();
				
				-		$user = $this->db
				-			->select('selected_assignment, role, email')
				-			->get_where('users', array('username' => $this->username))
				-			->row();
				+        $this->email = $user->email;
				
				-		$this->email = $user->email;
				+        $query = $this->db->get_where('assignments', array('id' => $user->selected_assignment));
				+        if ($query->num_rows() != 1) {
					+            $this->selected_assignment = array(
					+                'id' => 0,
					+                'name' => 'Not Selected',
					+                'finish_time' => 0,
					+                'extra_time' => 0,
					+                'problems' => 0
					+            );
					+        } else {
					+            $this->selected_assignment = $query->row_array();
					+        }
				
				-		$query = $this->db->get_where('assignments', array('id' => $user->selected_assignment));
				-		if ($query->num_rows() != 1)
				-			$this->selected_assignment = array(
				-				'id' => 0,
				-				'name' => 'Not Selected',
				-				'finish_time' => 0,
				-				'extra_time' => 0,
				-				'problems' => 0
				-			);
				-		else
				-			$this->selected_assignment = $query->row_array();
				+        switch ($user->role) {
					+            case 'admin': $this->level = 3;
					+                break;
					+            case 'head_instructor': $this->level = 2;
					+                break;
					+            case 'instructor': $this->level = 1;
					+                break;
					+            case 'student': $this->level = 0;
					+                break;
					+        }
				+    }
			
			-		switch ($user->role)
			-		{
				-			case 'admin': $this->level = 3; break;
				-			case 'head_instructor': $this->level = 2; break;
				-			case 'instructor': $this->level = 1; break;
				-			case 'student': $this->level = 0; break;
				-		}
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Select Assignment
		+     *
		+     * Sets selected assignment for $username
		+     *
		+     * @param $assignment_id
		+     */
		+    public function select_assignment($assignment_id)
		+    {
			+        $this->db->where('username', $this->username)->update('users', array('selected_assignment' => $assignment_id));
			+    }
		
		-	/**
		-	 * Select Assignment
		-	 *
		-	 * Sets selected assignment for $username
		-	 *
		-	 * @param $assignment_id
		-	 */
		-	public function select_assignment($assignment_id)
		-	{
			-		$this->db->where('username', $this->username)->update('users', array('selected_assignment'=>$assignment_id));
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Save Widget Positions
		+     *
		+     * Updates position of dashboard widgets in database
		+     *
		+     * @param $positions
		+     */
		+    public function save_widget_positions($positions)
		+    {
			+        $this->db
			+            ->where('username', $this->username)
			+            ->update('users', array('dashboard_widget_positions' => $positions));
			+    }
		
		-	/**
		-	 * Save Widget Positions
		-	 *
		-	 * Updates position of dashboard widgets in database
		-	 *
		-	 * @param $positions
		-	 */
		-	public function save_widget_positions($positions)
		-	{
			-		$this->db
			-			->where('username', $this->username)
			-			->update('users', array('dashboard_widget_positions'=>$positions));
			-	}
		
		+    // ------------------------------------------------------------------------
		
		-	// ------------------------------------------------------------------------
		
		+    /**
		+     * Get Widget Positions
		+     *
		+     * Returns positions of dashboard widgets from database
		+     *
		+     * @param none
		+     * @return mixed
		+     */
		+    public function get_widget_positions()
		+    {
			+        return json_decode(
			+            $this->db->select('dashboard_widget_positions')
			+            ->get_where('users', array('username' => $this->username))
			+            ->row()
			+            ->dashboard_widget_positions,
			+            true
			+        );
			+    }
		
		-	/**
		-	 * Get Widget Positions
		-	 *
		-	 * Returns positions of dashboard widgets from database
		-	 *
		-	 * @param none
		-	 * @return mixed
		-	 */
		-	public function get_widget_positions()
		-	{
			-		return json_decode(
			-			$this->db->select('dashboard_widget_positions')
			-			->get_where('users', array('username' => $this->username))
			-			->row()
			-			->dashboard_widget_positions,
			-			TRUE
			-		);
			-	}
		-
		-}
	\ No newline at end of file
	+}

----------- end diff -----------
\end{lstlisting}


